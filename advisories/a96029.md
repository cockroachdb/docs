---
title: Technical Advisory 96029
advisory: A-96029
summary: CockroachDB may display higher than expected values for histogram metrics when calculating quantiles.
toc: true
affected_versions: v22.2.0 - v22.2.3
advisory_date: 2023-01-27
docs_area: releases
---

Publication date: {{ page.advisory_date | date: "%B %e, %Y" }}

## Description

In CockroachDB [v22.2.0](../releases/v22.2.html#v22-2-0), [v22.2.1](../releases/v22.2.html#v22-2-1), [v22.2.2](../releases/v22.2.html#v22-2-2), and [v22.2.3](../releases/v22.2.html#v22-2-3), new Prometheus histogram buckets were defined for metrics to reduce the overall number of timeseries metrics generated per Prometheus histogram to 15, from a previously dynamically generated number of buckets exceeding 100 buckets. We had received feedback from customers that prior versions of CockroachDB generated an unmanageable number of histogram buckets, which is what led to this change.

These new histogram buckets significantly reduced the fidelity of histograms when calculating quantiles (e.g. P90, P95, P99, etc). In particular, all histogram metrics have only 15 possible values, instead of the previous dynamic number of buckets, up to 100s prior to the change. Users may notice notable changes in latency reported when viewing latency graphs in [DB Console](../v22.2/ui-overview.html), [Prometheus](../v22.2/monitor-cockroachdb-with-prometheus.html), or other timeseries tools. This does not necessarily indicate an actual change in latencies, but rather is a byproduct of lower fidelity histogram bucket boundaries.

This causes a notable negative impact on observability for all histogram metrics used within CockroachDB, making it more difficult to discern if thereâ€™s an actual increase in latency when viewing a timeseries graph, or if the increase is a result of lower fidelity buckets.

## Statement

This issue will be resolved in the upcoming CockroachDB v22.2.4 maintenance release, by increasing the fidelity of the histogram buckets. Furthermore, an environment variable will be introduced giving users the option to revert to using the legacy histogram model instead of the newer histograms.

## Mitigation

Users of CockroachDB v22.2.0, v22.2.1, v22.2.2, and v22.2.3 should make use of the [Statement Details](../v22.2/ui-statements-page.html#statement-details-page) page within the [DB Console](../v22.2/ui-overview.html) to verify query latencies, as the latency reported on this page does not rely on histogram metrics. Users are also encouraged to more closely monitor client side latencies in the meantime. Finally, users are encouraged to update to CockroachDB v22.2.4 as soon as it is released.

## Impact

Histogram metrics in CockroachDB v22.2.0, v22.2.1, v22.2.2, and v22.2.3 instances may report higher than expected values, which alone should not be trusted as an indicator that overall latencies have changed.

Please reach out to the [support team](https://support.cockroachlabs.com/) if more information or assistance is needed.
