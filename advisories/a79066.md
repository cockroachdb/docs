---
title: Technical Advisory 79066
summary: Data key rotation is inadvertently disabled if the store key hasn't changed since the last node start
toc: true
docs_area: releases
---

Publication date: April xx, 2022

## Description

CockroachDB's [Encryption-At-Rest (EAR)](../{{site.versions["stable"]}}/encryption.html) feature advertises automatic data key rotation at a configurable interval, defaulting to every week. While the store key is set by the operator when they start CockroachDB, data keys are managed by CockroachDB's EAR layer itself. Data key rotation improves data security by reducing the blast radius of any single exposed data key, as newer data files would be encrypted with newer keys.

A bug in initialization of store and data keys on node restart led to data key rotation getting inadvertently disabled if the store key specified in the `--enterprise-encryption` flag hadn't changed since the last node start.


## Statement

This is resolved in CockroachDB by [PR 80114](https://github.com/cockroachdb/cockroach/pull/80114).

The fix has been applied to maintenance versions v21.1.19 and v21.2.10 of CockroachDB.

This public issue is tracked by [79066](https://github.com/cockroachdb/cockroach/issues/79066).

## Mitigation

Users of CockroachDB 21.2 and 21.1 are encouraged to upgrade to 21.2.10, 21.1.19 or a later version of CockroachDB.

Alternatively, for the time being, users with strong requirements around data key rotation can continue to manually rotate store keys to force a data key rotation.

## Impact

All clusters with encryption-at-rest enabled running versions of CockroachDB 21.2 and 21.1 older than the fixed version are impacted, except for nodes with continuous CockroachDB uptime since the last store key rotation. Impacted nodes are likely to have a larger-than-ideal proportion of their data files encrypted with the last data key, increasing the chance of a data breach if that key were to be exposed.

Please reach out to the [support team](https://support.cockroachlabs.com/) for more information.
