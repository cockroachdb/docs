---
title: What&#39;s New in v2.1.0-beta.20180827
toc: true
summary: Additions and changes in CockroachDB version v2.1.0-beta.20180827 since version v2.1.0-alpha.20180730
toc: true
---

## August 27, 2018

We have now transitioned into the CockroachDB 2.1 Beta phase and will be releasing weekly until the GA release. This week's release includes PostgreSQL compatibility enhancements, general usability improvements, performance improvements, and bug fixes. In addition, we want to highlight a few major benefits:

- **Automatic performance optimizations** - Range leases are now automatically rebalanced throughout the cluster to even out the amount of QPS being handled by each server.
- **Better controls for geo-distributed clusters** - Weâ€™ve added more sophisticated support for controlling the network interfaces to use in certain situations, so nodes can prefer local, private IPs for inter-DC communication, and only use public IPs when making hops that must go over the open internet. See the `--locality-advertise-addr` flag of the [`cockroach start`](../v2.1/start-a-node.html) command for more details.

Get future release notes emailed to you:

{% include marketo.html %}

### Downloads

<div id="os-tabs" class="clearfix os-tabs_button-outline-primary">
    <a href="https://binaries.cockroachdb.com/cockroach-v2.1.0-beta.20180827.darwin-10.9-amd64.tgz"><button id="mac" data-eventcategory="mac-binary-release-notes">Mac</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v2.1.0-beta.20180827.linux-amd64.tgz"><button id="linux" data-eventcategory="linux-binary-release-notes">Linux</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v2.1.0-beta.20180827.src.tgz"><button id="source" data-eventcategory="source-release-notes">Source</button></a>
</div>

### Backward-incompatible changes

- Support for PostgreSQL's `TIMETZ` data type has been removed due to incomplete/incorrect implementation. This
feature was available only in previous 2.1 alpha releases. Before upgrading to this release, tables with the `TIMETZ` type must be dropped entirely; it is not possible to convert the data or drop a single `TIMETZ` column. [#28095][#28095] {% comment %}doc{% endcomment %}
- Support for the `BIT` data type has been removed due to incorrect implementation and incompatibility with some client apps. Tables with the `BIT` type will continue to work but will see their type automatically changed to `INT` in the output of `SHOW TABLES`, `information_schema`, etc. This is backward-compatible insofar that the previous `BIT` type in CockroachDB was actually a simple integer. A PostgreSQL-compatible replacement will likely be added at a later time. [#28814][#28814] {% comment %}doc{% endcomment %}

### General changes

- CockroachDB now supports a separate CA (`ca-ui.crt`) and certificate (`ui.crt`) for the Web UI. [#27916][#27916] {% comment %}doc{% endcomment %}
- The ability to set lease placement preferences in [replication zones](../v2.1/configure-replication-zones.html) is now fully supported. Existing lease placement preferences will continue to function as in v2.0. [#28261][#28261] {% comment %}doc{% endcomment %}
- The new `/_admin/v1/enqueue_range` admin server endpoint runs a specified range through a specified internal queue on one or all nodes. The `skip_should_queue` parameter can also be specified to tell the system to blindly run without first checking whether it needs to be run. This endpoint is intended primarily for debugging purposes. [#26554][#26554] {% comment %}doc{% endcomment %}
- If enabled, anonymous [diagnostics reporting](../v2.1/diagnostics-reporting.html) now includes hardware and OS information as well as basic stats about the size of `IMPORT` jobs. [#28676][#28676] [#28726][#28726] {% comment %}doc{% endcomment %}

### Enterprise edition changes

- This release includes several changes to the [Change Data Capture](../v2.1/change-data-capture.html) feature:
    - `CHANGEFEED`s now support interleaved tables [#27991][#27991] {% comment %}doc{% endcomment %}
    - `CREATE CHANGEFEED` now requires an enterprise license when used with Kafka. [#27962][#27962] {% comment %}doc{% endcomment %}
    - `CHANGEFEED`s now produce an error when column families are added (instead of returning incorrect results) and when targeting `system` tables (instead of operating with undefined behavior). [#27962][#27962] {% comment %}doc{% endcomment %}
    - `CREATE CHANGEFEED` is now restricted to superusers. [#27962][#27962] {% comment %}doc{% endcomment %}
    - `CHANGEFEED` job descriptions now substitute values for SQL placeholders. [#28220][#28220] {% comment %}doc{% endcomment %}
    - `CHANGEFEED`s can now only target lists of physical tables. [#27996][#27996] {% comment %}doc{% endcomment %}
    - `CHANGEFEED`s now produce an error when a watched table is truncated, dropped, or renamed. [#28204][#28204] {% comment %}doc{% endcomment %}
    - `CHANGEFEED` Kafka tunings have been adjusted for faster flushes, improving throughput. [#28586][#28586]
    - `CHANGEFEED`s now checkpoint progress more granularly. [#28319][#28319]
    - `CHANGEFEED`s now export metrics for production monitoring. [#28162][#28162] {% comment %}doc{% endcomment %}
    - The `CHANGEFEED` `timestamp` option has been split into `updated` and `resolved`. [#28733][#28733] {% comment %}doc{% endcomment %}
    - `CHANGEFEED`s are now executed using our distributed SQL framework. [#28555][#28555] {% comment %}doc{% endcomment %}
- This release includes the following changes to the [Encryption At Rest](../v2.1/encryption.html) feature:
    - The status of encryption is now written to [debug logs](../v2.1/debug-and-error-logs.html). [#27880][#27880] {% comment %}doc{% endcomment %}
    - Data keys are now rotated while nodes are running. [#28148][#28148] {% comment %}doc{% endcomment %}
    - The new `cockroach debug encryption-status` command displays encryption key information. [#28582][#28582] {% comment %}doc{% endcomment %}

### SQL language changes

- Added foreign key support to [`IMPORT ... MYSQLDUMP`](../v2.1/import.html). [#27861][#27861] {% comment %}doc{% endcomment %}
- The output of [`SHOW GRANTS`](../v2.1/show-grants.html) is now fully sorted. [#27884][#27884] {% comment %}doc{% endcomment %}
- Reads from Google Cloud Storage for [`IMPORT`](../v2.1/import.html) or [`BACKUP`](../v2.1/backup.html) jobs are now more resilient to quota limits. [#27862][#27862]
- The [`ORDER BY INDEX`](../v2.1/query-order.html#sorting-in-index-order) notation now implies an ordering by the implicit primary key columns appended to an index. [#27812][#27812] {% comment %}doc{% endcomment %}
- Added the `server_encoding` [session variable](../v2.1/show-vars.html) and protocol status parameter, for compatibility with PostgreSQL. It is set to `UTF8` and cannot be changed. [#27943][#27943] {% comment %}doc{% endcomment %}
- Extended support of the `extra_float_digits` [session variable](../v2.1/show-vars.html), for compatibility with PostgreSQL. [#27952][#27952] {% comment %}doc{% endcomment %}
- Improved the handling of [`SET`](../v2.1/set-vars.html), [`RESET`](../v2.1/reset-vars.html) and [`SHOW`](../v2.1/show-vars.html), for better compatibility with PostgreSQL. [#27947][#27947] {% comment %}doc{% endcomment %}
- Exposed the `integer_datetimes` session variable in `SHOW` and `pg_settings`, for compatibility with PostgreSQL. [#27947][#27947] {% comment %}doc{% endcomment %}
- The default values of the `client_min_messages` and `extra_float_digits` [session variables](../v2.1/show-vars.html) now match PostgreSQL. [#27947][#27947] {% comment %}doc{% endcomment %}
- Corrected the `oids` and formatting of some columns in the `pg_catalog.pg_index` table. [#27961][#27961]
- The distribution of queries that use the `repeat()` [built-in function](../v2.1/functions-and-operators.html) are now permitted. [#28039][#28039]
- Statement statistics are now grouped separately for queries using the [cost-based optimizer](../v2.1/cost-based-optimizer.html) and heuristic planner. [#27806][#27806]
- CockroachDB now supports empty tuples with the syntax `()`, 1-valued tuples with the syntax `(x,)` in addition to `row(x)`, and the ability to use `IN` with an empty tuple as right operand. This is a CockroachDB extension. [#28143][#28143] {% comment %}doc{% endcomment %}
- CockroachDB now supports constructing array values using parentheses, for example `ARRAY(1,2,3,4)`. This is a CockroachDB extension; the standard PostgreSQL syntax `ARRAY[1,2,3,4]` remains supported. [#28238][#28238] {% comment %}doc{% endcomment %}
- CockroachDB now supports converting arrays and tuples to strings, for compatibility with PostgreSQL. [#28183][#28183] {% comment %}doc{% endcomment %}
- `ANY`/`ALL`/`SOME` comparisons are now more permissive about the types of their input expressions, and comparisons with empty tuples are now allowed. [#28226][#28226]
- Improved the handling of decimal 0s. Specifically, -0 is coerced to 0 and values like 0.00 retain the digits after the decimal point. [#27978][#27978]
- Arrays of arrays are no longer allowed, even as intermediate results. [#28116][#28116]
- [`IMPORT ... PGDUMP`](../v2.1/import.html) now supports CockroachDB dump files. [#28359][#28359] {% comment %}doc{% endcomment %}
- The decimal variants of the `ceil()` and `ceiling()` functions now return 0 where they would have returned -0 previously. [#28366][#28366]
- Improved support for S3-compatible endpoints in [`BACKUP`](../v2.1/backup.html), [`RESTORE`](../v2.1/restore.html), and [`IMPORT`](../v2.1/import.html). The `AWS_REGION` parameter is no longer required. Services like Digital Ocean Spaces and Minio now work correctly. [#28394][#28394] {% comment %}doc{% endcomment %}
- CockroachDB now supports an optional `FILTER` clause with aggregates when used as [window functions](../v2.1/window-functions.html). [#28357][#28357]
- Normalized the case of table names imported via [`IMPORT ... MYSQLDUMP`](../v2.1/import.html). [#28397][#28397] {% comment %}doc{% endcomment %}
- All queries now run through the DistSQL execution engine. [#27863][#27863]
- It is now an error to specify both `FORCE_INDEX` and `NO_INDEX_JOIN` hints at the same time. [#28411][#28411]
- Added `numeric_precision_radix` to the `information_schema.columns` table. [#28467][#28467] {% comment %}doc{% endcomment %}
- Added the `schemachanger.lease.duration` and `schemachanger.lease.renew_fraction` [cluster settings](../v2.1/cluster-settings.html) to control the schema change lease. [#28342][#28342] {% comment %}doc{% endcomment %}
- Added the `string_agg()` aggregation function, which concats a collection of strings into a single string and separates them with a specified delimiter. [#28392][#28392] {% comment %}doc{% endcomment %}
- CockroachDB now fully supports the `RANGE` mode for specification of [window function frames](../v2.1/window-functions.html). [#27022][#27022] {% comment %}doc{% endcomment %}
- CockroachDB now supports the `GROUPS` mode for specification of [window function frames](../v2.1/window-functions.html). [#28244][#28244] {% comment %}doc{% endcomment %}
- CockroachDB now supports the `ARRAY()` operator and comparisons with sub-queries on the right side of the comparison, when they appear themselves in sub-queries. [#28618][#28618]
- CockroachDB now supports two experimental compatibility modes with how PostgreSQL handles [`SERIAL`](../v2.1/serial.html) and [sequences](../v2.1/create-sequence.html), to ease reuse of 3rd party frameworks or apps developed for PostgreSQL. These modes can be enabled with the `experimental_serial_normalization` session variable (per client) and `sql.defaults.serial_normalization` cluster setting (cluster-wide). The first mode, `virtual_sequence`, enables compatibility with many applications using `SERIAL` with maximum performance and scalability. The second mode, `sql_sequence`, enables maximum PostgreSQL compatibility but uses regular SQL sequences and is thus subject to performance constraints. [#28575][#28575] {% comment %}doc{% endcomment %}
- The output of [`SHOW COLUMNS`](../v2.1/show-columns.html) now indicates which columns are hidden. [#28750][#28750] {% comment %}doc{% endcomment %}
- [`SHOW CREATE`](../v2.1/show-create.html) now reports the `FLOAT` column types as `FLOAT4` and `FLOAT8` (the default) instead of `REAL` and `FLOAT`. [#28776][#28776]

### Command-line changes

- This release includes the following changes to the [`cockroach start`](../v2.1/start-a-node.html) command:
    - The new `--listen-addr` flag recognizes both a hostname/address and port and replaces the `--host` and `--port` flags, which are now deprecated for `cockroach start` but remain valid for other *client* commands. The port portion of `--listen-addr` can be either a service name or numeric value; when specified as `0`, a port number is automatically allocated. [#27800][#27800] [#28373][#28373] [#28502][#28502] {% comment %}doc{% endcomment %}
    - The new `--advertise-addr` flag recognizes both a hostname/address and port and replaces the `--advertise-host` and `--advertise-port` flags, which are now deprecated.  The port portion of `--advertise-addr` can be either a service name or numeric value; when specified as `0`, a port number is automatically allocated. [#27800][#27800] [#28373][#28373] [#28502][#28502] {% comment %}doc{% endcomment %}
    - The new `--http-addr` flag recognizes both a hostname/address and port and replaces the `--http-host` flag, which is now deprecated. The port portion of `--http-addr` can be either a service name or numeric value; when specified as `0`, a port number is automatically allocated. [#28373][#28373] [#28502][#28502] {% comment %}doc{% endcomment %}
    - The new `--locality-advertise-addr` flag can be used advertise a hostname/address and port to other CockroachDB nodes for specific [localities](../v2.1/start-a-node.html#locality). This is useful in deployments with "local" or "private" interfaces that are only accessible by a subset of the nodes and "global" or "public" interfaces that are slower or more expensive but accessible by any node. In such cases, `--locality-advertise-addr` can be used to route traffic over the local interface whenever possible. [#28531][#28531]
    - The command now reports the URL of the web UI with the prefix "`webui:`", not `admin:`. [#28038][#28038] {% comment %}doc{% endcomment %}
    - The command now reports a warning if more than 75% of available RAM is reserved by `--cache` and `--max-sql-memory`. [#28199][#28199] {% comment %}doc{% endcomment %}
    - The command now suggests which command-line flags to use to access the newly started node in client commands (e.g., `cockroach quit`, etc.). [#28198][#28198] [`cockroach start`](../v2.1/start-a-node.html) {% comment %}doc{% endcomment %}
- This release includes the following changes to `cockroach` client commands:
    - Client commands now better attempt to inform the user about why a connection is failing. [#28200][#28200] {% comment %}doc{% endcomment %}
    - Client commands that print out SQL results now issue a warning if more than 10000 result rows are buffered in the `table` formatter. [#28490][#28490]
    - Client commands that use a SQL connection (e.g., `cockroach sql`, `cockroach node`, `cockroach user`) now produce an error if a connection could not be established within 5 seconds instead of waiting forever.  [#28326][#28326] {% comment %}doc{% endcomment %}
    - The [`cockroach sql`](../v2.1/use-the-built-in-sql-client.html) command and other client commands that display SQL results now use the new `table` result formatter by default, replacing the previous formatter called `pretty`. This provides more compact and more reusable results. [#28465][#28465] {% comment %}doc{% endcomment %}
    - The [`cockroach sql`](../v2.1/use-the-built-in-sql-client.html) command and other client commands that display SQL results containing byte arrays now print them as if they were converted by a SQL cast to the `STRING` type. [#28494][#28494] {% comment %}doc{% endcomment %}
    - The `--host` flag and `COCKROACH_HOST` environment variable for client commands now recognize both a hostname/address and port number. The `--port` flag is still recognized but no longer documented; `--host` is now preferred. The `COCKROACH_PORT` environment variable is now deprecated in favor of `COCKROACH_HOST`. Also, the syntax to specify IPv6 addresses has been changed to use square brackets, for example, `--host=[::1]` instead of just `--host=::1`; the previous syntax is still recognized for backward compatibility but is deprecated. [#28373][#28373] {% comment %}doc{% endcomment %}
- The new `timeseries.storage.10s_resolution_ttl` and `timeseries.storage.30m_resolution_ttl` [cluster settings](../v2.1/cluster-settings.html) control how long time series data is retained on the cluster. They work with the recently added "roll-ups" to allow longer retention of time series data while consuming considerably less disk space. [#28169][#28169] {% comment %}doc{% endcomment %}    
- The [`cockroach demo`](../v2.1/cockroach-demo.html) command now supports starting with one of various datasets loaded. [#28383][#28383] {% comment %}doc{% endcomment %}
- The file generated by running `cockroach debug zip` now contains the contents of the `system.rangelog` table, which is a record of range splits and rebalances in the cluster. The problem ranges report is now included as well. [#28396][#28396] [#28253][#28253] {% comment %}doc{% endcomment %}
- The `cockroach node status` command now works on unavailable/broken clusters. [#28249][#28249] {% comment %}doc{% endcomment %}
- CockroachDB now reports a non-zero exit status if an attempt is made to use a non-existent command. [#28492][#28492]
- CockroachDB now attempts to inform the operator if the names and IP addresses listed in the configured certificates do not match the server configuration. [#28502][#28502] {% comment %}doc{% endcomment %}
- Added a locality filter for the `cockroach gen haproxy` command [#28649][#28649] {% comment %}doc{% endcomment %}

### Web UI changes

- Added disk read and write time charts to the [**Hardware** dashboard](../v2.1/admin-ui-hardware-dashboard.html). [#27977][#27977] [#28594][#28594] {% comment %}doc{% endcomment %}
- The [**Hardware** dashboard](../v2.1/admin-ui-hardware-dashboard.html) now shows system and user CPU summed instead of separately, and normalized by number of CPUs. [#28596][#28596] {% comment %}doc{% endcomment %}
- Added a link to the [**Statements** page](../v2.1/admin-ui-statements-page.html) from the sidebar. [#27928][#27928] {% comment %}doc{% endcomment %}
- The [**Statements** page](../v2.1/admin-ui-statements-page.html) now reveals whether a SQL query used the new cost-based optimizer. [#28094][#28094] {% comment %}doc{% endcomment %}
- Added the number of CPUs and percentages of memory and disk usage to the [**Node List**](../v2.1/admin-ui-overview-dashboard.html). [#28189][#28189] {% comment %}doc{% endcomment %}
- Removed "distsql reads" time series from the [**SQL** dashboard](../v2.1/admin-ui-sql-dashboard.html), since execution engines are being merged. [#28350][#28350] {% comment %}doc{% endcomment %}
- The **Problem Ranges** report now shows the number of replicas that have an excessively large log. [#28034][#28034] {% comment %}doc{% endcomment %}
- The **Stores** report now shows encryption statistics. [#26890][#26890] {% comment %}doc{% endcomment %}
- Login is now required by default on secure clusters. [#28416][#28416] {% comment %}doc{% endcomment %}
- Enlarged the clickable area on dropdown components to include entirety of the surrounding container. [#28331][#28331]
- The [**Jobs** page](../v2.1/admin-ui-jobs-page.html) now supports indefinitely-running job types that have a "highwater timestamp", instead of the "fraction completed" used by jobs with a finite task. [#28535][#28535] {% comment %}doc{% endcomment %}
- Improved the alert text that is displayed when the Web UI connection is lost. [#28838][#28838]

### Bug fixes

- Fixed a bug where the [**Statements** page](../v2.1/admin-ui-statements-page.html) in the Web UI blanked out after reloading itself. [#28108][#28108]
- CockroachDB no longer erroneously allows generator functions, aggregates, and window functions in the `ON` clause of joins. [#28839][#28839]
- Fixed an `index-id does not exist` error that could happen on [`ADD COLUMN`](../v2.1/add-column.html) or [`DROP COLUMN`](../v2.1/drop-column.html). [#28803][#28803]
- Fixed row counts in the output of [`IMPORT`](../v2.1/import.html). [#28469][#28469] {% comment %}doc{% endcomment %}
- Fixed various problems related to the rollback of [schema changes](../v2.1/online-schema-changes.html).[#28014][#28014] [#28050][#28050]
- Prevented a node from freezing after `DROP DATABASE` when the command aborts, and fixed the rare use of an older descriptor after [`DROP INDEX`](../v2.1/drop-index.html). [#28381][#28381]
- Fixed the handling of regular aggregations combined with window functions and columns "as-is". [#27897][#27897]
- Fixed a panic caused by key-value tracing a plan that uses an index joiner. [#27942][#27942]
- The `bytea_output` [session variable](../v2.1/set-vars.html) is now properly effective for distributed queries. [#27951][#27951]
- Limited the size of "batch groups" when committing a batch to RocksDB to avoid rare scenarios in which multi-gigabyte batch groups are created, which can cause a server to run out of memory when replaying the RocksDB log at startup. [#27895][#27895]
- Fixed the round-tripping of cast expression formatting in the presence of [collated strings](../v2.1/collate.html). [#27941][#27941]
- Prevented spurious query errors when planning some complex correlated SRFs through the distributed execution engine. [#27995][#27995]
- Fixed the handling of frame boundary offsets in `WINDOW` clauses. [#27933][#27933]
- Fixed the formatting of time datatypes in some circumstances. [#28040][#28040]
- Fixed the behavior of `crdb_internal.cluster_id()` in distributed queries. [#28042][#28042]
- Fixed incorrect `NULL` handling in the distributed implementations of `INTERSECT` and `EXCEPT`. [#28097][#28097]
- Corrected erroneous failures of privileged built-ins in queries run through the distributed execution engine. [#28107][#28107]
- Ensured that the [`TIMESTAMP`](../v2.1/timestamp.html) data type never retains a timezone and renders consistently across a distributed computation flow. [#28112][#28112]
- Corrected casts and binary operators between `TIMESTAMPTZ` and `TIMESTAMP` in some cases. [#28128][#28128]
- Prevented some [sequence built-ins](../v2.1/functions-and-operators.html#sequence-functions) from incorrectly running in distributed flows. [#28114][#28114]
- Corrected the round-trip formatting of negative floats and decimals in the context of other expressions when executing in a distributed flow. [#28129][#28129]
- Fixed bug that could skip the row following a deleted row during [`BACKUP`](../v2.1/backup.html). [#28172][#28172]
- The [`cockroach user set --password`](../v2.1/create-and-manage-users.html) command can now change the password of existing users. [#28197][#28197] {% comment %}doc{% endcomment %}
- CockroachDB now supports a wider range of tuple and array values in query results. [#28151][#28151]
- This release includes the following fixes to the [`cockroach sql`](../v2.1/use-the-built-in-sql-client.html) and [`cockroach demo`](../v2.1/cockroach-demo.html) command:
    - The commands are now properly able to customize the prompt with `~/.editrc` on Linux. [#28233][#28233] {% comment %}doc{% endcomment %}
    - The commands once again support copy-pasting special unicode character from other documents. [#28233][#28233] {% comment %}doc{% endcomment %}
    - The commands once again properly handle copy-pasting a mixture of client-side commands (e.g., `\set`) and SQL statements. [#28235][#28235]
    - The commands now properly print a warning when a `?` character is mistakenly used to receive contextual help in a non-interactive session, instead of crashing. [#28324][#28324]
    - The commands now work properly even when the `TERM` environment variable is not set. [#28613][#28613]
- Generator built-ins now correctly return no rows instead of `NULL` when given `NULL` arguments. [#28252][#28252]
- Fixed out-of-memory errors caused by very large raft logs. [#28293][#28293] [#28511][#28511]
- Certain queries that use empty arrays constructed from subqueries no longer spuriously fail when executed via the distributed execution engine. [#28391][#28391]
- `SHOW JOBS` now uses placeholder values for `BACKUP` and `RESTORE` job descriptions. [#28321][#28321]
- CockroachDB now handles negative `FLOAT` zeros properly in more cases. [#28569][#28569]
- CockroachDB now correctly handles computation of `array_agg()` when used as a [window function](../v2.1/window-functions.html). [#28291][#28291]
- [Decommissioning multiple nodes](../v2.1/remove-nodes.html) is now possible without posing a risk to cluster health. Recommissioning a node no longer requires a restart of the target node to take effect. [#28707][#28707] {% comment %}doc{% endcomment %}
- Fixed a rare scenario where the value written for one system key was seen when another system key was read, leading to the violation of internal invariants. [#28794][#28794]
- Hidden columns are now listed in `information_schema` and `pg_catalog` tables, for better compatibility with PostgreSQL. [#28750][#28750] {% comment %}doc{% endcomment %}
- Casting arrays now correctly preserves `NULL` values. [#28860][#28860]
- `IMPORT` no longer silently converts `\r\n` characters in CSV files into `\n`. [#28181][#28181]
- Fixed initial poor latencies introduced in a recent release. [#28599][#28599]

### Performance improvements

- CockroachDB now periodically refreshes table leases to avoid initial latency on tables that have not been accessed recently. [#28725][#28725] {% comment %}doc{% endcomment %}
- Improved the fixed cost of running distributed sql queries. [#27899][#27899]
- Prevent large buffer allocation for DML statements with `RETURNING` clauses. [#27944][#27944]
- Improved low-level iteration performance in the presence of range tombstones. [#27904][#27904]
- Data ingested with `RESTORE` and `IMPORT` is now eligible for a performance optimization used in incremental `BACKUP` and `CHANGEFEED`s. [#27966][#27966]
- Reduced lock contention in `RemoteClockMonitor`. [#28000][#28000]
- Reduced lock contention in the Replica write path. [#24990][#24990]
- Reduced lock contention in the Gossip server. [#28001][#28001] [#28127][#28127]
- Reduced lock contention and avoided allocations in `raftEntryCache`. [#27997][#27997]
- Fixed a batch commit performance regression that reduced write performance by 20%. [#28163][#28163]
- Greatly improved the performance of catching up followers that are behind when Raft logs are large. [#28511][#28511]
- Slightly improved the performance of the `nextval()` [sequence function](../v2.1/functions-and-operators.html#sequence-functions). [#28576][#28576]
- Reduced the cost of Raft log truncations and increased single-range throughput. [#28126][#28126]
- Subqueries are now run through the distributed execution engine. [#28580][#28580]
- Range leases are now automatically rebalanced throughout the cluster to even out the amount of QPS being handled by each node. [#28340][#28340] {% comment %}doc{% endcomment %}
- Greatly improved the performance of deleting from interleaved tables that have `ON DELETE CASCADE` clauses. [#28330][#28330]

### Doc updates

- Added a tutorial on [orchestrating CockroachDB across multiple Kubernetes clusters in different regions](../v2.1/orchestrate-cockroachdb-with-kubernetes-multi-cluster.html). [#3558](https://github.com/cockroachdb/docs/pull/3558)
- Expanded the [Build an App](../v2.1/build-an-app-with-cockroachdb.html) tutorials for most languages to offer instructions and code samples for secure clusters. [#3557](https://github.com/cockroachdb/docs/pull/3557)
- Significantly expanded the documentation on [Window Functions](../v2.1/window-functions.html). [#3426](https://github.com/cockroachdb/docs/pull/3426)
- Added a conceptual explanation of [Online Schema Changes](../v2.1/online-schema-changes.html), with examples and current limitations. [#3492](https://github.com/cockroachdb/docs/pull/3492)
- Streamlined instructions for essential [enterprise and core backup and restore tasks](../v2.1/backup-and-restore.html), including a bash script for automated backups. [#3489](https://github.com/cockroachdb/docs/pull/3489)
- Expanded the [TPC-C Performance Benchmarking](../v2.1/performance-benchmarking-with-tpc-c.html) tutorial to cover benchmarking large clusters. [#3281][#3281]
- Documented the `skip` option for [`IMPORT`](../v2.1/import.html) as well as support for decompressing input files. [#3510](https://github.com/cockroachdb/docs/pull/3510)
- Documented the `ANALYZE`, `OPT`, and `DISTSQL` option for [`EXPLAIN`](../v2.1/explain.html). [#3427](https://github.com/cockroachdb/docs/pull/3427)
- Documented how to [add a computed column to an existing table](../v2.1/computed-columns.html#add-a-computed-column-to-an-existing-table) and [convert a computed column into a regular column](../v2.1/computed-columns.html#convert-a-computed-column-into-a-regular-column). [#3501](https://github.com/cockroachdb/docs/pull/3501) [#3538](https://github.com/cockroachdb/docs/pull/3538)
- Documented the abbreviated PostgreSQL [`INTERVAL`](../v2.1/interval.html) format. [#3503](https://github.com/cockroachdb/docs/pull/3503)
- Documented the `auto_trace` [session variable](../v2.1/set-vars.html), which replaces the `SHOW TRACE` statement. [#3508](https://github.com/cockroachdb/docs/pull/3508)
- Various updates to the [Information Schema](../v2.1/information-schema.html) documentation. [#3531](https://github.com/cockroachdb/docs/pull/3531)
- Documented the new [default databases](../v2.1/show-databases.html#default-databases). [#3506](https://github.com/cockroachdb/docs/pull/3506)
- Cleaned up the output of all `SHOW` statements; combined the `SHOW CREATE TABLE`, `SHOW CREATE VIEW`, and `SHOW CREATE SEQUENCE` pages into a single [`SHOW
CREATE`](../v2.1/show-create.html) page; and removed the experimental status from [`SHOW CONSTRAINTS`](../v2.1/show-constraints.html). [#3523](https://github.com/cockroachdb/docs/pull/3523)
- Documented the [`cockroach demo`](../v2.1/cockroach-demo.html) command. [#3509](https://github.com/cockroachdb/docs/pull/3509)
- Various updates to the [`cockroach sql`](../v2.1/use-the-built-in-sql-client.html) documentation. [#3499](https://github.com/cockroachdb/docs/pull/3499)

### Contributors

This release includes 493 merged PRs by 39 authors.
We would like to thank the following contributors from the CockroachDB community:

- Constantine Peresypkin
- Garvit Juniwal
- Joseph Lowinske (first-time contributor, CockroachDB team member)
- Song Hao
- Takuya Kuwahara
- Tim O'Brien (first-time contributor, CockroachDB team member)
- neeral

[#24990]: https://github.com/cockroachdb/cockroach/pull/24990
[#26554]: https://github.com/cockroachdb/cockroach/pull/26554
[#26806]: https://github.com/cockroachdb/cockroach/pull/26806
[#26890]: https://github.com/cockroachdb/cockroach/pull/26890
[#27022]: https://github.com/cockroachdb/cockroach/pull/27022
[#27752]: https://github.com/cockroachdb/cockroach/pull/27752
[#27800]: https://github.com/cockroachdb/cockroach/pull/27800
[#27806]: https://github.com/cockroachdb/cockroach/pull/27806
[#27812]: https://github.com/cockroachdb/cockroach/pull/27812
[#27829]: https://github.com/cockroachdb/cockroach/pull/27829
[#27861]: https://github.com/cockroachdb/cockroach/pull/27861
[#27862]: https://github.com/cockroachdb/cockroach/pull/27862
[#27863]: https://github.com/cockroachdb/cockroach/pull/27863
[#27880]: https://github.com/cockroachdb/cockroach/pull/27880
[#27884]: https://github.com/cockroachdb/cockroach/pull/27884
[#27895]: https://github.com/cockroachdb/cockroach/pull/27895
[#27897]: https://github.com/cockroachdb/cockroach/pull/27897
[#27899]: https://github.com/cockroachdb/cockroach/pull/27899
[#27904]: https://github.com/cockroachdb/cockroach/pull/27904
[#27916]: https://github.com/cockroachdb/cockroach/pull/27916
[#27928]: https://github.com/cockroachdb/cockroach/pull/27928
[#27933]: https://github.com/cockroachdb/cockroach/pull/27933
[#27941]: https://github.com/cockroachdb/cockroach/pull/27941
[#27942]: https://github.com/cockroachdb/cockroach/pull/27942
[#27943]: https://github.com/cockroachdb/cockroach/pull/27943
[#27944]: https://github.com/cockroachdb/cockroach/pull/27944
[#27947]: https://github.com/cockroachdb/cockroach/pull/27947
[#27951]: https://github.com/cockroachdb/cockroach/pull/27951
[#27952]: https://github.com/cockroachdb/cockroach/pull/27952
[#27959]: https://github.com/cockroachdb/cockroach/pull/27959
[#27961]: https://github.com/cockroachdb/cockroach/pull/27961
[#27962]: https://github.com/cockroachdb/cockroach/pull/27962
[#27966]: https://github.com/cockroachdb/cockroach/pull/27966
[#27977]: https://github.com/cockroachdb/cockroach/pull/27977
[#27978]: https://github.com/cockroachdb/cockroach/pull/27978
[#27991]: https://github.com/cockroachdb/cockroach/pull/27991
[#27995]: https://github.com/cockroachdb/cockroach/pull/27995
[#27996]: https://github.com/cockroachdb/cockroach/pull/27996
[#27997]: https://github.com/cockroachdb/cockroach/pull/27997
[#28000]: https://github.com/cockroachdb/cockroach/pull/28000
[#28001]: https://github.com/cockroachdb/cockroach/pull/28001
[#28007]: https://github.com/cockroachdb/cockroach/pull/28007
[#28014]: https://github.com/cockroachdb/cockroach/pull/28014
[#28034]: https://github.com/cockroachdb/cockroach/pull/28034
[#28038]: https://github.com/cockroachdb/cockroach/pull/28038
[#28039]: https://github.com/cockroachdb/cockroach/pull/28039
[#28040]: https://github.com/cockroachdb/cockroach/pull/28040
[#28042]: https://github.com/cockroachdb/cockroach/pull/28042
[#28050]: https://github.com/cockroachdb/cockroach/pull/28050
[#28085]: https://github.com/cockroachdb/cockroach/pull/28085
[#28094]: https://github.com/cockroachdb/cockroach/pull/28094
[#28095]: https://github.com/cockroachdb/cockroach/pull/28095
[#28097]: https://github.com/cockroachdb/cockroach/pull/28097
[#28107]: https://github.com/cockroachdb/cockroach/pull/28107
[#28108]: https://github.com/cockroachdb/cockroach/pull/28108
[#28112]: https://github.com/cockroachdb/cockroach/pull/28112
[#28114]: https://github.com/cockroachdb/cockroach/pull/28114
[#28116]: https://github.com/cockroachdb/cockroach/pull/28116
[#28126]: https://github.com/cockroachdb/cockroach/pull/28126
[#28127]: https://github.com/cockroachdb/cockroach/pull/28127
[#28128]: https://github.com/cockroachdb/cockroach/pull/28128
[#28129]: https://github.com/cockroachdb/cockroach/pull/28129
[#28143]: https://github.com/cockroachdb/cockroach/pull/28143
[#28148]: https://github.com/cockroachdb/cockroach/pull/28148
[#28151]: https://github.com/cockroachdb/cockroach/pull/28151
[#28159]: https://github.com/cockroachdb/cockroach/pull/28159
[#28162]: https://github.com/cockroachdb/cockroach/pull/28162
[#28163]: https://github.com/cockroachdb/cockroach/pull/28163
[#28169]: https://github.com/cockroachdb/cockroach/pull/28169
[#28172]: https://github.com/cockroachdb/cockroach/pull/28172
[#28181]: https://github.com/cockroachdb/cockroach/pull/28181
[#28183]: https://github.com/cockroachdb/cockroach/pull/28183
[#28189]: https://github.com/cockroachdb/cockroach/pull/28189
[#28197]: https://github.com/cockroachdb/cockroach/pull/28197
[#28198]: https://github.com/cockroachdb/cockroach/pull/28198
[#28199]: https://github.com/cockroachdb/cockroach/pull/28199
[#28200]: https://github.com/cockroachdb/cockroach/pull/28200
[#28204]: https://github.com/cockroachdb/cockroach/pull/28204
[#28220]: https://github.com/cockroachdb/cockroach/pull/28220
[#28226]: https://github.com/cockroachdb/cockroach/pull/28226
[#28233]: https://github.com/cockroachdb/cockroach/pull/28233
[#28235]: https://github.com/cockroachdb/cockroach/pull/28235
[#28238]: https://github.com/cockroachdb/cockroach/pull/28238
[#28244]: https://github.com/cockroachdb/cockroach/pull/28244
[#28249]: https://github.com/cockroachdb/cockroach/pull/28249
[#28252]: https://github.com/cockroachdb/cockroach/pull/28252
[#28253]: https://github.com/cockroachdb/cockroach/pull/28253
[#28261]: https://github.com/cockroachdb/cockroach/pull/28261
[#28291]: https://github.com/cockroachdb/cockroach/pull/28291
[#28293]: https://github.com/cockroachdb/cockroach/pull/28293
[#28319]: https://github.com/cockroachdb/cockroach/pull/28319
[#28321]: https://github.com/cockroachdb/cockroach/pull/28321
[#28324]: https://github.com/cockroachdb/cockroach/pull/28324
[#28326]: https://github.com/cockroachdb/cockroach/pull/28326
[#28330]: https://github.com/cockroachdb/cockroach/pull/28330
[#28331]: https://github.com/cockroachdb/cockroach/pull/28331
[#28340]: https://github.com/cockroachdb/cockroach/pull/28340
[#28342]: https://github.com/cockroachdb/cockroach/pull/28342
[#28350]: https://github.com/cockroachdb/cockroach/pull/28350
[#28357]: https://github.com/cockroachdb/cockroach/pull/28357
[#28359]: https://github.com/cockroachdb/cockroach/pull/28359
[#28366]: https://github.com/cockroachdb/cockroach/pull/28366
[#28373]: https://github.com/cockroachdb/cockroach/pull/28373
[#28381]: https://github.com/cockroachdb/cockroach/pull/28381
[#28383]: https://github.com/cockroachdb/cockroach/pull/28383
[#28391]: https://github.com/cockroachdb/cockroach/pull/28391
[#28392]: https://github.com/cockroachdb/cockroach/pull/28392
[#28394]: https://github.com/cockroachdb/cockroach/pull/28394
[#28396]: https://github.com/cockroachdb/cockroach/pull/28396
[#28397]: https://github.com/cockroachdb/cockroach/pull/28397
[#28411]: https://github.com/cockroachdb/cockroach/pull/28411
[#28416]: https://github.com/cockroachdb/cockroach/pull/28416
[#28465]: https://github.com/cockroachdb/cockroach/pull/28465
[#28467]: https://github.com/cockroachdb/cockroach/pull/28467
[#28469]: https://github.com/cockroachdb/cockroach/pull/28469
[#28490]: https://github.com/cockroachdb/cockroach/pull/28490
[#28492]: https://github.com/cockroachdb/cockroach/pull/28492
[#28494]: https://github.com/cockroachdb/cockroach/pull/28494
[#28502]: https://github.com/cockroachdb/cockroach/pull/28502
[#28511]: https://github.com/cockroachdb/cockroach/pull/28511
[#28514]: https://github.com/cockroachdb/cockroach/pull/28514
[#28531]: https://github.com/cockroachdb/cockroach/pull/28531
[#28533]: https://github.com/cockroachdb/cockroach/pull/28533
[#28535]: https://github.com/cockroachdb/cockroach/pull/28535
[#28555]: https://github.com/cockroachdb/cockroach/pull/28555
[#28569]: https://github.com/cockroachdb/cockroach/pull/28569
[#28575]: https://github.com/cockroachdb/cockroach/pull/28575
[#28576]: https://github.com/cockroachdb/cockroach/pull/28576
[#28580]: https://github.com/cockroachdb/cockroach/pull/28580
[#28582]: https://github.com/cockroachdb/cockroach/pull/28582
[#28586]: https://github.com/cockroachdb/cockroach/pull/28586
[#28594]: https://github.com/cockroachdb/cockroach/pull/28594
[#28596]: https://github.com/cockroachdb/cockroach/pull/28596
[#28599]: https://github.com/cockroachdb/cockroach/pull/28599
[#28613]: https://github.com/cockroachdb/cockroach/pull/28613
[#28618]: https://github.com/cockroachdb/cockroach/pull/28618
[#28632]: https://github.com/cockroachdb/cockroach/pull/28632
[#28649]: https://github.com/cockroachdb/cockroach/pull/28649
[#28676]: https://github.com/cockroachdb/cockroach/pull/28676
[#28707]: https://github.com/cockroachdb/cockroach/pull/28707
[#28725]: https://github.com/cockroachdb/cockroach/pull/28725
[#28726]: https://github.com/cockroachdb/cockroach/pull/28726
[#28733]: https://github.com/cockroachdb/cockroach/pull/28733
[#28750]: https://github.com/cockroachdb/cockroach/pull/28750
[#28776]: https://github.com/cockroachdb/cockroach/pull/28776
[#28794]: https://github.com/cockroachdb/cockroach/pull/28794
[#28803]: https://github.com/cockroachdb/cockroach/pull/28803
[#28814]: https://github.com/cockroachdb/cockroach/pull/28814
[#28838]: https://github.com/cockroachdb/cockroach/pull/28838
[#28839]: https://github.com/cockroachdb/cockroach/pull/28839
[#28856]: https://github.com/cockroachdb/cockroach/pull/28856
[#28860]: https://github.com/cockroachdb/cockroach/pull/28860
