---
title: What&#39;s New in v20.1.0-beta.3
toc: true
summary: Additions and changes in CockroachDB version v20.1.0-beta.3 since version v20.1.0-beta.2
---

## March 24, 2020

Get future release notes emailed to you:

<div class="hubspot-install-form install-form-1 clearfix">
    <script>
        hbspt.forms.create({
            css: '',
            cssClass: 'install-form',
            portalId: '1753393',
            formId: '39686297-81d2-45e7-a73f-55a596a8d5ff',
            formInstanceId: 1,
            target: '.install-form-1'
        });
    </script>
</div>

### Downloads

<div id="os-tabs" class="clearfix">
    <a href="https://binaries.cockroachdb.com/cockroach-v20.1.0-beta.3.darwin-10.9-amd64.tgz"><button id="mac" data-eventcategory="mac-binary-release-notes">Mac</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v20.1.0-beta.3.linux-amd64.tgz"><button id="linux" data-eventcategory="linux-binary-release-notes">Linux</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v20.1.0-beta.3.linux-amd64.tgz"><button id="linux" data-eventcategory="linux-binary-release-notes">Linux</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v20.1.0-beta.3.src.tgz"><button id="source" data-eventcategory="source-release-notes">Source</button></a>
</div>

### Docker image

{% include copy-clipboard.html %}
~~~shell
$ docker pull cockroachdb/cockroach-unstable:v20.1.0-beta.3
~~~


### Backward-incompatible changes

- The [`GRANT`](../v20.1/grant.html) and [`REVOKE`](../v20.1/revoke.html) statements now require that the requesting user already have the target privileges themselves. For example, `GRANT SELECT ON t TO foo` requires that the requesting user already have the `SELECT` privilege on `t`. [#45697][#45697] {% comment %}doc{% endcomment %}

### Security updates

- Non-licensed users are now able to add more principals to the special superuser [role](../v20.1/roles.html)/group `admin`. Creation of additional roles is still a licensed feature. [#45325][#45325] {% comment %}doc{% endcomment %}
- Admin users can now [grant](../v20.1/grant.html) `ZONECONFIG` to non-admin users on specific SQL objects (databases/tables). When set, the user is authorized to modify that object's [zone configuration](../v20.1/configure-replication-zones.html) and decide data placement on specific nodes or groups thereof. [#45201][#45201] {% comment %}doc{% endcomment %}
- It is now possible to use [`GRANT`](../v20.1/grant.html) and [`REVOKE`](../v20.1/revoke.html) to add users to the `admin` role without a valid license. This change aims to enable use of the Admin UI and other privileged features without a license. [#45325][#45325] {% comment %}doc{% endcomment %}
- The validation rule for principal names was extended to support periods and thus allow domain name-like principals. For reference, the validation rule is currently the regular expression `^[\p{Ll}0-9_][---\p{Ll}0-9_.]+$`, and limited to a size of 63 UTF-8 bytes (larger usernames are rejected with an error); for comparison, PostgreSQL allows many more characters and truncates at 63 characters silently. [#45575][#45575] {% comment %}doc{% endcomment %}
-  All users can now *view* any comments on any object (bypassing other privileges), but modifying comments require write privilege on the target object. Previously, any user could modify any database/table/view/index comment via direct SQL updates to `system.comments`. This was unintended and a form of privilege escalation, and is now prevented. The privileges required for the [`COMMENT`](../v20.1/comment-on.html) statement, `pg_description`, `col_description()`, `obj_description()`, and `shobj_description()` are operating as in PostgreSQL and are unaffected by this change.[#45712][#45712] {% comment %}doc{% endcomment %}
- The [`GRANT`](../v20.1/grant.html) statement has been changed to be more like a capability-based system: it can only propagate privileges that the requesting user already has. Previously, it could be used to grant any other bit to any user, even to the requesting user. Note that the pseudo-privilege `ALL` includes `GRANT`, so `GRANT ALL`, in effect, preserves the previous behavior: it grants `GRANT` and every over privileges, so all privileges can be re-granted transitively. [#45697][#45697] {% comment %}doc{% endcomment %}
- CockroachDB now offers the ability to SQL client connection events (connection established and connection terminated) and SQL client authentication events (authentication method selection, authentication method application, authentication method result, and session termination) to a distinct `cockroach-auth.log` file in each node's main log directory. To enable SQL client connection logging, set the `server.auth_log.sql_connections.enabled` [cluster setting](../v20.1/cluster-settings.html). To enable SQL client authentication event logging, set the new `server.auth_log.sql_sessions.enabled` [cluster setting](../v20.1/cluster-settings.html) cluster setting. Note that this feature is experimental; as such, the interface and output are subject to change. [#45193][#45193] {% comment %}doc{% endcomment %}
- User and role principals can now be prevented from logging in using the `NOLOGIN` attribute, which can be set using [`ALTER USER/ROLE`](../v20.1/alter-user.html). [#45541][#45541] {% comment %}doc{% endcomment %}
- The password field (used exclusively for password-based authentication) can now be configured to have an expiration date using the `VALID UNTIL` attribute, which can be set with [`ALTER USER/ROLE`](../v20.1/alter-user.html). Note that the attribute sets an expiration date for the password, not the user account. This is consistent with PostgreSQL. [#45541][#45541] {% comment %}doc{% endcomment %}
- Any [role](../v20.1/roles.html) created prior to v20.1 will be able to log into clusters started with `--insecure`, unless/until they are given the `NOLOGIN` attribute. For secure clusters, roles cannot log in by virtue of not having a password nor a client certificate. [#45541][#45541] {% comment %}doc{% endcomment %}
- The `--external-io-dir=disabled` now applies to `nodelocal upload` requests. [#45858][#45858] {% comment %}doc{% endcomment %}
- It is now possible for operators to disable the use of implicit credentials when accessing external cloud storage services for various bulk operations (e.g, [`BACKUP`](../v20.1/backup.html), [`IMPORT`](../v20.1/import.html), etc).  The use of implicit credentials can be disabled by using the `--external-io-disable-implicit-credentials` flag. [#45969][#45969] {% comment %}doc{% endcomment %}
- Added the `LOGIN` option to enable login for roles/users. When using [`CREATE USER`](../v20.1/create-user.html) syntax, `LOGIN` is enabled by default whereas when using [`CREATE ROLE`](../v20.1/create-role.html), `LOGIN` is not enabled by default. [#45541][#45541] {% comment %}doc{% endcomment %}
- Added the `VALID UNTIL` option to indicate passwords are only valid until a given timestamp. `VALID UNTIL` only affects `PASSWORDS` - if passwords are disabled, `VALID UNTIL` has no effect. Also, you can login even with expired password if passwords are not required to login-- same as PostgreSQL). [#45541][#45541] {% comment %}doc{% endcomment %}
- [`SHOW USERS`](../v20.1/show-users.html) now shows all roles/users that have `LOGIN` enabled. [#45541][#45541] {% comment %}doc{% endcomment %}
- Modified the [`CREATE ROLE`](../v20.1/create-role.html) statement to add the `CREATEROLE` option. Also added the `ALTER ROLE` statement and the `CREATEROLE` privilege. It is managed by choosing options when creating and altering a role. Example: `CREATE ROLE role WITH CREATEROLE;` [#44232][#44232] {% comment %}doc{% endcomment %}

### General changes

- HTTP endpoints now report status `403 (Forbidden)` instead of `500 (Internal server error)` when the authenticated user has insufficient privileges to use the endpoint. [#45325][#45325] {% comment %}doc{% endcomment %}
- Improved a debug message that is printed when a range is unavailable (i.e., unable to accept writes). [#45580][#45580]
- Logs emitted from [jobs](../v20.1/show-jobs.html) are now tagged with the job ID to improve visibility and aid debugging. [#45728][#45728]
- On new clusters, the internal `system.jobs` table now uses the default `zoneconfig` and `TTL` (25h). [#45767][#45767] {% comment %}doc{% endcomment %}
- `nodelocal://` URIs now require a node ID be specified in the hostname field. The special node ID of `'self'` is equivalent to the old behavior of when the node ID was unspecified. [#45764][#45764] {% comment %}doc{% endcomment %}
- Non-running [`jobs`](../v20.1/show-jobs.html) are now considered for adoption in randomized order instead of in a determistic order by creation time, to avoid potential deadlocks when schema change jobs need to execute in a specific order. This is a preemptive change, not a bug fix, but it affects all jobs. [#45870][#45870] {% comment %}doc{% endcomment %}
- Schema changes are now scheduled and run fully like other [jobs](../v20.1/show-jobs.html): they now can be [canceled](../v20.1/cancel-job.html), [paused](../v20.1/pause-job.html), and [resumed](../v20.1/resume-job.html). Some other UI differences come with this implementation change; notably, all schema changes now have an associated job, failed schema changes are now rolled back within the "Reverting" phase of the same job, and GC for dropped indexes and tables is deferred to a later job. [#45870][#45870]

### Enterprise edition changes

- [CDC](../v20.1/change-data-capture.html) to cloud-storage sinks now supports optional `gzip` compression. [#45326][#45326] {% comment %}doc{% endcomment %}
- [`BACKUP`](../v20.1/backup.html) can be re-run with the same destination path to automatically append an incremental backup to that path. [#45255][#45255] {% comment %}doc{% endcomment %}
- [`RESTORE`](../v20.1/restore.html) now allows using `AS OF SYSTEM TIME` to pick a target backup from a larger list of incremental backups. [#45368][#45368] {% comment %}doc{% endcomment %}
- [Changefeeds](../v20.1/create-changefeed.html) now have new options to control the types of schema change events the changefeed should respond to (`schema_change_events`), and the behavior to take when such an event occurs (`schema_change_policy`). This functionality allows users to halt changefeeds upon schema changes or skip over the logical backfill that is performed by default. [#45652][#45652] {% comment %}doc{% endcomment %}
- Two new [`CHANGEFEED`](../v20.1/create-changefeed.html) options, `initial_scan` and `no_initial_scan`, have been added. The `initial_scan` can be used only if no cursor had been specified (indicating the desire to start the `CHANGEFEED` from `now()`). The new options allow clients to override this default behavior and create changefeeds from the present without an initial scan, or from a point in time with one. You cannot specify both options simultaneously. [#45663][#45663] {% comment %}doc{% endcomment %}
- [`BACKUP`](../v20.1/backup.html) will no longer fail if the GC window for a table is exceeded while backing the table up. [#45859][#45859] {% comment %}doc{% endcomment %}

### SQL language changes

- CockroachDB previously allowed [`TIMESTAMP`/`TIMESTAMPTZ`](../v20.1/timestamp.html) and [`TIME`/`TIMETZ`](../v20.1/time.html) to be converted to `TIMESTAMP(0)`/`TIMESTAMPTZ(0)`, but this does not actually change any of the precision within it. CockroachDB now prohibits converting any precision of `TIMESTAMP`/`TIMESTAMPTZ`/`TIME`/`TIMETZ` to a lower precision value. [#45314][#45314] {% comment %}doc{% endcomment %}
- The new `diagnostics.sql_stat_reset.interval` [cluster setting](../v20.1/cluster-settings.html) controls the rate at which SQL statement statistics are refreshed. Additionally, the setting `diagnostics.forced_stat_reset.interval` was renamed to `diagnostics.forced_sql_stat_reset_interval`. [#45082][#45082] {% comment %}doc{% endcomment %}
- [Operators](../v20.1/functions-and-operators.html) on two [arrays](../v20.1/array.html) with different element types now fail at type-check time instead of evaluation time. [#45260][#45260]
- Improved the error message for the unsupported interaction between correlated subqueries and `WITH` clauses [#45227][#45227]
- [`UPSERT`](../v20.1/upsert.html) and [`INSERT..ON CONFLICT`](../v20.1/insert.html) statements now (occasionally) need to do an extra check to ensure that they never update the same row twice. This may adversely affect performance in cases where the [optimizer](../v20.1/cost-based-optimizer.html) cannot statically prove the extra check is unnecessary. [#45372][#45372]
- [`UPDATE`](../v20.1/update.html) statements now acquire locks using the `FOR UPDATE` locking mode during their initial row scan, which improves performance for contended workloads. This behavior is configurable using the `enable_implicit_select_for_update` [session variable](../v20.1/set-vars.html) and the `sql.defaults.implicit_select_for_update.enabled` [cluster setting](../v20.1/cluster-settings.html). [#45159][#45159] {% comment %}doc{% endcomment %}
- The [`ALTER TABLE .. ADD PRIMARY KEY ...`](../v20.1/alter-table.html) command can now be used when the target table has the default rowid [primary key](../v20.1/primary-key.html). [#45514][#45514] {% comment %}doc{% endcomment %}
- Hash joins and sorts are now run using the vectorized engine when `vectorize=auto` (default configuration). [#45582][#45582] {% comment %}doc{% endcomment %}
- The [optimizer](../v20.1/cost-based-optimizer.html) now considers the likely number of rows an operator will need to provide, and might choose query plans based on this. In particular, the optimizer might prefer [lookup joins](../v20.1/joins.html) over alternatives in some situations where all rows of the join will probably not be needed. [#45604][#45604]
- CockroachDB now supports string and byte array literals using the dollar-quoted notation, as documented [here](https://www.postgresql.org/docs/current/sql-syntax-lexical.html#SQL-SYNTAX-DOLLAR-QUOTING). [#44130][#44130] {% comment %}doc{% endcomment %}
- The cleanup job spawned by [`ALTER .. PRIMARY KEY`](../v20.1/alter-primary-key.html) in some cases cannot be cancelled. [#45595][#45595] {% comment %}doc{% endcomment %}
- Previously, when a [database was renamed](../v20.1/rename-database.html), any [table](../v20.1/create-table.html) referencing a [sequence](../v20.1/create-sequence.html) would be blocked from being able to rename the table. This is to block cases where if the table's reference to the sequence contains the database name, and the database name changes, we have no way of overwriting the table's reference to the sequence in the new database. However, if no database name is included in the sequence reference, we should continue to allow the database to rename, as is implemented with this change. [#45502][#45502] {% comment %}doc{% endcomment %}
- CockroachDB now supports expanding all columns of a tuple using the `.*` notation, for example: `SELECT (t).* FROM (SELECT (1,'b',2.3) AS t)`. This is a CockroachDB-specific extension. [#45609][#45609] {% comment %}doc{% endcomment %}
- CockroachDB now supports accessing the Nth column in a column with tuple type using the syntax `(...).@N`, for example: `SELECT (t).@2 FROM (SELECT (1,'b',2.3) AS t)`. This is a CockroachDB-specific extension. [#45609][#45609] {% comment %}doc{% endcomment %}
- The use of schema changes when a [primary key](../v20.1/primary-key.html) change is in progress is now disabled. This includes the following: (1) running a primary key change in a transaction and then starting another schema change in the same transaction, and (2) starting a primary key change on one connection and then starting a schema change on the same table on another connection while the initial primary key change is currently executing. [#45397][#45397] {% comment %}doc{% endcomment %}
- CockroachDB has now disabled [primary key](../v20.1/primary-key.html) changes when a concurrent schema change is executing on the same table, or if a schema change has been started on the same table in the current transaction. [#45513][#45513] {% comment %}doc{% endcomment %}
- [Usernames](../v20.1/create-user.html) can now contain periods, for compatibility with certificate managers that require domain names to be used as usernames. [#45575][#45575] {% comment %}doc{% endcomment %}
- You can now drop a [primary key](../v20.1/primary-key.html) as long as you add another primary key within the same [transaction](../v20.1/transactions.html). This feature is intended to be used when you do not want the existing primary key to be rewritten as a secondary index by [`ALTER PRIMARY KEY`](../v20.1/alter-primary-key.html). [#44511][#44511] {% comment %}doc{% endcomment %}
- [JSONB](../v20.1/jsonb.html) columns can now used in `GROUP BY` and `DISTINCT ON` clauses. [#45229][#45229] {% comment %}doc{% endcomment %}
- The experimental variable gating around usages of online primary key changes is now removed. [#45753][#45753] {% comment %}doc{% endcomment %}
- Duplicate rows in the input to an [`INSERT..ON CONFLICT DO NOTHING`](../v20.1/insert.html) statement will now be ignored rather than triggering an error. [#45443][#45443] {% comment %}doc{% endcomment %}
- [`USER`s](../v20.1/create-user.html) and [`ROLE`s](../v20.1/create-role.html) are now the same (which is PostgreSQL behavior). This means `CREATE`/`ALTER`/`DROP` `ROLE`/`USER` can be used interchangeably. [#44968][#44968] {% comment %}doc{% endcomment %}
- The [inverted index](../v20.1/inverted-indexes.html) implementation now supports indexing [array](../v20.1/array.html) columns. This permits accelerating containment queries (`@>` and `<@`) on array columns by adding an index to them. [#45157][#45157] {% comment %}doc{% endcomment %}
- CockroachDB now collects separate sets of metrics for usage of [`SAVEPOINT`](../v20.1/savepoint.html): one set for regular SQL savepoints and one set for uses dedicated to CockroachDB's client-side transaction retry protocol. [#45566][#45566]
- SQL [savepoints](../v20.1/savepoint.html) are now supported. `SAVEPOINT <foo>`, `RELEASE SAVEPOINT <foo>`, and `ROLLBACK TO SAVEPOINT <foo>` now work. `SHOW SAVEPOINT STATUS` can be used to inspect the current stack of active savepoints. [#45566][#45566]
- [`SELECT FOR UPDATE`](../v20.1/select-for-update.html) now hooks into a new leaseholder-only locking mechanism. This allows the feature to be used to improve performance of [transactions](../v20.1/transactions.html) that read, modify, and write contended to rows. Similarly, [`UPDATE`](../v20.1/update.html) statements now use this new mechanism by default, meaning that their performance under contention is improved. This is only enabled for `UPDATE` statements that can push their filter all the way into their key-value scan. To determine whether an `UPDATE` statement is implicitly using `SELECT FOR UPDATE` locking, look for a `locking strength` field in the `EXPLAIN` output for the statement. [#45701][#45701] {% comment %}doc{% endcomment %}
- Vectorized distributed flows and disk spilling now support the [`INTERVAL`](../v20.1/interval.html) type. [#45776][#45776] {% comment %}doc{% endcomment %}
- Queries with [`MERGE` join](../v20.1/joins.html) can now run via the vectorized engine when `vectorize` is set to `auto`. [#45784][#45784] {% comment %}doc{% endcomment %}
- [`EXPLAIN BUNDLE`](../v20.1/explain.html) can now be used to run a query and collect execution information in a support bundle, which can be downloaded via the Admin UI. [#45735][#45735] {% comment %}doc{% endcomment %}
- Hash aggregator is now supported in `vectorize=auto` mode. [#45832][#45832] {% comment %}doc{% endcomment %}
- Telemetry reporting has been added for the commands [`SHOW INDEXES`](../v20.1/show-index.html), [`SHOW QUERIES`](../v20.1/show-queries.html), [`SHOW JOBS`](../v20.1/show-jobs.html), and [`SHOW CONSTRAINTS`](../v20.1/show-constraints.html). [#45897][#45897]
- Introduced a temporary table cleanup job that runs once every periodically per cluster. It removes any temporary schemas and their related objects that did not get removed cleanly when the connection closed. This period can be changed by the [cluster setting](../v20.1/cluster-settings.html) `sql.temp_object_cleaner.cleanup_interval`, which defaults to 30 minutes. [#45669][#45669] {% comment %}doc{% endcomment %}
- Improved error messages when [importing mysql dump](../v20.1/migrate-from-mysql.html) data. [#45958][#45958]

### Command-line changes

- Added a new `default` option for the `--storage-engine` flag that respects the engine used last. [#45512][#45512] {% comment %}doc{% endcomment %}
- Some CLI [commands](../v20.1/cockroach-commands.html) now provide more details and/or a hint when they encounter an error. [#45575][#45575] {% comment %}doc{% endcomment %}
- CockroachDB now refuses to start if named time zones are not properly configured. It is possible to override this behavior for testing purposes, with the understanding that doing so will cause incorrect SQL results and other inconsistencies, using the environment variable `COCKROACH_INCONSISTENT_TIME_ZONES`. [#45640][#45640] {% comment %}doc{% endcomment %}
- `NOTICE` commands can now be sent by CockroachDB servers using the Postgres client/server protocol. We add notices for two basic cases: (1) [Creating a view](../v20.1/create-view.html) on a temporary table without using `TEMP VIEW` implicitly makes the view temporary. This now sets a notice, as per Postgres. (2) [`DROP INDEX`](../v20.1/drop-index.html) now prints information that indexes are not dropped immediately and instead dropped after GC TTL. These notices will print when using the CockroachDB CLI.  These notices can be disabled using the [cluster setting](../v20.1/cluster-settings.html) `sql.notices.enabled = false`. [#45679][#45679] {% comment %}doc{% endcomment %}
- The new [`cockroach demo`](../v20.1/cockroach-demo.html) flag `--insecure=false` starts a temporary, in-memory demo cluster in secure mode. [#45727][#45727] {% comment %}doc{% endcomment %}
- The [`cockroach debug zip`](../v20.1/cockroach-debug-zip.html) output now contains hex representation of marshaled jobs payload and progress as well table descriptors. This allows you to copy this string and unmarshal it when debugging. [#45721][#45721] {% comment %}doc{% endcomment %}
- Hostnames from the `cockroach start --join` flag can now be resolved as SRV record. This simplifies cluster deployment in Kubernetes. [#45815][#45815] {% comment %}doc{% endcomment %}
- When some result rows have already been received from the server when an error is encountered, the [CockroachDB SQL shell](../v20.1/cockroach-sql.html) now presents both the result rows and the error in the output, regardless of the selected table formatter. Previously, only the error was reported with some formatters, or both with other formatters. [#45872][#45872] {% comment %}doc{% endcomment %}
- CockroachDB will now dump the stacks of all goroutines upon receiving `SIGQUIT` prior to terminating. This feature is intended for use while troubleshooting misbehaving nodes. [#36378][#36378] {% comment %}doc{% endcomment %}
- The `--decommission` flag for [`cockroach quit`](../v20.1/cockroach-quit.html) is now deprecated. It will be removed altogether in a next stable release. Deployments should use [`cockroach node decommission`](../v20.1/cockroach-node.html) followed by either `cockroach quit` or an equivalent form of server shut down. [#45903][#45903] {% comment %}doc{% endcomment %}
- The `--socket` flag for [`cockroach start`](../v20.1/cockroach-start.html) is now deprecated in favor of `--socket-dir`. CockroachDB now automatically chooses a name for the socket in the specified directory based on the configured port number. `--socket` will be removed in a later version. [#45931][#45931] {% comment %}doc{% endcomment %}

### Admin UI changes

- The end point `/&#95;status/job/{job_id}` will now display status info about a job. [#45094][#45094] {% comment %}doc{% endcomment %}
- Removed mention of RocksDB from the Read Amplification, SSTables, Compactions/Flushes, and Compaction Queue graphs. [#45398][#45398]
- The display options are now saved separately for each authenticated user. **Note:** When upgrading to a version with this change, all current display customizations for admin users are lost. [#45127][#45127] {% comment %}doc{% endcomment %}
- Refactored redux data flow in enqueue range. [#45667][#45667]
- Increased enqueue range timeout to an hour to prevent operations from timing out before completion. [#45667][#45667]
- The pprof endpoints now allow downloading the binary profiles. To do so, attach `?download=true` to the URL. [#45790][#45790] {% comment %}doc{% endcomment %}
- Improved the debuggability of C++-level issues by providing access to thread stack traces via a new `/debug/threads` endpoint, which is exposed on the Admin UI advanced debug page. Now include thread stack traces in the info collected by `debug zip`. Thread stack traces are currently only available on Linux. [#45321][#45321] {% comment %}doc{% endcomment %}
- The Admin UI now reports a clearer message when a non-admin user uses an admin-only feature. [#45122][#45122]
- Added the Statement Diagnostics History page. [#45799][#45799]
- You can now access the Activate Diagnostics modal from the [Statements page](../v20.1/admin-ui-statements-page.html), through the **Activate** link. [#45799][#45799] {% comment %}doc{% endcomment %}
- Added a Release Notes subscription form on the [Cluster Overview page](../v20.1/admin-ui-cluster-overview-page.html). [#45143][#45143]

### Bug fixes

- Fixed an internal error that could occur when `NULLIF` was called with one null argument. [#45354][#45354]
- Fixed a bug where, in some rare cases, a job was not [cancellable](../v20.1/cancel-job.html) when in state "Reverting". [#45320][#45320]
- Fix a bug where `EXPERIMENTAL SCRUB TABLE` on a timestamp/timestamptz key does not work. [#45410][#45410]
- When considering if a job should be orphaned, CockroachDB use to take the conservative approach when a descriptor ID pointing to non-existent descriptor was found. This caused jobs to hang forever and be garbage collected. CockroachDB now disregards these IDs when considering if a job has still work to do. [#45353][#45353]
- Previously, [renaming a database](../v20.1/rename-database.html) with dependent [views](../v20.1/views.html) returned a misleading error message that implies it was a dependent view on a dependent table. Now the error message generically says `cannot rename relation ... as it depends on relation ...` instead. [#45427][#45427]
- Significantly reduced the amount of memory allocated while scanning tables with a large average row size. [#45323][#45323]
- Improved the ability of garbage collection to process ranges exhibiting abnormally large numbers of transaction records and/or abort span entries. [#45444][#45444]
- Some vectorized execution plans that used [lookup joins](../v20.1/joins.html) with decimals would previously return incorrect results. This is now fixed. [#45536][#45536]
- [`IMPORT INTO`](../v20.1/import-into.html) jobs which are canceled or fail can no longer get stuck in an unrecoverable state if data from the previous state of the table had expired relative to the GC TTL. [#44739][#44739]
- Long-running [transactions](../v20.1/transactions.html) which attempt to [`TRUNCATE`](../v20.1/truncate.html) can now be pushed and will commit in cases where they previously could fail or retry forever. [#44091][#44091]
- Previously, drivers that did not truncate trailing zeroes for decimals in the binary format end up having inaccuracies of up to 10^4 during the decode step. Fixed the error by truncating the trailing zeroes as appropriate. This fixes known incorrect decoding cases with Postgres in Elixir. [#45613][#45613]
- A bug in the range metrics collection would fail to correctly identify a range that had lost quorum, causing it to not be reported via the "unavailable ranges" metric. This is now fixed. [#45253][#45253]
- It is now possible to create [inverted indexes](../v20.1/inverted-indexes.html) on columns whose names are mixed-case. [#45621][#45621]
- Fixed a bug where a table without a [primary key](../v20.1/primary-key.html) and a column named `rowid` would throw an error when being created. [#45507][#45507]
- Customizations of the Admin UI are again properly saved across sessions. [#45127][#45127]
- Previously, an internal error could occur in CockroachDB when executing queries via the vectorized engine in queries that contained unordered synchronizers. This has been fixed. [#45690][#45690]
- Fixed a bug where the distinct operation on `ARRAY[NULL]` and `NULL` could sometimes return an incorrect result and omit some tuples. [#45229][#45229]
- Range garbage collection will now trigger based on a large abort span, adding defense-in-depth against ranges growing large (and eventually unstable). [#45573][#45573]
- Fixed cases where target column specifications in [`IMPORT INTO`](../v20.1/import-into.html) were ignored. [#45747][#45747]
- Previously, CockroachDB could crash when computing [window functions](../v20.1/window-functions.html) with the `RANGE` mode of framing when one of the bounds was either  `'offset PRECEDING'` or `'offset FOLLOWING'` and when there were `NULL` values in the single column from `ORDER BY` clause. Additionally, also in `RANGE` mode, bounds `'0 PRECEDING'` and `'0 FOLLOWING'` could be handled incorrectly. This is now fixed. [#44666][#44666]
- Verify column is now visible before accessing its datums. [#45801][#45801]
- Expected errors from the vectorized execution engine are no longer mistakenly annotated as unexpected errors. [#45673][#45673]
- Mixed type comparison or binary expressions that could have previously returned wrong results in the vectorized execution engine now fall back to using the row execution engine. [#45724][#45724]
- Fixed [decimal](../v20.1/decimal.html) rounding errors in the vectorized execution engine. [#45950][#45950]
- CockroachDB now correctly handles columns named with reserved keywords and/or other special characters. [#45944][#45944]
- Fixed the `"negative limit hint"` internal query error. [#45879][#45879]
- [`CHANGEFEED`](../v20.1/create-changefeed.html) jobs that take a long time to perform backfills will no longer encounter failures due to garbage collection, so long as they begin before the data has expired. [#45778][#45778]

### Performance improvements

- [Importing an Avro file](../v20.1/migrate-from-avro.html) is now faster. [#45269][#45269]
- Improved  the execution plans of [foreign key](../v20.1/foreign-key.html) checks for [`UPSERT`](../v20.1/upsert.html) and [`INSERT .. ON CONFLICT`](../v20.1/insert.html) in some cases (in particular multi-region). [#45520][#45520]
- [Importing](../v20.1/import.html) delimited data now has improved throughput. [#45543][#45543]
- Improved the selectivity estimation of some predicates containing `OR`, leading to better plan selection by the [optimizer](../v20.1/cost-based-optimizer.html). [#45732][#45732]
- Improved cardinality estimation in the [optimizer](../v20.1/cost-based-optimizer.html) for relations with a small number of rows. This leads to the optimizer choosing a better query plan in some cases. [#45771][#45771]
- `crdb_internal.jobs` now loads less data into memory. [#45914][#45914]

### Doc updates

- Upgraded the search on the docs site. [#6692][#6692]
- Added docs for `--storage-engine` flag on [node start](../v20.1/cockroach-start.html), which can be `pebble`, `rocksdb`, or `default`, which makes the `--storage-engine` flag sticky for future runs when no engine is specified. [#6769][#6769]
- Added examples of `COMMENT ON TABLE` in `SHOW CREATE TABLE` output to [`COMMENT ON`](../v20.1/comment-on.html), [`SHOW TABLES`](../v20.1/show-tables.html), and [`SHOW CREATE`](../v20.1/show-create.html). [#6789][#6789]
- Added the "Duplicate Indexes" Youtube video to the [Duplicate Indexes Topology doc](../v20.1/topology-duplicate-indexes.html). [#6796][#6796]
- Updated the [`cockroach demo`](../v20.1/cockroach-demo.html) doc to include new flags. [#6841][#6841]

### Contributors

This release includes 289 merged PRs by 40 authors. We would like to thank the following contributors from the CockroachDB community:

- Andrii Vorobiov
- Artem Barger
- Damien Hollis (first-time contributor)
- Jaewan Park
- Ziheng Liu (first-time contributor)

[#36378]: https://github.com/cockroachdb/cockroach/pull/36378
[#44091]: https://github.com/cockroachdb/cockroach/pull/44091
[#44130]: https://github.com/cockroachdb/cockroach/pull/44130
[#44232]: https://github.com/cockroachdb/cockroach/pull/44232
[#44391]: https://github.com/cockroachdb/cockroach/pull/44391
[#44511]: https://github.com/cockroachdb/cockroach/pull/44511
[#44666]: https://github.com/cockroachdb/cockroach/pull/44666
[#44739]: https://github.com/cockroachdb/cockroach/pull/44739
[#44962]: https://github.com/cockroachdb/cockroach/pull/44962
[#44968]: https://github.com/cockroachdb/cockroach/pull/44968
[#45082]: https://github.com/cockroachdb/cockroach/pull/45082
[#45084]: https://github.com/cockroachdb/cockroach/pull/45084
[#45094]: https://github.com/cockroachdb/cockroach/pull/45094
[#45114]: https://github.com/cockroachdb/cockroach/pull/45114
[#45122]: https://github.com/cockroachdb/cockroach/pull/45122
[#45127]: https://github.com/cockroachdb/cockroach/pull/45127
[#45143]: https://github.com/cockroachdb/cockroach/pull/45143
[#45157]: https://github.com/cockroachdb/cockroach/pull/45157
[#45159]: https://github.com/cockroachdb/cockroach/pull/45159
[#45193]: https://github.com/cockroachdb/cockroach/pull/45193
[#45201]: https://github.com/cockroachdb/cockroach/pull/45201
[#45227]: https://github.com/cockroachdb/cockroach/pull/45227
[#45229]: https://github.com/cockroachdb/cockroach/pull/45229
[#45253]: https://github.com/cockroachdb/cockroach/pull/45253
[#45255]: https://github.com/cockroachdb/cockroach/pull/45255
[#45260]: https://github.com/cockroachdb/cockroach/pull/45260
[#45269]: https://github.com/cockroachdb/cockroach/pull/45269
[#45314]: https://github.com/cockroachdb/cockroach/pull/45314
[#45320]: https://github.com/cockroachdb/cockroach/pull/45320
[#45321]: https://github.com/cockroachdb/cockroach/pull/45321
[#45323]: https://github.com/cockroachdb/cockroach/pull/45323
[#45325]: https://github.com/cockroachdb/cockroach/pull/45325
[#45326]: https://github.com/cockroachdb/cockroach/pull/45326
[#45353]: https://github.com/cockroachdb/cockroach/pull/45353
[#45354]: https://github.com/cockroachdb/cockroach/pull/45354
[#45365]: https://github.com/cockroachdb/cockroach/pull/45365
[#45368]: https://github.com/cockroachdb/cockroach/pull/45368
[#45372]: https://github.com/cockroachdb/cockroach/pull/45372
[#45397]: https://github.com/cockroachdb/cockroach/pull/45397
[#45398]: https://github.com/cockroachdb/cockroach/pull/45398
[#45410]: https://github.com/cockroachdb/cockroach/pull/45410
[#45427]: https://github.com/cockroachdb/cockroach/pull/45427
[#45443]: https://github.com/cockroachdb/cockroach/pull/45443
[#45444]: https://github.com/cockroachdb/cockroach/pull/45444
[#45502]: https://github.com/cockroachdb/cockroach/pull/45502
[#45507]: https://github.com/cockroachdb/cockroach/pull/45507
[#45512]: https://github.com/cockroachdb/cockroach/pull/45512
[#45513]: https://github.com/cockroachdb/cockroach/pull/45513
[#45514]: https://github.com/cockroachdb/cockroach/pull/45514
[#45520]: https://github.com/cockroachdb/cockroach/pull/45520
[#45536]: https://github.com/cockroachdb/cockroach/pull/45536
[#45541]: https://github.com/cockroachdb/cockroach/pull/45541
[#45543]: https://github.com/cockroachdb/cockroach/pull/45543
[#45566]: https://github.com/cockroachdb/cockroach/pull/45566
[#45573]: https://github.com/cockroachdb/cockroach/pull/45573
[#45575]: https://github.com/cockroachdb/cockroach/pull/45575
[#45580]: https://github.com/cockroachdb/cockroach/pull/45580
[#45582]: https://github.com/cockroachdb/cockroach/pull/45582
[#45595]: https://github.com/cockroachdb/cockroach/pull/45595
[#45604]: https://github.com/cockroachdb/cockroach/pull/45604
[#45609]: https://github.com/cockroachdb/cockroach/pull/45609
[#45613]: https://github.com/cockroachdb/cockroach/pull/45613
[#45621]: https://github.com/cockroachdb/cockroach/pull/45621
[#45640]: https://github.com/cockroachdb/cockroach/pull/45640
[#45652]: https://github.com/cockroachdb/cockroach/pull/45652
[#45663]: https://github.com/cockroachdb/cockroach/pull/45663
[#45667]: https://github.com/cockroachdb/cockroach/pull/45667
[#45669]: https://github.com/cockroachdb/cockroach/pull/45669
[#45673]: https://github.com/cockroachdb/cockroach/pull/45673
[#45679]: https://github.com/cockroachdb/cockroach/pull/45679
[#45690]: https://github.com/cockroachdb/cockroach/pull/45690
[#45697]: https://github.com/cockroachdb/cockroach/pull/45697
[#45701]: https://github.com/cockroachdb/cockroach/pull/45701
[#45712]: https://github.com/cockroachdb/cockroach/pull/45712
[#45721]: https://github.com/cockroachdb/cockroach/pull/45721
[#45724]: https://github.com/cockroachdb/cockroach/pull/45724
[#45727]: https://github.com/cockroachdb/cockroach/pull/45727
[#45728]: https://github.com/cockroachdb/cockroach/pull/45728
[#45732]: https://github.com/cockroachdb/cockroach/pull/45732
[#45735]: https://github.com/cockroachdb/cockroach/pull/45735
[#45747]: https://github.com/cockroachdb/cockroach/pull/45747
[#45753]: https://github.com/cockroachdb/cockroach/pull/45753
[#45764]: https://github.com/cockroachdb/cockroach/pull/45764
[#45767]: https://github.com/cockroachdb/cockroach/pull/45767
[#45771]: https://github.com/cockroachdb/cockroach/pull/45771
[#45776]: https://github.com/cockroachdb/cockroach/pull/45776
[#45778]: https://github.com/cockroachdb/cockroach/pull/45778
[#45784]: https://github.com/cockroachdb/cockroach/pull/45784
[#45790]: https://github.com/cockroachdb/cockroach/pull/45790
[#45791]: https://github.com/cockroachdb/cockroach/pull/45791
[#45799]: https://github.com/cockroachdb/cockroach/pull/45799
[#45801]: https://github.com/cockroachdb/cockroach/pull/45801
[#45815]: https://github.com/cockroachdb/cockroach/pull/45815
[#45832]: https://github.com/cockroachdb/cockroach/pull/45832
[#45858]: https://github.com/cockroachdb/cockroach/pull/45858
[#45859]: https://github.com/cockroachdb/cockroach/pull/45859
[#45870]: https://github.com/cockroachdb/cockroach/pull/45870
[#45872]: https://github.com/cockroachdb/cockroach/pull/45872
[#45879]: https://github.com/cockroachdb/cockroach/pull/45879
[#45897]: https://github.com/cockroachdb/cockroach/pull/45897
[#45903]: https://github.com/cockroachdb/cockroach/pull/45903
[#45914]: https://github.com/cockroachdb/cockroach/pull/45914
[#45917]: https://github.com/cockroachdb/cockroach/pull/45917
[#45931]: https://github.com/cockroachdb/cockroach/pull/45931
[#45944]: https://github.com/cockroachdb/cockroach/pull/45944
[#45950]: https://github.com/cockroachdb/cockroach/pull/45950
[#45958]: https://github.com/cockroachdb/cockroach/pull/45958
[#45969]: https://github.com/cockroachdb/cockroach/pull/45969
[#6692]: https://github.com/cockroachdb/docs/pull/6692
[#6769]: https://github.com/cockroachdb/docs/pull/6769
[#6789]: https://github.com/cockroachdb/docs/pull/6789
[#6796]: https://github.com/cockroachdb/docs/pull/6796
[#6841]: https://github.com/cockroachdb/docs/pull/6841
