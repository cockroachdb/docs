---
title: What&#39;s New in v21.1.0
toc: true
summary: Additions and changes in CockroachDB version v21.1.0.
---

## May 18, 2021

With the release of CockroachDB v21.1, we've made a variety of productivity, management, and performance improvements. Check out a [summary of the most significant user-facing changes](#feature-summary) and then [upgrade to CockroachDB v21.1](../v21.1/upgrade-cockroach-version.html).

To learn more:

- Read the **v21.1 blog post** (link TBD)
- Join a v21.1 overview and live demo session on XXX:

## Downloads

<div id="os-tabs" class="filters clearfix">
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.0.linux-amd64.tgz"><button id="linux" class="filter-button" data-scope="linux" data-eventcategory="linux-binary-release-notes">Linux</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.0.darwin-10.9-amd64.tgz"><button id="mac" class="filter-button" data-scope="mac" data-eventcategory="mac-binary-release-notes">Mac</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.0.windows-6.2-amd64.zip"><button id="windows" class="filter-button" data-scope="windows" data-eventcategory="windows-binary-release-notes">Windows</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v21.1.0.src.tgz"><button id="source" class="filter-button" data-scope="source" data-eventcategory="source-release-notes">Source</button></a>
</div>

<section class="filter-content" data-scope="windows">
{% include windows_warning.md %}
</section>

## Docker image

{% include copy-clipboard.html %}
~~~ shell
$ docker pull cockroachdb/cockroach:v21.1.0
~~~

## CockroachCloud

- <a href="https://cockroachlabs.cloud/signup?referralId=docs_crdb_release_notes" rel="noopener" target="_blank">Get a free v21.1 cluster on CockroachCloud</a>
- Learn about recent updates to CockroachCloud in the [CockroachCloud Release Notes](index-cockroachcloud.html)

## Feature summary

This section summarizes the most significant user-facing changes in v21.1.0. For a complete list of features and changes, including bug fixes and performance improvements, see the [release notes](index.html#testing-releases) for previous testing releases. You can also search for [what's new in v21.1 in our docs](../search.html?query=%22New%20in%20v21.1%22&page=2).

- [Enterprise features](#enterprise-features)
- [Core features](#core-features)
- [Backward-incompatible changes](#backward-incompatible-changes)
- [Deprecations](#deprecations)
- [Known limitations](#known-limitations)
- [Education](#education)

<style>
    table td:first-child {
        min-width: 100px !important;
    }
    table td:nth-child(2) {
        min-width: 200px !important;
    }
</style>

### Enterprise features

These features require an [enterprise license](https://www.cockroachlabs.com/get-cockroachdb/). Use [`cockroach demo`](../v21.1/cockroach-demo.html) to test enterprise features in a local, temporary cluster.

Area | Feature | Description
--------|---------|------------
SQL | **Multi-Region Improvements** | It is now much easier to leverage CockroachDB's low-latency, resilient multi-region capabilities. For an introduction to the high-level concepts, see the [Multi-Region Overview](../v21.1/multiregion-overview.html). For further details and links to related SQL statements, see [Choosing a Multi-Region Configuration](../v21.1/choosing-a-multi-region-configuration.html), [When to Use ZONE vs. REGION Survival Goals](../v21.1/when-to-use-zone-vs-region-survival-goals.html), and [When to Use REGIONAL vs. GLOBAL Tables](../v21.1/when-to-use-regional-vs-global-tables.html). For a demonstration of these capabilities using a local cluster, see the [Multi-Region Tutorial](../v21.1/demo-low-latency-multi-region-deployment.html). Finally, for details about related architectural enhancements, see [Non-Voting Replicas](../v21.1/architecture/replication-layer.html#non-voting-replicas) and [Non-Blocking Transactions](../v21.1/transaction-layer.html#non-blocking-transactions).
SQL | **Automatic Follower Reads for Read-Only Transactions** | You can now force all read-only transactions in a session to use [follower reads](../v21.1/follower-reads.html) by setting the new [`default_transaction_use_follow_reads` session variable](../v21.1/show-vars.html#supported-variables) to `on`.
I/O | **Changefeed Topic Naming Improvements** | New [`CHANGEFEED` options](../v21.1/create-changefeed.html#options) give you more control over topic naming: The `full_table_name` option lets you use a fully-qualified table name in topics, subjects, schemas, and record output instead of the default table name, and can prevent unintended behavior when the same table name is present in multiple databases. The `avro_schema_prefix` option lets you use a fully-qualified schema name for a table instead of the default table name, and makes it possible for multiple databases or clusters to share the same schema registry when the same table name is present in multiple databases.

### Core features

These features are freely available in the core version and do not require an enterprise license.

Area | Feature | Description
--------|---------|------------
SQL | **Query Observability Improvements** | [`EXPLAIN`](../v21.1/explain.html) and [`EXPLAIN ANALYZE`](../v21.1/explain-analyze.html) responses have been unified and extended with additional details, including automatic statistics-backed row estimates for `EXPLAIN`, and maximum memory usage, network usage, nodes used per operator, and rows used per operator for `EXPLAIN ANALYZE`. `EXPLAIN ANALYZE` now outputs a text-based statement plan tree by default, showing statistics about the statement processors at each phase of the statement. The [**Transactions**](../v21.1/ui-transactions-page.html) and [**Statements**](../v21.1/ui-statements-page.html) pages of the DB Console also include such details as well the mean average time statements were in contention with other transactions within a specified time interval. The [**SQL Dashboard**](../v21.1/ui-sql-dashboard.html) has been expanded with additional graphs for latency, contention, memory, and network traffic. The [SQL Tuning with `EXPLAIN`](../v21.1/sql-tuning-with-explain.html) tutorial and [`Optimize Statement Performance`](../v21.1/make-queries-fast.html) guidance have been updated to leverage these improvements.  
SQL | **Inverted Joins** | CockroachDB now supports [inverted joins](../v21.1/joins.html#inverted-joins), which force the optimizer to use an inverted index on the right side of the join. Inverted joins can only be used with `INNER` and `LEFT` joins.
SQL | **Partial Inverted Indexes** | You can now create a [partial inverted index](../v21.1//inverted-indexes.html#partial-inverted-indexes) on a subset of `JSON`, `ARRAY`, or geospatial container column data.
SQL | **Virtual Computed Columns** | You can now create [virtual computed column](../v21.1/computed-columns.html), which are not stored on disk and are recomputed as the column data in the expression changes.
SQL | **Renaming and Dropping User-Defined Types** | It's now possible to [rename a user-defined type](../v21.1/alter-type.html#rename-a-user-defined-type) and [drop a value in a user-defined type](../v21.1/alter-type.html#drop-a-value-in-a-user-defined-type).
SQL | **Sequence Caching** | You can now create a sequence with the [`CACHE`](../v21.1/create-sequence.html#cache-sequence-values-in-memory) keyword to have the sequence cache its values in memory.  
SQL | **Changing Sequence & View Ownership** | You can use the new `OWNER TO` parameter to change the owner of a [sequence](../v21.1/alter-sequence.html) or [view](../v21.1/alter-view.html).  
SQL | **Show `CREATE` Statements for the Current Database** | You can now use [`SHOW CREATE ALL TABLES`](show-create.html#show-the-statements-needed-to-recreate-all-tables-views-and-sequences-in-the-current-database) to return the `CREATE` statements for all of the tables, views, and sequences in the current database.
Dev Tools | **ORM Compatibility for Spatial** | [Spatial libraries for Hibernate, ActiveRecord, and Django](../v21.1/spatial-data.html#orm-compatibility) are now fully compatible with CockroachDB's spatial features.
Dev Tools | **Connection Pooling Guidance** | Creating the appropriate size pool of connections is critical to gaining maximum performance in an application. For guidance on sizing, validating, and using connection pools with CockroachDB, as well as examples for Java and Go applications, see [Use Connection Pools](../v21.1/use-connection-pools.html).
I/O | **Running Jobs Asynchronously** | You can use the new `DETACHED` option to run [`BACKUP`](../v21.1/backup.html#options), [`RESTORE`](../v21.1/restore.html#options), and [`IMPORT`](../v21.1/import.html#options) jobs asynchronously, returning the job ID immediately without waiting for the job to finish. This option enables you to run such jobs within transactions.
I/O | **Import from Local Dump File** | The new [`cockroach import`](../v21.1/cockroach-import.html) command imports a database or table from a local `PGDUMP` or `MYSQLDUMP` file into a running cluster. This is useful for quick imports of 15MB or smaller. For larger imports, use the [`IMPORT`](../v21.1/import.html) statement.
I/O | **Additional Import Options** | New [`IMPORT` options](../v21.1/import.html#options) give you more control over the import process's behavior: The `row_limit` option limits the number of rows to import, which is useful for finding errors quickly before executing a more time- and resource-consuming import; the `ignore_unsupported_statements` option ignores SQL statements in `PGDUMP` files that are unsupported by CockroachDB; and the `log_ignored_statements` option logs unsupported statements to cloud storage or userfile storage when `ignore_unsupported_statements`.
Recovery | **Re-validating Indexes During `RESTORE`** | Incremental backups created by v20.2.2 and prior v20.2.x releases or v20.1.4 and prior v20.1.x releases may include incomplete data for indexes that were in the process of being created. Therefore, when incremental backups taken by these versions are restored by v21.1.0, any indexes created during those incremental backups will be re-validated by [`RESTORE`](../v21.1/restore.html#restore-from-incremental-backups).
Operations | **Logging Improvements** | Log events are now organized into [logging channels](../v21.1/logging-overview.html) that address different [use cases](../v21.1/logging-use-cases.html). Logging channels can be freely mapped to log sinks and routed to destinations outside CockroachDB (including external log collectors). All logging aspects, including message format (e.g., JSON), are now [configurable](../v21.1/configure-logs.html) via YAML.
Operations | **Cluster API v2.0** | This [new API](../v21.1/cluster-api.html) for monitoring clusters and nodes builds on prior endpoints, offering a consistent REST interface that's easier to use with your choice of tooling. The API offers a streamlined authentication process and developer-friendly [reference documentation](../api/cluster/v2.html).
Operations | **Automated TLS Cert Setup** | Using the new `cockroach connect` command and a secure token you provide, you can now [automate the creation and distribution of a cluster's CA (certificate authority) and node certificates](../v21.1/auto-tls.html). Note that this feature is an alpha release with core functionality that may not meet your requirements.
Operations | **Built-in Timezone Library** | The CockroachDB binary now includes a copy of the [`tzdata` library](../v21.1/recommended-production-settings.html#dependencies), which is required by certain features that use time zone data. If CockroachDB can't find the `tzdata` library externally, it will now use this built-in copy.  

### Backward-incompatible changes

Before [upgrading to CockroachDB v21.1](../v20.1/upgrade-cockroach-version.html), be sure to review the following backward-incompatible changes and adjust your deployment as necessary.

- Rows containing empty arrays in [`ARRAY`](../v21.1/array.html) columns are now contained in [inverted indexes](../v21.1/inverted-indexes.html). This change is backward-incompatible because prior versions of CockroachDB will not be able to recognize and decode keys for empty arrays. Note that rows containing `NULL` values in an indexed column will still not be included in inverted indexes.
- Concatenation between a non-null argument and a null argument is now typed as string concatenation, whereas it was previously typed as array concatenation. This means that the result of `NULL || 1` will now be `NULL` instead of `{1}`. To preserve the old behavior, the null argument can be casted to an explicit type.
- The payload fields for certain event types in `system.eventlog` have been changed and/or renamed. Note that the payloads in `system.eventlog` were an undocumented, reserved feature so no guarantee was made about cross-version compatibility to this point. The list of changes includes (but is not limited to):
  - `TargetID` has been renamed to `NodeID` for `node_join`.
  - `TargetID` has been renamed to `TargetNodeID` for `node_decommissioning` / `node_decommissioned` / `node_recommissioned`.
  - `NewDatabaseName` has been renamed to `NewDatabaseParent` for `convert_to_schema`.
  - `grant_privilege` and `revoke_privilege` have been removed; they are replaced by `change_database_privilege`, `change_schema_privilege`, `change_type_privilege`, and `change_table_privilege`. Each event only reports a change for one user/role, so the `Grantees` field was renamed to `Grantee`.
  - Each `drop_role` event now pertains to a single [user/role](../v21.1/authorization.html#sql-users).
- The connection and authentication logging enabled by the [cluster settings](../v21.1/cluster-settings.html) `server.auth_log.sql_connections.enabled` and `server.auth_log.sql_sessions.enabled` was previously using a text format which was hard to parse and integrate with external monitoring tools. This has been changed to use the standard notable event mechanism, with standardized payloads. The output format is now structured; see the [reference documentation](../v21.1/eventlog.html) for details about the supported event types and payloads.
- The logging format for [SQL audit](../v21.1/sql-audit-logging.html), [execution](../v21.1/query-behavior-troubleshooting.html#cluster-wide-execution-logs), and [query](../v21.1/query-behavior-troubleshooting.html#slow-query-logs) logs has changed from a crude space-delimited format to JSON. To opt out of this new behavior and restore the pre-v21.1 logging format, you can set the [cluster setting](../v21.1/cluster-settings.html) `sql.log.unstructured_entries.enabled` to `true`.
- The [`cockroach debug ballast`](../v21.1/cockroach-debug-ballast.html) command now refuses to overwrite the target ballast file if it already exists. This change is intended to prevent mistaken uses of the `ballast` command by operators. Scripts that integrate `cockroach debug ballast` can consider adding a `rm` command.
- Removed the `kv.atomic_replication_changes.enabled` [cluster setting](../v21.1/cluster-settings.html). All replication changes on a range now use joint-consensus.

### Deprecations

- The CLI flags `--log-dir`, `--log-file-max-size`, `--log-file-verbosity`, `--log-group-max-size` are deprecated. Logging configuration can now be specified via the `--log` parameter. See the documentation for details.  
- The client-side command `\show` for the [SQL shell](../v21.1/cockroach-sql.html#commands) is deprecated in favor of the new command `\p`. This prints the contents of the query buffer entered so far.

### Known limitations

For information about new and unresolved limitations in CockroachDB v21.1, with suggested workarounds where applicable, see [Known Limitations](../v21.1/known-limitations.html).

### Education

Area | Topic | Description
-----|-------|------------
