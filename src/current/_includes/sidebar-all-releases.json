{%- assign today = "today" | date: "%Y-%m-%d" -%}
{%- comment -%} set today's date {%- endcomment -%}

{%- assign v_prod = site.data.versions | where_exp: "v_prod", "v_prod.asst_supp_exp_date > today" | where_exp: "v_prod", "v_prod.release_date != 'N/A'" | where_exp: "v_prod", "v_prod.major_version != site.versions['stable']" | sort: "release_date" | reverse | map: "major_version" -%}
{%- comment -%} v_prod iterates through the list of major versions (e.g., v21.2) in _data/versions.csv and returns all releases within the assistance support period, sorted in reverse chronological order, excluding whatever's the latest stable production release. We then pull only the major version name instead of the whole dictionary with map: "major_version" {%- endcomment -%}

{
  "title": "CockroachDB",
  "items": [
    {
      "title": "All Releases",
      "urls": [
        "/releases/index.html"
      ]
    }{% for x in v_prod %} {% comment %} iterate through all supported versions {% endcomment %}
      ,{
        "title": "{{ x }}",
        "urls": [
          "/releases/{{ x }}.html"
        ]
      }{% endfor %}    
  ]
},
{
  "title": "CockroachDB Kubernetes Operator",
  "urls": [
    "/releases/kubernetes-operator.html"
  ]
},
{
  "title": "Release Support Policy",
  "urls": [
    "/releases/release-support-policy.html"
  ]
},
{
  "title": "Known Limitations",
  "urls": [
    "/${VERSION}/known-limitations.html"
  ]
},
{% assign advisories = site.pages | where_exp: "advisories", "advisories.path contains 'advisories'" | where_exp: "advisories", "advisories.index != 'true'" %}
{
 "title": "Technical Advisories",
 "urls": [
    "/advisories/index.html"
   {% for x in advisories %}
    ,"{{ x.url }}"
   {% endfor %}
 ]
}
