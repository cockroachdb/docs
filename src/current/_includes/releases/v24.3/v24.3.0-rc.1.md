## v24.3.0-rc.1

Release Date: November 13, 2024

{% include releases/new-release-downloads-docker-image.md release=include.release %}

<h3 id="v24-3-0-rc-1-security-updates">Security updates</h3>

- All cluster settings that accept strings are now fully redacted when transmitted as part of our diagnostics telemetry. This payload includes a record of modified cluster settings and their values when they are not strings. Customers who previously applied the mitigations in Technical Advisory 133479 can safely set the value of cluster setting `server.redact_sensitive_settings.enabled` to false and turn on diagnostic reporting via the `diagnostics.reporting.enabled` cluster setting without leaking sensitive cluster settings values. [#134018][#134018]
- Previously if ldap connection was closed by server and we tried to perform bind or any other operation over reset connection, we got an error log saying: ``` "LDAP authentication: unable to find LDAP user distinguished name\nerror when searching for user in LDAP server: LDAP search failed: LDAP bind failed: ‹LDAP Result Code 200 \"Network Error\"›: ‹ldap: connection closed›" ``` This fix automatically handles closed connections and performs redial on behalf of the client if it finds connection was reset. [#134277][#134277]

<h3 id="v24-3-0-rc-1-general-changes">General changes</h3>

- COCKROACH_SKIP_ENABLING_DIAGNOSTIC_REPORTING is no longer mentioned in the demo command. [#134089][#134089]

<h3 id="v24-3-0-rc-1-sql-language-changes">SQL language changes</h3>

- It is now possible to execute row-level AFTER triggers in response to mutations on a table. Row-level AFTER triggers fire after checks and cascades for the query have completed. [#133320][#133320]
- Cascades can now fire row-level BEFORE triggers. By default, attempting to modify or eliminate the cascading update/delete will result in a `Triggered Data Change Violation` error. Users that wish to do this anyway can set `unsafe_allow_triggers_modifying_cascades`. Note that doing so could result in constraint violations, similar to Postgres. [#134444][#134444]

<h3 id="v24-3-0-rc-1-operational-changes">Operational changes</h3>

- The kvadmission.low_pri_read_elastic_control.enabled has been removed as all bulk requests are now subject to eleastic admission by default. Epic: https://cockroachlabs.atlassian.net/browse/CRDB-39798. [#134486][#134486]

<h3 id="v24-3-0-rc-1-db-console-changes">DB Console changes</h3>

- The v2 db pages will only be available post ugprade finalization to 24.3. Prior to that we'll continue to show the legacy page when the cluster is in its unfinalized state. [#134244][#134244]
- Users may access DB Console's db pages (db overview, tables overview, table details) if they have CONNECT privilege on the database. [#134542][#134542]

<h3 id="v24-3-0-rc-1-bug-fixes">Bug fixes</h3>

- String constants can now be compared against collated strings. [#134086][#134086]
- Previously, when executing queries with index / lookup joins when the ordering needs to be maintained, CockroachDB in some cases could get into a pathological behavior which would lead to increased query latency, possibly by several orders of magnitude. This bug was introduced in 22.2 and is now fixed. [#134367][#134367]
- Upsert statements on regional by row tables under non-serializable isolations now show uniqueness constraints in explain output (the constraints were already being enforced). [#134267][#134267]
- Fixed a minor bug where DISCARD ALL statements were counted under the sql.ddl.count metric. Now these will be counted under the sql.misc.count metric. [#134510][#134510]
- Fixed AWS backup/restore with kms failing due to missing shared config. [#134536][#134536]
- Uniqueness constraints enforced with tombstone writes are now reflected in EXPLAIN (OPT) output. [#134482][#134482]
- This patch allows a user to run schema changes on a restored table that was previously apart of an LDR stream. [#134675][#134675]

<h3 id="v24-3-0-rc-1-performance-improvements">Performance improvements</h3>

- The optimizer now generates more efficient query plans involving inverted indexes for queries with a conjunctive filter on the same JSON or ARRAY column, e.g., `SELECT * FROM t WHERE j->'a' = '10' AND j->'b' = '20'`. [#134002][#134002]

<h3 id="v24-3-0-rc-1-build-changes">Build changes</h3>

- Upgrade to Go 1.22.8 [#134427][#134427]

<h3 id="v24-3-0-rc-1-miscellaneous">Miscellaneous</h3>

<h4 id="v24-3-0-rc-1-missing-category">Missing category</h4>

- This patch adds the following LDR metrics  - logical_replication.catchup_ranges: the number of source side ranges    conducting catchup scans.  -logical_replication.scanning_ranges: the number source side ranges conducting   initial scans. Note that in the dbconsole, these metrics are not accurate if multiple LDR jobs are running, though there exists the equivalent labeled metrics for a user to consume via prometheus. [#134674][#134674]

<h4 id="v24-3-0-rc-1-changes-without-release-note-annotation">Changes without release note annotation</h4>

- [#134645][#134645] [a9d476499][a9d476499] Revert "release-24.3: workloadccl: update backup/restore syntax"
- [#134448][#134448] [116bc0218][116bc0218] release-24.3: roachtest: properly set error in Get/Put
- [#134097][#134097] [be4cf6cbf][be4cf6cbf] release-24.3: cluster-ui: publish 24.3.0 cluster-ui pkg
- [#133997][#133997] [a9bfd6bc5][a9bfd6bc5] release-24.3: roachtest: small mvt test fixes

<h3 id="v24-3-0-rc-1-doc-updates">Doc updates</h3>

{% comment %}Docs team: Please add these manually.{% endcomment %}



[#133320]: https://github.com/cockroachdb/cockroach/pull/133320
[#133997]: https://github.com/cockroachdb/cockroach/pull/133997
[#134002]: https://github.com/cockroachdb/cockroach/pull/134002
[#134018]: https://github.com/cockroachdb/cockroach/pull/134018
[#134086]: https://github.com/cockroachdb/cockroach/pull/134086
[#134089]: https://github.com/cockroachdb/cockroach/pull/134089
[#134097]: https://github.com/cockroachdb/cockroach/pull/134097
[#134244]: https://github.com/cockroachdb/cockroach/pull/134244
[#134267]: https://github.com/cockroachdb/cockroach/pull/134267
[#134277]: https://github.com/cockroachdb/cockroach/pull/134277
[#134367]: https://github.com/cockroachdb/cockroach/pull/134367
[#134427]: https://github.com/cockroachdb/cockroach/pull/134427
[#134444]: https://github.com/cockroachdb/cockroach/pull/134444
[#134448]: https://github.com/cockroachdb/cockroach/pull/134448
[#134482]: https://github.com/cockroachdb/cockroach/pull/134482
[#134486]: https://github.com/cockroachdb/cockroach/pull/134486
[#134510]: https://github.com/cockroachdb/cockroach/pull/134510
[#134536]: https://github.com/cockroachdb/cockroach/pull/134536
[#134542]: https://github.com/cockroachdb/cockroach/pull/134542
[#134645]: https://github.com/cockroachdb/cockroach/pull/134645
[#134674]: https://github.com/cockroachdb/cockroach/pull/134674
[#134675]: https://github.com/cockroachdb/cockroach/pull/134675
[116bc0218]: https://github.com/cockroachdb/cockroach/commit/116bc0218
[a9bfd6bc5]: https://github.com/cockroachdb/cockroach/commit/a9bfd6bc5
[a9d476499]: https://github.com/cockroachdb/cockroach/commit/a9d476499
[be4cf6cbf]: https://github.com/cockroachdb/cockroach/commit/be4cf6cbf
