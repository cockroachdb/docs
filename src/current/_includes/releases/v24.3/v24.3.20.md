## v24.3.20

Release Date: September 19, 2025

{% include releases/new-release-downloads-docker-image.md release=include.release %}

<h3 id="v24-3-20-sql-language-changes">SQL language changes</h3>

- When `sql_safe_updates` is enabled, the `ALTER TABLE ... LOCALITY` statement will be blocked when trying to convert an existing table to `REGIONAL BY ROW`, unless a region column has been added to the table. This protects against undesired behavior that caused `UPDATE` or `DELETE` statements to fail against the table while the locality change was in progress. [#152602][#152602]

<h3 id="v24-3-20-bug-fixes">Bug fixes</h3>

- Fixed a bug where invalid default expressions could cause backfilling schema changes to retry forever. [#147015][#147015]
- Fixed a bug that could cause excessive memory allocations when compacting timeseries keys. [#151813][#151813]
- Fixed a bug where updating column default expressions would incorrectly remove sequence ownerships for the affected column. [#152313][#152313]
- Fixed a bug that allowed foreign-key violations to result from some combinations of concurrent `READ COMMITTED` and `SERIALIZABLE` transactions. If both `SERIALIZABLE` and weaker-isolation transactions will concurrently modify rows involved in foreign-key relationships, the `SERIALIZABLE` transactions must have the following session variables set in order to prevent any possible foreign-key violations: 
  - `SET enable_implicit_fk_locking_for_serializable = on;`
  - `SET enable_shared_locking_for_serializable = on;`
  - `SET enable_durable_locking_for_serializable = on;` [#152376][#152376]
- Added an automatic repair for dangling or invalid entries in the `system.comments` table. [#152468][#152468]
- Fixed a bug where views could not reference the `crdb_region` column from their underlying tables in expressions. [#152742][#152742]

<h3 id="v24-3-20-performance-improvements">Performance improvements</h3>

- Lookup joins can now be used on tables with virtual columns even if the type of the search argument is not identical to the column type referenced in the virtual column. [#152630][#152630]

<h3 id="v24-3-20-miscellaneous">Miscellaneous</h3>

- Tunes S3 client retry behavior to be more reliable in the
  presence of correlated errors. [#151875][#151875]


[#152742]: https://github.com/cockroachdb/cockroach/pull/152742
[#152630]: https://github.com/cockroachdb/cockroach/pull/152630
[#152602]: https://github.com/cockroachdb/cockroach/pull/152602
[#152313]: https://github.com/cockroachdb/cockroach/pull/152313
[#152376]: https://github.com/cockroachdb/cockroach/pull/152376
[#152468]: https://github.com/cockroachdb/cockroach/pull/152468
[#151875]: https://github.com/cockroachdb/cockroach/pull/151875
[#147015]: https://github.com/cockroachdb/cockroach/pull/147015
[#151813]: https://github.com/cockroachdb/cockroach/pull/151813
