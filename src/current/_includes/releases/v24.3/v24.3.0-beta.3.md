## v24.3.0-beta.3

Release Date: November 5, 2024

{% include releases/new-release-downloads-docker-image.md release=include.release %}

<h3 id="v24-3-0-beta-3-security-updates">Security updates</h3>

- We add detailed client error messages in case of incorrect service account credentials for ldap authentication and authorization. The error message will be as follows: ``` ERROR: LDAP authentication: error binding as LDAP service user with configured credentials (SQLSTATE 28000) ``` [#133812][#133812]

<h3 id="v24-3-0-beta-3-{{-site.data.products.enterprise-}}-edition-changes">{{ site.data.products.enterprise }} edition changes</h3>

- Added a timer for inner sink client flushes. Fixed a bug where timers were not correctly registered with the metric system. [#133288][#133288]
- Rows replicated by LDR in immediate mode are now factored into the determination of when to recompute SQL table statistics.  Epic: CRDB-40872. [#133591][#133591]

<h3 id="v24-3-0-beta-3-operational-changes">Operational changes</h3>

- The cluster setting kvadmission.flow_controller.token_reset_epoch is an advanced setting that can be used to refill replication admission control v2 tokens. It should only be used after consultation with an expert. [#133294][#133294]
- The goschedstats.always_use_short_sample_period.enabled setting should be set to true for any serious production cluster, to prevent unnecessary queuing in admission control CPU queues. [#133585][#133585]

<h3 id="v24-3-0-beta-3-db-console-changes">DB Console changes</h3>

- In the v2 database and db details pages, the refresh button tooltip will now include the cache refresh progress when the job is running as well as when the update started. [#133351][#133351]

<h3 id="v24-3-0-beta-3-bug-fixes">Bug fixes</h3>

- This commit fixes a bug which causes new connections to fail with the following error after upgrading to v24.2:  ``` ERROR: invalid value for parameter "vectorize": "unknown(1)" SQLSTATE: 22023 HINT: Available values: off,on,experimental_always ```  In order to hit this bug, the cluster must have: 1. been on version v21.1 at some point in the past 2. run `SET CLUSTER SETTING sql.defaults.vectorize = 'on';` on v21.1 3. not set sql.defaults.vectorize after upgrading past v21.1 4. upgraded all the way to v24.2  The conditions required for this bug can be detected using:  ``` SELECT * FROM system.settings WHERE name = 'sql.defaults.vectorize'; ```  If the value is '1', the following statement should be run to fix it before upgrading to v24.2:  ``` RESET CLUSTER SETTING sql.defaults.vectorize; ```  This commit fixes the bug by making '1' a legal value for sql.defaults.vectorize again (mapping to 'on'). [#133371][#133371]
- Previously, CockroachDB could encounter an internal error of the form `interface conversion: coldata.Column is` in an edge case and this is now fixed. The bug is present in versions 22.2.13+, 23.1.9+, 23.2+. [#133762][#133762]
- A bug has been fixed that caused incorrect NOT NULL constraint violation errors on `UPSERT` and `INSERT .. ON CONFLICT .. DO UPDATE` statements when those statements updated an existing row and a subset of columns which did not include a `NOT NULL` column of the table. This bug has been present since at least version 20.1.0. [#133820][#133820]
- A bug has been fixed that caused non-reusable query plans, e.g., plans for DDL and `SHOW ...` statements, to be cached and reused in future executions, possibly causing stale results to be returned. This bug only occurred when `plan_cache_mode` was set to `auto` or `force_generic_plan`, both of which are not currently the default settings. [#133073][#133073]
- Fix an unhandled error that could occur when using `REVOKE ... ON SEQUENCE FROM ... user` on an object that is not a sequence. [#133710][#133710]
- Address a panic inside CREATE TABLE AS if sequence builtin expressions had invalid function overloads. [#133870][#133870]

<h3 id="v24-3-0-beta-3-miscellaneous">Miscellaneous</h3>

<h4 id="v24-3-0-beta-3-sql-changes">Sql changes</h4>

- Allow PCR reader catalogs to bypass AOST timestamps using the bypass_pcr_reader_catalog_aost session variable, which can, which can be used to modify cluster settings within the reader. [#133876][#133876]

<h4 id="v24-3-0-beta-3-changes-without-release-note-annotation">Changes without release note annotation</h4>

- [#133472][#133472] [023e9aa7b][023e9aa7b] release-24.3: roachtest: string match for transient errors as a fallback
- [#133472][#133472] [9d3056016][9d3056016] release-24.3: roachtest: string match for transient errors as a fallback
- [#133472][#133472] [a289a1001][a289a1001] release-24.3: roachtest: string match for transient errors as a fallback
- [#133414][#133414] [a4ff6db79][a4ff6db79] release-24.3: producer: export scanning range stats

<h3 id="v24-3-0-beta-3-doc-updates">Doc updates</h3>

{% comment %}Docs team: Please add these manually.{% endcomment %}



[#133073]: https://github.com/cockroachdb/cockroach/pull/133073
[#133288]: https://github.com/cockroachdb/cockroach/pull/133288
[#133294]: https://github.com/cockroachdb/cockroach/pull/133294
[#133351]: https://github.com/cockroachdb/cockroach/pull/133351
[#133371]: https://github.com/cockroachdb/cockroach/pull/133371
[#133414]: https://github.com/cockroachdb/cockroach/pull/133414
[#133472]: https://github.com/cockroachdb/cockroach/pull/133472
[#133585]: https://github.com/cockroachdb/cockroach/pull/133585
[#133591]: https://github.com/cockroachdb/cockroach/pull/133591
[#133710]: https://github.com/cockroachdb/cockroach/pull/133710
[#133762]: https://github.com/cockroachdb/cockroach/pull/133762
[#133812]: https://github.com/cockroachdb/cockroach/pull/133812
[#133820]: https://github.com/cockroachdb/cockroach/pull/133820
[#133870]: https://github.com/cockroachdb/cockroach/pull/133870
[#133876]: https://github.com/cockroachdb/cockroach/pull/133876
[023e9aa7b]: https://github.com/cockroachdb/cockroach/commit/023e9aa7b
[9d3056016]: https://github.com/cockroachdb/cockroach/commit/9d3056016
[a289a1001]: https://github.com/cockroachdb/cockroach/commit/a289a1001
[a4ff6db79]: https://github.com/cockroachdb/cockroach/commit/a4ff6db79
