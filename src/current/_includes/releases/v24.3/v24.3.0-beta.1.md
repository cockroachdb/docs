## v24.3.0-beta.1

Release Date: October 24, 2024

{% include releases/new-release-downloads-docker-image.md release=include.release %}

<h3 id="v24-3-0-beta-1-general-changes">General changes</h3>

- The cluster setting `diagnostics.reporting.enabled` is now ignored if the cluster has a Trial or Free license, or if the reporting job is unable to load any license at all. [#132257][#132257]

<h3 id="v24-3-0-beta-1-{{-site.data.products.enterprise-}}-edition-changes">{{ site.data.products.enterprise }} edition changes</h3>

- This change ensures authorization via LDAP only goes through iff `ldapgrouplistfilter`option present in HBA configuration, else we just proceed with authentication as per provided ldap auth method options in HBA. This change is to ensure external authorization with ldap is opt-in rather than enabled by default. [#132235][#132235]
- Add sink error metric (`changefeed.sink_errors`) and expand reporting of internal retries metric (`changefeed.internal_retry_message_count`) to all sinks that perform internal retries. [#132092][#132092]

<h3 id="v24-3-0-beta-1-sql-language-changes">SQL language changes</h3>

- Implemented DROP TRIGGER statements. Note that the CASCADE option for dropping a trigger is not supported. [#128540][#128540]
- Added support for CREATE TRIGGER. Note that OR REPLACE syntax is not yet supported. Also note that triggers cannot yet be executed, so creation is currently a no-op. [#128540][#128540]
- REGIONAL BY ROW and PARTITION BY ALL  tables can now be inserted into under non-serializable isolation levels so long as there is no ON CONFLICT clause on the statement. [#129837][#129837]
- REGIONAL BY ROW and PARTITION ALL BY tables can now be updated under non-SERIALIZABLE isolation levels. [#129837][#129837]
- Attempting to add foreign keys referencing a table with row level TTL enabled will generate a notice informing the user about potential impact on the row level TTL deletion job. Similarly, a notice is generated while attempting to enable row level TTL on a table that has inbound foreign key references. [#127935][#127935]
- It is now possible to assign to an element of a composite typed varialbe in PL/pgSQL. For example, given a variable `foo` with two integer elements `x` and `y`, the following assignment statement is allowed: `foo.x := 100;`. [#132628][#132628]
- Backup/restore now work for tables with triggers. When the `SKIP_MISSING_UDFS` flag is applied, triggers with missing trigger functions are removed from the table. [#128555][#128555]
- UPSERT and INSERT .. ON CONFLICT statements are now supported on Regional By Row tables under READ COMMITTED isolation. [#132768][#132768]
- Added support for row-level BEFORE triggers. A row-level trigger executes the trigger function for each row that is being mutated. BEFORE triggers fire before the mutation operation. [#132511][#132511]
- Added support for PL/pgSQL integer FOR loops, which iterate over a range of integer values. [#130211][#130211]

<h3 id="v24-3-0-beta-1-operational-changes">Operational changes</h3>

- Admission Control now has an integration for pacing snapshot ingest traffic based on disk bandwidth. `kvadmission.store.snapshot_ingest_bandwidth_control.enabled` is used to turn on this integration. Note that it requires provisioned bandwidth to be set for the store (or cluster through the cluster setting) for it to take effect. [#131243][#131243]
- Added log file sink validation for co-existing of audit logging & buffering configurations. This validation makes sure that only one of them should present. [#132742][#132742]
- Updated the file sink log validation message. This would give clear indication to user about the expected valid configuration. [#132899][#132899]

<h3 id="v24-3-0-beta-1-db-console-changes">DB Console changes</h3>

- The value of the auto stats collection enabled cluster setting is now in the top right corner of the db overview page. [#132269][#132269]
- In the new db and tables pages, when cached data is being refreshed, the refresh button will be disabled and its tooltip text will display, "Data is currently refreshing". [#132462][#132462]

<h3 id="v24-3-0-beta-1-bug-fixes">Bug fixes</h3>

- Addressed a rare bug that could prevent backups taken during a DROP COLUMN operation with a sequence owner from restoring with the error: "rewriting descriptor ids: missing rewrite for <id> in SequenceOwner..." [#132202][#132202]
- Fixed a bug existing since before v23.1 which could lead to incorrect results in rare cases. The bug requires a join between two tables, with an equality between columns with equivalent but not identical types (e.g. OID and REGCLASS). In addition, the join must lookup into an index that includes a computed column that references one of the equivalent columns. [#126345][#126345]
- Fixed a bug existing since before v23.1 which could lead to incorrect results in rare cases. The bug requires a lookup join into a table with a computed index column, where the computed column expression is composite sensitive. A composite sensitive expression can compare differently if supplied non-identical but equivalent input values (e.g. `2.0::DECIMAL` vs `2.00::DECIMAL`). [#126345][#126345]
- Fixed a bug that caused quotes around the name of a routine to be dropped when it was called within another routine. This could prevent the correct routine from being resolved if the nested routine name was case-sensitive. The bug has existed since v24.1, when nested routines were introduced. [#131643][#131643]
- Fixed a bug where the CLI would print out the previous error message when executing the quit command. [#130736][#130736]
- Fixes a bug where a span stats request on a mixed version cluster resulted in an NPE [#132349][#132349]
- Fixed an issue where changefeeds would fail to update protected timestamp records in the face of retryable errors. [#132712][#132712]
- The franz-go library has been updated to fix a potential deadlock on changefeed restarts. [#132761][#132761]
- A bug has been fixed that could cause incorrect evaluation of scalar expressions involving NULL values in rare cases. [#132261][#132261]
- A bug in the query optimizer which could cause CockroachDB nodes to crash in rare cases has been fixed. The bug could occur when a query contains a filter in the form `col IN (elem0, elem1, ..., elemN)` only when `N` is very large, e.g., 1.6+ million, and when `col` exists in a hash-sharded index or exists a table with an indexed, computed column dependent on `col`. [#132701][#132701]
- The proretset column of the pg_catalog.pg_proc table is now properly set to true for set-returning builtin functions. [#132853][#132853]

<h3 id="v24-3-0-beta-1-build-changes">Build changes</h3>

- Upgrade to Go 1.23.2  Closes: #129900 Closes: #129897 Closes: #129902 [#132111][#132111]

<h3 id="v24-3-0-beta-1-miscellaneous">Miscellaneous</h3>

<h4 id="v24-3-0-beta-1-changes-without-release-note-annotation">Changes without release note annotation</h4>

- [#132023][#132023] [aee6ec88d][aee6ec88d] roachtest: stats exporter
- [#131291][#131291] [8562d3736][8562d3736] roachtest: UT for test selection with randomisation
- [#132478][#132478] [12fa7dae6][12fa7dae6] roachprod: preserve error object in Get
- [#132348][#132348] [d9cd2a2fb][d9cd2a2fb] sql: fix panic caused by type resolution in AOST expression
- [#132211][#132211] [bd24ec987][bd24ec987] sql/delegate: refactor comments table code and remove usage of `system.comments` table

<h3 id="v24-3-0-beta-1-doc-updates">Doc updates</h3>

{% comment %}Docs team: Please add these manually.{% endcomment %}



[#126345]: https://github.com/cockroachdb/cockroach/pull/126345
[#127935]: https://github.com/cockroachdb/cockroach/pull/127935
[#128540]: https://github.com/cockroachdb/cockroach/pull/128540
[#128555]: https://github.com/cockroachdb/cockroach/pull/128555
[#129837]: https://github.com/cockroachdb/cockroach/pull/129837
[#130211]: https://github.com/cockroachdb/cockroach/pull/130211
[#130736]: https://github.com/cockroachdb/cockroach/pull/130736
[#131243]: https://github.com/cockroachdb/cockroach/pull/131243
[#131291]: https://github.com/cockroachdb/cockroach/pull/131291
[#131643]: https://github.com/cockroachdb/cockroach/pull/131643
[#132023]: https://github.com/cockroachdb/cockroach/pull/132023
[#132092]: https://github.com/cockroachdb/cockroach/pull/132092
[#132111]: https://github.com/cockroachdb/cockroach/pull/132111
[#132202]: https://github.com/cockroachdb/cockroach/pull/132202
[#132211]: https://github.com/cockroachdb/cockroach/pull/132211
[#132235]: https://github.com/cockroachdb/cockroach/pull/132235
[#132257]: https://github.com/cockroachdb/cockroach/pull/132257
[#132261]: https://github.com/cockroachdb/cockroach/pull/132261
[#132269]: https://github.com/cockroachdb/cockroach/pull/132269
[#132348]: https://github.com/cockroachdb/cockroach/pull/132348
[#132349]: https://github.com/cockroachdb/cockroach/pull/132349
[#132462]: https://github.com/cockroachdb/cockroach/pull/132462
[#132478]: https://github.com/cockroachdb/cockroach/pull/132478
[#132511]: https://github.com/cockroachdb/cockroach/pull/132511
[#132628]: https://github.com/cockroachdb/cockroach/pull/132628
[#132701]: https://github.com/cockroachdb/cockroach/pull/132701
[#132712]: https://github.com/cockroachdb/cockroach/pull/132712
[#132742]: https://github.com/cockroachdb/cockroach/pull/132742
[#132761]: https://github.com/cockroachdb/cockroach/pull/132761
[#132768]: https://github.com/cockroachdb/cockroach/pull/132768
[#132853]: https://github.com/cockroachdb/cockroach/pull/132853
[#132899]: https://github.com/cockroachdb/cockroach/pull/132899
[12fa7dae6]: https://github.com/cockroachdb/cockroach/commit/12fa7dae6
[8562d3736]: https://github.com/cockroachdb/cockroach/commit/8562d3736
[aee6ec88d]: https://github.com/cockroachdb/cockroach/commit/aee6ec88d
[bd24ec987]: https://github.com/cockroachdb/cockroach/commit/bd24ec987
[d9cd2a2fb]: https://github.com/cockroachdb/cockroach/commit/d9cd2a2fb
