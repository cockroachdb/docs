## v24.3.1

Release Date: December 12, 2024

{% include releases/new-release-downloads-docker-image.md release=include.release %}

<h3 id="v24-3-1-security-updates">Security updates</h3>

- This fix handles non-standard sql roles created for managing ldap groups cn and modifies the grant statement to handle using quoted sql roles. [#134942][#134942]
- This fix will add support for partial roles from ldap synced group to be mapped to crdb roles and ensure appropriate erroring for undesired behavior. [#135587][#135587]

<h3 id="v24-3-1-{{-site.data.products.enterprise-}}-edition-changes">{{ site.data.products.enterprise }} edition changes</h3>

- Add `system.users` to the list of system tables that changefeeds protect with PTS. This table is required for CDC Queries. [#134238][#134238]

<h3 id="v24-3-1-sql-language-changes">SQL language changes</h3>

- When triggers fire one another cyclically, the new `recursion_depth_limit` setting now limits the depth of the recursion. By default, the limit is `1000` nested trigger executions. [#135046][#135046]

<h3 id="v24-3-1-operational-changes">Operational changes</h3>

- The metrics scrape HTTP endpoint at `/ _status/vars` will now truncate HELP text at the first sentence, reducing the metadata for metrics with large descriptions. Customers can still access these descriptions via our docs. [#135021][#135021]
- The row-level TTL job now will periodically update the progress meter in the jobs introspection interfaces, including SHOW JOBS and the Jobs page in the DB console. [#135171][#135171]
- Telemetry delivery is now considered successful even in cases where we experience a network timeout. This will prevent throttling in cases outside an operator's control. [#136481][#136481]

<h3 id="v24-3-1-db-console-changes">DB Console changes</h3>

- When activating statement diagnostics in the DB Console, users now have the option to produce a redacted bundle as output. This bundle will omit sensitive data. [#134993][#134993]

<h3 id="v24-3-1-bug-fixes">Bug fixes</h3>

- Fixed a bug that could cause DELETE triggers not to fire on cascading delete, and which could cause INSERT triggers to match incorrectly in the same scenario. [#134896][#134896]
- Reduce the duration of partitions in the gossip network when a node crashes in order to eliminate false positives in the `ranges.unavailable` metric. [#134480][#134480]
- When you are a non-admin user and you run drop role if exists on a user that does not exist you no longer get an error message. [#134970][#134970]
- A bug has been fixed that could cause incorrect query results when the optimizer planned a lookup join on an index containing a column of type `CHAR(N)`, `VARCHAR(N)`, `BIT(N)`, `VARBIT(N)`, or `DECIMAL(M, N)`, and the query held that column constant to a single value (e.g., with an equality filter). [#135037][#135037]
- Fixed an unhandled error that would occur if DROP SCHEMA was executed on the `public` schema of the `system` database, or on an internal schema like `pg_catalog` or `information_schema`. [#135181][#135181]
- A bug has been fixed that caused incorrect evaluation of some binary expressions involving `CHAR(N)` values and untyped string literals with trailing whitespace characters. For example, the expression `'f'::CHAR = 'f '` now correctly evaluates to `true`. [#134710][#134710]
- Prevent ALTER DATABASE operations that modify the zone config from hanging if an invalid zone config already exists. [#135216][#135216]
- CREATE SCHEMA now returns the correct error if a the schema name is missing. [#135928][#135928]
- CockroachDB now correctly evaluates `percentile_cont` and `percentile_disc` aggregates over FLOAT4 values (previously we would return an error). [#135764][#135764]
- Security.certificate.* metrics will now be updated if a node loads new certificates while running. [#136227][#136227]

<h3 id="v24-3-1-performance-improvements">Performance improvements</h3>

- The /_status/nodes_ui API no longer returns unnecessary metrics in its response. This decreases the payload size of the API and improves the load time of various db-console pages and components. [#135209][#135209]
- Performance for some PL/pgSQL loops is now significantly improved, by as much as 3-4x. This is due to applying tail-call optimization in more cases to the recursive sub-routines that implement loops. [#135648][#135648]

<h3 id="v24-3-1-miscellaneous">Miscellaneous</h3>

<h4 id="v24-3-1-multi-tenancy">Multi-tenancy</h4>

- Hide --tenant-name-scope cli flag until the implementation is ready. [#133230][#133230]

<h4 id="v24-3-1-changes-without-release-note-annotation">Changes without release note annotation</h4>

- [#136011][#136011] [965dded2a][965dded2a] release-24.3: Update Artifact action to v4
- [#135120][#135120] [3cbd07fbd][3cbd07fbd] 
- [#135094][#135094] [3f5305a4c][3f5305a4c] release-24.3: docgen: update SQL diagrams for triggers
- [#135094][#135094] [9951e3e61][9951e3e61] release-24.3: docgen: update SQL diagrams for triggers
- [#135094][#135094] [1f2b1b084][1f2b1b084] release-24.3: docgen: update SQL diagrams for triggers
- [#135094][#135094] [989a49c3f][989a49c3f] release-24.3: docgen: update SQL diagrams for triggers
- [#134729][#134729] [0d7f6eed3][0d7f6eed3] release-24.3: roachtest: apply default mvt start opts to tenants

<h3 id="v24-3-1-doc-updates">Doc updates</h3>

{% comment %}Docs team: Please add these manually.{% endcomment %}



[#133230]: https://github.com/cockroachdb/cockroach/pull/133230
[#134238]: https://github.com/cockroachdb/cockroach/pull/134238
[#134480]: https://github.com/cockroachdb/cockroach/pull/134480
[#134710]: https://github.com/cockroachdb/cockroach/pull/134710
[#134729]: https://github.com/cockroachdb/cockroach/pull/134729
[#134896]: https://github.com/cockroachdb/cockroach/pull/134896
[#134942]: https://github.com/cockroachdb/cockroach/pull/134942
[#134970]: https://github.com/cockroachdb/cockroach/pull/134970
[#134993]: https://github.com/cockroachdb/cockroach/pull/134993
[#135021]: https://github.com/cockroachdb/cockroach/pull/135021
[#135037]: https://github.com/cockroachdb/cockroach/pull/135037
[#135046]: https://github.com/cockroachdb/cockroach/pull/135046
[#135094]: https://github.com/cockroachdb/cockroach/pull/135094
[#135120]: https://github.com/cockroachdb/cockroach/pull/135120
[#135171]: https://github.com/cockroachdb/cockroach/pull/135171
[#135181]: https://github.com/cockroachdb/cockroach/pull/135181
[#135209]: https://github.com/cockroachdb/cockroach/pull/135209
[#135216]: https://github.com/cockroachdb/cockroach/pull/135216
[#135587]: https://github.com/cockroachdb/cockroach/pull/135587
[#135648]: https://github.com/cockroachdb/cockroach/pull/135648
[#135764]: https://github.com/cockroachdb/cockroach/pull/135764
[#135928]: https://github.com/cockroachdb/cockroach/pull/135928
[#136011]: https://github.com/cockroachdb/cockroach/pull/136011
[#136227]: https://github.com/cockroachdb/cockroach/pull/136227
[#136481]: https://github.com/cockroachdb/cockroach/pull/136481
[0d7f6eed3]: https://github.com/cockroachdb/cockroach/commit/0d7f6eed3
[1f2b1b084]: https://github.com/cockroachdb/cockroach/commit/1f2b1b084
[3cbd07fbd]: https://github.com/cockroachdb/cockroach/commit/3cbd07fbd
[3f5305a4c]: https://github.com/cockroachdb/cockroach/commit/3f5305a4c
[965dded2a]: https://github.com/cockroachdb/cockroach/commit/965dded2a
[989a49c3f]: https://github.com/cockroachdb/cockroach/commit/989a49c3f
[9951e3e61]: https://github.com/cockroachdb/cockroach/commit/9951e3e61
