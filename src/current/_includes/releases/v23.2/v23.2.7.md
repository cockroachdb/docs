## v23.2.7

Release Date: July 2, 2024

{% include releases/new-release-downloads-docker-image.md release=include.release %}

<h3 id="v23-2-7-{{-site.data.products.enterprise-}}-edition-changes">{{ site.data.products.enterprise }} edition changes</h3>

- Changefeeds now use the BulkOracle for planning, which distributes work evenly across all replica in the locality filter, including followers if enabled. This is enabled by default with the cluster setting `changefeed.balanced_distribution.enabled`. If disabled, changefeed planning reverts to its previous bin packing oracle. [#124925][#124925]
- `ALTER CHANGEFEED` no longer removes CDC query when modifying changefeed properties. [#125437][#125437]
- Add a new metric to facilitate the new changefeed billing strategy for usage in Cockroach Cloud. [#125525][#125525]

<h3 id="v23-2-7-sql-language-changes">SQL language changes</h3>

- Do not limit precision when encoding geo data types to JSON. [#124535][#124535]
- The `optimizer_push_offset_into_index_join` session setting has been added. When enabled, the optimizer will attempt to push offset expressions into index join expressions to produce more efficient query plans. It is enabled by default on 24.1+ and disabled on 23.2. [#124492][#124492]

<h3 id="v23-2-7-operational-changes">Operational changes</h3>

- Improve disk usage metric reporting over volumes that dynamically change their size over the life of the cockroach process. [#125107][#125107]

<h3 id="v23-2-7-db-console-changes">DB Console changes</h3>

- The favicon now renders properly for DB Console along with other image files. [#122704][#122704]

<h3 id="v23-2-7-bug-fixes">Bug fixes</h3>

- Scattering a range with replication factor=1, no longer erroneously up-replicates the range to two replicas. Leases will also no longer thrash between nodes when perturbed with replication factor=1. [#124487][#124487]
- Previously, if the ttl_row_stats_poll_interval storage parameter was non-zero for a table with row level TTL enabled, the queries issued to update row stats could block the job from completing. Now, if the job completes, these stats queries are cancelled instead. This means that the jobs.row_level_ttl.total_rows and jobs.row_level_ttl.total_expired_rows metrics will report 0 if the job finishes before the row stats queries complete. [#124626][#124626]
- The results_buffer_size session variable previously could not be configured by using the "options" query parameter in the connection string; it could only be configured as a top-level query parameter. Now, it can be configured in either part of the connection string. (This variable still cannot be changed with the SET command after the session begins.) [#124774][#124774]
- Drop role/user could leave references behind inside types, which could prevent SHOW GRANTS from working [#124644][#124644]
- Add automated clean up / validation for dropped roles inside descriptors. [#124665][#124665]
- ALTER PRIMARY KEY could hang if the table had any indexes which were referred to by views or functions using the force index syntax. [#124569][#124569]
- SHOW TYPES includes user defined composite types. It omitted those types ever since composite types were added in 23.1. [#124816][#124816]
- Fixed handling in the DSC when columns are included in the STORING() clause of CREATE INDEX. We now check if the column is virtual up front, and properly detect when a column is already handled by an existing index when the column name has UTF-8 characters. [#125211][#125211]
- Fix a bug where a change to a user-defined type could cause queries against tables using that type to fail with an error message like:    "histogram.go:694: span must be fully contained in the bucket"  The change to the user-defined type could come directly from an ALTER TYPE statement, or indirectly from an ALTER DATABASE ADD REGION or DROP REGION statement (which implicitly change the crdb_internal_region type).  This bug has existed since UDTs were introduced in v20.2. [#124853][#124853]
- Fixed a bug where telemetry logs were had the same statement fingerprint id for different sql statements. [#125043][#125043]
- Fixed an issue where adding a column with a default value of an empty array would not succeed. [#125326][#125326]
- ALTER TABLE ... ADD CONSTRAINT UNIQUE will now fail with a well-formed error message and code 42601 if a statement tries to add a unique constraint on an expression.  Release justification: Bug fix. [#125418][#125418]
- Fixed a bug in v24.1, v23.2, and v23.1 where using changefeed.aggregator.flush_jitter with min_checkpoint_frequency set to zero could cause panics. [#125469][#125469]
- Fixed a bug where the public schema would be created with the wrong owner. Previously the admin role would own the public schema. Now, the database owner is also the owner of the public schema. The ownership can be altered after the schema is created. [#125535][#125535]
- Previously, CockroachDB would hit an internal error when evaluating INSERTs into REGIONAL BY ROW tables where the source is a VALUES clause with a single row and at least one boolean expression, and this is now fixed. The bug was introduced in 23.2.0 release. [#126208][#126208]

<h3 id="v23-2-7-performance-improvements">Performance improvements</h3>

- The optimizer now generates more efficient query plans for some queries with `OFFSET` clauses. [#124492][#124492]

<h3 id="v23-2-7-miscellaneous">Miscellaneous</h3>

<h4 id="v23-2-7-missing-category">Missing category</h4>

-  [#125543][#125543]

<h4 id="v23-2-7-changes-without-release-note-annotation">Changes without release note annotation</h4>

- [#124800][#124800] [79405f98e][79405f98e]  (Renato Costa <renato@cockroachlabs.com>)

<h3 id="v23-2-7-doc-updates">Doc updates</h3>

{% comment %}Docs team: Please add these manually.{% endcomment %}

<div class="release-note-contributors" markdown="1">

<h3 id="v23-2-7-contributors">Contributors</h3>

This release includes 77 merged PRs by 30 authors.
We would like to thank the following contributors from the CockroachDB community:

- David Hartunian (first-time contributor, CockroachDB team member)
- Kyle Wong (first-time contributor, CockroachDB team member)
- Matt Spilchen (first-time contributor, CockroachDB team member)
- Miles Frankel (first-time contributor, CockroachDB team member)
- Rachael Harding (first-time contributor, CockroachDB team member)

</div>

[#122704]: https://github.com/cockroachdb/cockroach/pull/122704
[#124487]: https://github.com/cockroachdb/cockroach/pull/124487
[#124492]: https://github.com/cockroachdb/cockroach/pull/124492
[#124535]: https://github.com/cockroachdb/cockroach/pull/124535
[#124569]: https://github.com/cockroachdb/cockroach/pull/124569
[#124626]: https://github.com/cockroachdb/cockroach/pull/124626
[#124644]: https://github.com/cockroachdb/cockroach/pull/124644
[#124665]: https://github.com/cockroachdb/cockroach/pull/124665
[#124774]: https://github.com/cockroachdb/cockroach/pull/124774
[#124800]: https://github.com/cockroachdb/cockroach/pull/124800
[#124816]: https://github.com/cockroachdb/cockroach/pull/124816
[#124853]: https://github.com/cockroachdb/cockroach/pull/124853
[#124925]: https://github.com/cockroachdb/cockroach/pull/124925
[#125043]: https://github.com/cockroachdb/cockroach/pull/125043
[#125107]: https://github.com/cockroachdb/cockroach/pull/125107
[#125211]: https://github.com/cockroachdb/cockroach/pull/125211
[#125326]: https://github.com/cockroachdb/cockroach/pull/125326
[#125418]: https://github.com/cockroachdb/cockroach/pull/125418
[#125437]: https://github.com/cockroachdb/cockroach/pull/125437
[#125469]: https://github.com/cockroachdb/cockroach/pull/125469
[#125525]: https://github.com/cockroachdb/cockroach/pull/125525
[#125535]: https://github.com/cockroachdb/cockroach/pull/125535
[#125543]: https://github.com/cockroachdb/cockroach/pull/125543
[#126208]: https://github.com/cockroachdb/cockroach/pull/126208
[79405f98e]: https://github.com/cockroachdb/cockroach/commit/79405f98e
