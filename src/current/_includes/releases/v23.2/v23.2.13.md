## v23.2.13

Release Date: October 17, 2024

{% include releases/new-release-downloads-docker-image.md release=include.release %}
<h3 id="v23-2-13-{{-site.data.products.enterprise-}}-edition-changes">{{ site.data.products.enterprise }} edition changes</h3>

- Updates the cluster setting `changefeed.sink_io_workers` with all the sinks that support the setting. [#130372][#130372]
- Added network metrics to the kafka v1 sink. [#130664][#130664]
- Added network metrics to webhook sinks. [#130664][#130664]
- Added network metrics to the pubsub sinks. [#130664][#130664]
- Added network metrics to the sql sink. [#130664][#130664]
- A new `changefeed.total_ranges` metric has been added and can be used to monitor the number of ranges that are watched by changefeed aggregators. It shares the same polling interval as `changefeed.lagging_ranges`, which is controlled by the existing `lagging_ranges_polling_interval` option. [#130984][#130984]
- Disambiguate metrics and logs for the 2 buffers used by the kv feed. Affected metrics now have a suffix indicating which buffer they correspond to. Affected metrics: `changefeed.buffer_entries.*`, `changefeed.buffer_entries_mem.*`, `changefeed.buffer_pushback_nanos.*`. The old versions are kept around for backwards compatibility, though their use is not recommended. [#131417][#131417]
- Added timers around key parts of the changefeed pipeline to help debug feeds experiencing issues. The `changefeed.stage.<stage>.latency` metrics now emit latency histograms for each stage. The metric respects the changefeed `scope` label for debugging specific feeds. [#131428][#131428]
- Added network metrics to the kafka v1 sink. [#131582][#131582]
- Added network metrics to webhook sinks. [#131582][#131582]
- Added network metrics to the pubsub sinks. [#131582][#131582]
- Added network metrics to the sql sink. [#131582][#131582]

<h3 id="v23-2-13-operational-changes">Operational changes</h3>

- The `ranges.decommissioning` metric is added, representing the number of ranges which have a replica on a decommissioning node. [#130251][#130251]
- Adds three new network tracking metrics. `rpc.connection.connected` is the number of rRPC TCP level connections established to remote nodes. `rpc.client.bytes.egress` is the number of TCP bytes sent via gRPC on connections we initiated. `rpc.client.bytes.ingress` is the number of TCP bytes received via gRPC on connections we initiated. [#130521][#130521]
- Adds a new configuration parameters server.cidr_mapping_url which maps IPv4 CIDR blocks to arbitrary tag names. [#130528][#130528]
- Modifies metrics sql.bytesin and sql.bytesout to be agg metrics if child metrics are enabled. [#130528][#130528]
- This commit adds two metrics changefeed.network.bytes_in and changefeed.network.bytes_out. These metrics track the number of bytes sent by the individual changefeeds to different sinks. [#130664][#130664]
- Users may set the log format for the stderr sink by setting the `format` field in the logging config under the `stderr` sink section. [#131533][#131533]
- The `ranges.decommissioning` metric is added, representing the number of ranges which have a replica on a decommissioning node. [#131582][#131582]
- Adds three new network tracking metrics. `rpc.connection.connected` is the number of rRPC TCP level connections established to remote nodes. `rpc.client.bytes.egress` is the number of TCP bytes sent via gRPC on connections we initiated. `rpc.client.bytes.ingress` is the number of TCP bytes received via gRPC on connections we initiated. [#131582][#131582]
- Adds a new configuration parameters server.cidr_mapping_url which maps IPv4 CIDR blocks to arbitrary tag names. [#131582][#131582]
- Modifies metrics sql.bytesin and sql.bytesout to be agg metrics if child metrics are enabled. [#131582][#131582]
- This commit adds two metrics changefeed.network.bytes_in and changefeed.network.bytes_out. These metrics track the number of bytes sent by the individual changefeeds to different sinks. [#131582][#131582]

<h3 id="v23-2-13-db-console-changes">DB Console changes</h3>

- Show alert message in Db Console when license is expired or less than 15 days left before it expires. [#130425][#130425]
- DB Console will show a notification alerting customers without an Enterprise license, to upcoming license changes with a link to more information. [#130425][#130425]
- Show alert message in Db Console when license is expired or less than 15 days left before it expires. [#131582][#131582]
- DB Console will show a notification alerting customers without an Enterprise license, to upcoming license changes with a link to more information. [#131582][#131582]

<h3 id="v23-2-13-bug-fixes">Bug fixes</h3>

- Fix a bug in which SHOW CLUSTER SETTING FOR VIRTUAL CLUSTER would erroneously return NULL for some settings. [#128782][#128782]
- Starting up nodes could fail with: "could not insert session ...: unexpected value", if an ambigous result error was hit inserting into the sqlliveness table. [#130343][#130343]
- Addressed a bug in the upgrade pre-condition for repairing descriptor corruption, which could lead to finalization being stuck [#130519][#130519]
- Fixed a rare bug where a lease transfer could lead to a `side-transport update saw closed timestamp regression` panic. The bug could occur when a node was overloaded and failing to heartbeat its node liveness record. [#130790][#130790]
- Resolves a concerning log message that says "expiration of liveness record ... is not greater than expiration of the previous lease ... after liveness heartbeat". This message is no longer possible. [#130790][#130790]
- Internally issued queries that are not initiated within a SQL session no longer respect a statement timeout. This includes: background jobs, queries issued by the db console that perform introspection, and the cloud sql shell. [#130790][#130790]
- If a connection was attempting a schema change while the same schema objects were being dropped, it was possible for the connection to be incorrectly dropped. [#130964][#130964]
- A bug has been fixed which could cause errors with the message "internal error: Non-nullable column ..." when executing statements under read-committed isolation that involve tables with `NOT NULL` virtual columns. [#131065][#131065]
- Fixes a potential memory leak in changefeeds using a cloud storage sink. The memory leak could occur if both changefeed.fast_gzip.enabled and changefeed.cloudstorage.async_flush.enabled are true and the changefeed received an error while attempting to write to the cloud storage sink. [#130614][#130614]
- Enable cluster setting `sql.stats.forecasts.max_decrease` by default to prevent a bug where statistics forecasting will sometimes predict zero rows for downward-trending statistics. This setting was introduced in v23.2.6 disabled (set to 0 by default), and is now enabled (set to 1/3 by default). [#131128][#131128]
- Fixed a bug introduced in v23.1 that can cause incorrect results when: 1. The query contains a correlated subquery. 2. The correlated subquery has a GroupBy or DistinctOn operator with an    outer-column reference in its input. 3. The correlated subquery is in the input of a Select or Join operator 4. The Select or Join has a filter that sets the outer-column reference from    (2) equal to a non-outer column in the input of the grouping operator. 5. The grouping column set does not include the replacement column, and    functionally determines the replacement column. [#130988][#130988]
- The AWS endpoint and cloud custom HTTP client configuration are now considered when implicit authentication is used, whereas previously these were only considered when using explicit credentials.  Epic: none. [#131201][#131201]
- Fix bug that could prevent a CHANGEFEED from being able to resume after being paused for prolonged period of time. [#130919][#130919]
- Fixes a potential memory leak in changefeeds using a cloud storage sink. The memory leak could occur if both changefeed.fast_gzip.enabled and changefeed.cloudstorage.async_flush.enabled are true and the changefeed received an error while attempting to write to the cloud storage sink. [#131582][#131582]

<h3 id="v23-2-13-miscellaneous">Miscellaneous</h3>

<h4 id="v23-2-13-changes-without-release-note-annotation">Changes without release note annotation</h4>

- [#131313][#131313] [3f5d89b52][3f5d89b52] release-23.2: Console: fix sources for network ui graphs
- [#131241][#131241] [764a06fc3][764a06fc3] release-23.2: roachtest, teamcity: publish runner logs to same directory
- [#131241][#131241] [9bf6a6b64][9bf6a6b64] release-23.2: roachtest, teamcity: publish runner logs to same directory
- [#130821][#130821] [d09ac7ffa][d09ac7ffa] testutilsccl: skip serverless tests
- [#130671][#130671] [5e3b44c9d][5e3b44c9d] release-23.2: sqlproxyccl: add ServerlessOnly test helper

<h3 id="v23-2-13-doc-updates">Doc updates</h3>

{% comment %}Docs team: Please add these manually.{% endcomment %}



[#128782]: https://github.com/cockroachdb/cockroach/pull/128782
[#130251]: https://github.com/cockroachdb/cockroach/pull/130251
[#130343]: https://github.com/cockroachdb/cockroach/pull/130343
[#130372]: https://github.com/cockroachdb/cockroach/pull/130372
[#130425]: https://github.com/cockroachdb/cockroach/pull/130425
[#130519]: https://github.com/cockroachdb/cockroach/pull/130519
[#130521]: https://github.com/cockroachdb/cockroach/pull/130521
[#130528]: https://github.com/cockroachdb/cockroach/pull/130528
[#130614]: https://github.com/cockroachdb/cockroach/pull/130614
[#130664]: https://github.com/cockroachdb/cockroach/pull/130664
[#130671]: https://github.com/cockroachdb/cockroach/pull/130671
[#130790]: https://github.com/cockroachdb/cockroach/pull/130790
[#130821]: https://github.com/cockroachdb/cockroach/pull/130821
[#130919]: https://github.com/cockroachdb/cockroach/pull/130919
[#130964]: https://github.com/cockroachdb/cockroach/pull/130964
[#130984]: https://github.com/cockroachdb/cockroach/pull/130984
[#130988]: https://github.com/cockroachdb/cockroach/pull/130988
[#131065]: https://github.com/cockroachdb/cockroach/pull/131065
[#131128]: https://github.com/cockroachdb/cockroach/pull/131128
[#131201]: https://github.com/cockroachdb/cockroach/pull/131201
[#131241]: https://github.com/cockroachdb/cockroach/pull/131241
[#131313]: https://github.com/cockroachdb/cockroach/pull/131313
[#131417]: https://github.com/cockroachdb/cockroach/pull/131417
[#131428]: https://github.com/cockroachdb/cockroach/pull/131428
[#131533]: https://github.com/cockroachdb/cockroach/pull/131533
[#131582]: https://github.com/cockroachdb/cockroach/pull/131582
[3f5d89b52]: https://github.com/cockroachdb/cockroach/commit/3f5d89b52
[5e3b44c9d]: https://github.com/cockroachdb/cockroach/commit/5e3b44c9d
[764a06fc3]: https://github.com/cockroachdb/cockroach/commit/764a06fc3
[9bf6a6b64]: https://github.com/cockroachdb/cockroach/commit/9bf6a6b64
[d09ac7ffa]: https://github.com/cockroachdb/cockroach/commit/d09ac7ffa
