## v23.2.4

Release Date: April 8, 2024

{% include releases/release-downloads-docker-image.md release=include.release %}

<h3 id="v23-2-4-sql-language-changes">SQL language changes</h3>

- Mutation statements such as UPDATE and DELETE as well as locking statements such as SELECT FOR UPDATE are not allowed in read-only transactions or AS OF SYSTEM TIME transactions. Fix an oversight where we were allowing mutation statements and locking statements in implicit single-statement transactions using AS OF SYSTEM TIME. [#120158][#120158]
- Add a new cluster setting, `sql.stats.virtual_computed_columns.enabled`, which when set enables collection of table statistics on virtual computed columns. [#120933][#120933]
- Add new session variable `optimizer_use_virtual_computed_column_stats`. When this variable is enabled, the optimizer will make use of table statistics on virtual computed columns. [#121329][#121329]

<h3 id="v23-2-4-db-console-changes">DB Console changes</h3>

- Resolves an issue where clusters with multiple stores per node may list inaccurate region/node information in the databases table. [#120212][#120212]

<h3 id="v23-2-4-bug-fixes">Bug fixes</h3>

- Previously, altering from a Regional By Row table to a Regional By Table table could cause leaseholders to never move to the databse's primary region. This is now fixed. [#118794][#118794]
- If a user has the VIEWACTIVITYREDACTED privilege, then they should not be able to see constants inside of queries that originate from other users in the SHOW SESSIONS result. This redaction was not occurring, but now this is fixed. [#119884][#119884]
- The SHOW QUERIES and SHOW STATEMENTS commands were incorrectly requiring that the user has the VIEWACTIVITY or VIEWACTIVITYREDACTED privilege. However, a user always should be able to view their own queries, even without this privilege. This is fixed now. [#119884][#119884]
- Fix a bug where RESTORE on certain backups would open a very large number of connections to the backup storage provider. Epic: none. [#119883][#119883]
- Fixed a bug that occurred when using ALTER TABLE to drop and re-add a CHECK constraint with the same name. [#120075][#120075]
- Fix a bug in which it was possible to `SET transaction_read_only = false` during an AS OF SYSTEM TIME transaction. [#120158][#120158]
- Fixed a condition where some files were not closed  when inspecting backup metadata during BACKUP and RESTORE. Epic: none. [#119635][#119635]
- Fixed a bug where some backup metadata files opened during RESTORE were not closed. Epic: none. [#119635][#119635]
- Fixes intermittent page crash on the Schema Insights view. [#120210][#120210]
- A slow memory leak that can accumulate when opening many new connections has been fixed. The bug is present in 22.2.9+ and 23.1+ versions. [#120243][#120243]
- Users will no longer see VIEW type tables from being shown in the db-console databases pages. Previously these would be listed with no info, only displaying errors. [#120214][#120214]

<h3 id="v23-2-4-miscellaneous">Miscellaneous</h3>

<h4 id="v23-2-4-changes-without-release-note-annotation">Changes without release note annotation</h4>

- [#120396][#120396] [ab130a289][ab130a289] release-23.2: roachprod: RAID0 only network disks if both local and network are present (Bhaskarjyoti Bora <bhaskar.bora@cockroachlabs.com>)
- [#120011][#120011] [bf9abb209][bf9abb209] release-23.2: sqlstats: dont block flush due to sql activity job (Xin Hao Zhang <xzhang@cockroachlabs.com>)
- [#119768][#119768] [ac6ece7c7][ac6ece7c7] release-23.2: CRDB-28040 : JWKS fetch from jwks_uri (BabuSrithar <babusrithar@cockroachlabs.com>)
- [#119946][#119946] [8e7442a3c][8e7442a3c] release-23.2: roachprod: add VM label for "spot" instance (Bhaskarjyoti Bora <bhaskar.bora@cockroachlabs.com>)
- [#119854][#119854] [1fed5a9c3][1fed5a9c3] release-23.2: scripts: change gceworker.sh to handle user with . (Bhaskarjyoti Bora <bhaskar.bora@cockroachlabs.com>)
- [#119828][#119828] [34288efe7][34288efe7] release-23.2: sqlproxyccl: delete destroy tenant portion of refresh throttling test (Jeff Swenson <swenson@cockroachlabs.com>)

<h3 id="v23-2-4-doc-updates">Doc updates</h3>

{% comment %}Docs team: Please add these manually.{% endcomment %}

<div class="release-note-contributors" markdown="1">

<h3 id="v23-2-4-contributors">Contributors</h3>

This release includes 63 merged PRs by 37 authors.
We would like to thank the following contributors from the CockroachDB community:

- BabuSrithar (first-time contributor, CockroachDB team member)
- Bhaskarjyoti Bora (first-time contributor, CockroachDB team member)
- Daniel Almeida (first-time contributor)
- Darryl Wong (first-time contributor, CockroachDB team member)
- David Hartunian (first-time contributor, CockroachDB team member)
- Lauren Barker (first-time contributor, CockroachDB team member)
- Matthew Sanabria
- Sourav Sarangi (first-time contributor, CockroachDB team member)

</div>

[#118794]: https://github.com/cockroachdb/cockroach/pull/118794
[#119635]: https://github.com/cockroachdb/cockroach/pull/119635
[#119768]: https://github.com/cockroachdb/cockroach/pull/119768
[#119828]: https://github.com/cockroachdb/cockroach/pull/119828
[#119854]: https://github.com/cockroachdb/cockroach/pull/119854
[#119883]: https://github.com/cockroachdb/cockroach/pull/119883
[#119884]: https://github.com/cockroachdb/cockroach/pull/119884
[#119946]: https://github.com/cockroachdb/cockroach/pull/119946
[#120011]: https://github.com/cockroachdb/cockroach/pull/120011
[#120075]: https://github.com/cockroachdb/cockroach/pull/120075
[#120158]: https://github.com/cockroachdb/cockroach/pull/120158
[#120210]: https://github.com/cockroachdb/cockroach/pull/120210
[#120212]: https://github.com/cockroachdb/cockroach/pull/120212
[#120214]: https://github.com/cockroachdb/cockroach/pull/120214
[#120243]: https://github.com/cockroachdb/cockroach/pull/120243
[#120396]: https://github.com/cockroachdb/cockroach/pull/120396
[#120933]: https://github.com/cockroachdb/cockroach/pull/120933
[#121329]: https://github.com/cockroachdb/cockroach/pull/121329
[1fed5a9c3]: https://github.com/cockroachdb/cockroach/commit/1fed5a9c3
[34288efe7]: https://github.com/cockroachdb/cockroach/commit/34288efe7
[8e7442a3c]: https://github.com/cockroachdb/cockroach/commit/8e7442a3c
[ab130a289]: https://github.com/cockroachdb/cockroach/commit/ab130a289
[ac6ece7c7]: https://github.com/cockroachdb/cockroach/commit/ac6ece7c7
[bf9abb209]: https://github.com/cockroachdb/cockroach/commit/bf9abb209
