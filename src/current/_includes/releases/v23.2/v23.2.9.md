## v23.2.9

Release Date: August 1, 2024

{% include releases/new-release-downloads-docker-image.md release=include.release %}

<h3 id="v23-2-9-sql-language-changes">SQL language changes</h3>

- EXPLAIN ANALYZE statements are now supported when executed via UI SQL shell. [#125562][#125562]
- Added the sql.auth.grant_option_inheritance.enabled cluster setting. The default value is true, which results in behavior that matches the existing behavior of CockroachDB. When set to false, then the GRANT OPTION is not inherited via role membership, which will prevent the descendant roles from being able to grant the privilege to others. The privilege itself is still inherited via role membership. [#126298][#126298]

<h3 id="v23-2-9-operational-changes">Operational changes</h3>

- Crdb_internal.cluster_execution_insights.txt and crdb_internal.cluster_txn_execution_insights.txt have been removed from the debug zip. These files contained cluster-wide insights for statements and transactions. Users can still rely on the per-node execution insights in crdb_internal.node_execution_insights.txt and crdb_internal.node_txn_execution_insights.txt. [#125804][#125804]
- Some debugging-only information about physcial plans is no longer collected in the system.job_info table for changefeeds due to it having the potential to grow very large.  Epic: none. [#126097][#126097]
- For the TELEMETRY channel, TCL `sampled_query` events will now be sampled along with DML statements according to the setting `sql.telemetry.query_sampling.max_event_frequency`. [#126728][#126728]

<h3 id="v23-2-9-bug-fixes">Bug fixes</h3>

- Previously, CockroachDB would hit an internal error when evaluating INSERTs into REGIONAL BY ROW tables where the source is a VALUES clause with a single row and at least one boolean expression, and this is now fixed. The bug was introduced in 23.2.0 release. [#125504][#125504]
- Drop role/user could leave references behind inside types, which could prevent SHOW GRANTS from working [#125806][#125806]
- Add automated clean up / validation for dropped roles inside descriptors. [#125806][#125806]
- Fix a bug where a change to a user-defined type could cause queries against tables using that type to fail with an error message like:    "histogram.go:694: span must be fully contained in the bucket"  The change to the user-defined type could come directly from an ALTER TYPE statement, or indirectly from an ALTER DATABASE ADD REGION or DROP REGION statement (which implicitly change the crdb_internal_region type).  This bug has existed since UDTs were introduced in v20.2. [#125806][#125806]
- Fix a bug in which constant LIKE patterns containing certain sequences of backslashes did not become constrained scans. This bug has been present since v21.1.13 when support for building constrained scans from LIKE patterns containing backslashes was added. [#125538][#125538]
- Fixed a bug that could cause calling a routine to return an unexpected `function ... does not exist` error. The bug is triggered when the routine is called twice using the exact same SQL query, and either: (a) the routine has polymorphic arguments, or: (b) in between the two calls, the routine is replaced by a routine with the     same name and different parameters. This bug has existed since alpha versions of 23.1. [#123518][#123518]
- Fixed the statistics estimation code in the optimizer so it does not use the empty histograms produced if histogram collection has been disabled during stats collection due to excessive memory utilization. Now the optimizer will rely on distinct counts instead of the empty histograms and should produce better plans as a result. This bug has existed since CockroachDB v22.1. [#126156][#126156]
- Fix the bug in tsdump where the command fails when a custom SQL port is used and the `--format=raw` flag is provided [#126184][#126184]
- Fixed a bug where a user-defined function that shared a name with a builtin function would not be resolved, even if it had higher precedence from the search_path variable. [#126295][#126295]
- Background jobs no longer respect a statement timeout. [#126819][#126819]
- DROP REGION can fail if any tables under a given database have indexes on expressions. [#126598][#126598]
- Fixed bug where we restore a database with a composite type. [#126841][#126841]
- Fixed postgres incompatibility bug when inputting public as user name for builtin functions such as has_database_privilege and has_schema_privilege.  Release justification: Bug fix. [#126852][#126852]
- Previously, CockroachDB would hit an internal error when evaluating INSERTs into REGIONAL BY ROW tables where the source is a VALUES clause with a single row and at least one boolean expression, and this is now fixed. The bug was introduced in 23.2.0 release. [#126839][#126839]
- Database overview and db details pages should not crash if the range information is not available. [#127091][#127091]
- Previously, CockroachDB could incorrectly evaluate `IS NOT NULL` filter if it was applied to non-NULL tuples that had NULL elements (like `(1, NULL)` or `(NULL, NULL)`). The bug is present since 20.2 version and is now fixed. [#126937][#126937]
- ALTER ROLE events in the DB Console event log now render correctly when the event does not contain any role options. [#126565][#126565]
- CREATE TABLE with index expressions could hit undefined column errors on transaction retries [#126201][#126201]

<h3 id="v23-2-9-performance-improvements">Performance improvements</h3>

- Schema changes that cause a data backfill, such as adding a non-nullable column or changing the primary key, now will split and scatter the temporary indexes used to perform the change. This reduces the chance of causing a write hotspot that can slow down foreground traffic. [#126691][#126691]

<h3 id="v23-2-9-miscellaneous">Miscellaneous</h3>

<h4 id="v23-2-9-changes-without-release-note-annotation">Changes without release note annotation</h4>

- [#127608][#127608] [7fb249aa1][7fb249aa1]  (Darryl Wong <darryl.wong@cockroachlabs.com>)
- [#126216][#126216] [44d16f97a][44d16f97a] release-23.2: util/log: add more information when log call exceeds deadline (Xin Hao Zhang <xzhang@cockroachlabs.com>)

<h3 id="v23-2-9-doc-updates">Doc updates</h3>

{% comment %}Docs team: Please add these manually.{% endcomment %}

<div class="release-note-contributors" markdown="1">

<h3 id="v23-2-9-contributors">Contributors</h3>

This release includes 100 merged PRs by 33 authors.
We would like to thank the following contributors from the CockroachDB community:

- Arjun Mahishi (first-time contributor, CockroachDB team member)
- Darryl Wong (first-time contributor, CockroachDB team member)
- David Hartunian (first-time contributor, CockroachDB team member)
- Xiaochen Cui (first-time contributor)

</div>

[#123518]: https://github.com/cockroachdb/cockroach/pull/123518
[#125504]: https://github.com/cockroachdb/cockroach/pull/125504
[#125538]: https://github.com/cockroachdb/cockroach/pull/125538
[#125562]: https://github.com/cockroachdb/cockroach/pull/125562
[#125804]: https://github.com/cockroachdb/cockroach/pull/125804
[#125806]: https://github.com/cockroachdb/cockroach/pull/125806
[#126097]: https://github.com/cockroachdb/cockroach/pull/126097
[#126156]: https://github.com/cockroachdb/cockroach/pull/126156
[#126184]: https://github.com/cockroachdb/cockroach/pull/126184
[#126201]: https://github.com/cockroachdb/cockroach/pull/126201
[#126216]: https://github.com/cockroachdb/cockroach/pull/126216
[#126295]: https://github.com/cockroachdb/cockroach/pull/126295
[#126298]: https://github.com/cockroachdb/cockroach/pull/126298
[#126565]: https://github.com/cockroachdb/cockroach/pull/126565
[#126598]: https://github.com/cockroachdb/cockroach/pull/126598
[#126691]: https://github.com/cockroachdb/cockroach/pull/126691
[#126728]: https://github.com/cockroachdb/cockroach/pull/126728
[#126819]: https://github.com/cockroachdb/cockroach/pull/126819
[#126839]: https://github.com/cockroachdb/cockroach/pull/126839
[#126841]: https://github.com/cockroachdb/cockroach/pull/126841
[#126852]: https://github.com/cockroachdb/cockroach/pull/126852
[#126937]: https://github.com/cockroachdb/cockroach/pull/126937
[#127091]: https://github.com/cockroachdb/cockroach/pull/127091
[#127608]: https://github.com/cockroachdb/cockroach/pull/127608
[44d16f97a]: https://github.com/cockroachdb/cockroach/commit/44d16f97a
[7fb249aa1]: https://github.com/cockroachdb/cockroach/commit/7fb249aa1
