## v24.1.4

Release Date: August 28, 2024

{% include releases/new-release-downloads-docker-image.md release=include.release %}
<h3 id="v24-1-4-security-updates">Security updates</h3>

- URLs in the following SQL statements are now sanitized of any secrets before being written to unredacted logs: - `BACKUP` - `RESTORE` - `CREATE SCHEDULE FOR BACKUP` - `ALTER BACKUP SCHEDULE` [#127506][#127506]
- URLs in the following SQL statements are now sanitized of any secrets before being written to unredacted logs: - `ALTER BACKUP` [#127506][#127506]
- URLs in the following SQL statements are now sanitized of any secrets before being written to unredacted logs: - `SHOW BACKUP` - `SHOW BACKUPS` [#127506][#127506]
- URLs in the following SQL statements are now sanitized of any secrets before being written to unredacted logs: - `CREATE CHANGEFEED` - `CREATE SCHEDULE FOR CHANGEFEED` - `ALTER CHANGEFEED SET sink` [#127506][#127506]
- URLs in the following SQL statements are now sanitized of any secrets before being written to unredacted logs: - `IMPORT` [#127506][#127506]
- URLs in the following SQL statements are now sanitized of any secrets before being written to unredacted logs: - `EXPORT` [#127506][#127506]
- URLs in the following SQL statements are now sanitized of any secrets before being written to unredacted logs: - `CREATE EXTERNAL CONNECTION` [#127506][#127506]
- URLs in the following SQL statements are now sanitized of any secrets before being written to unredacted logs: - `COPY` [#127506][#127506]

<h3 id="v24-1-4-{{-site.data.products.enterprise-}}-edition-changes">{{ site.data.products.enterprise }} edition changes</h3>

- Add a new Kafka sink utilizing the franz-go library and our own batching_sink behind a cluster setting (`changefeed.new_kafka_sink_enabled`, disabled by default). [#128018][#128018]
- The kafka v2 and pubsub sinks now displays notices indicating the topics it will emit to. [#128333][#128333]

<h3 id="v24-1-4-sql-language-changes">SQL language changes</h3>

- Added the sql.auth.grant_option_for_owner.enabled cluster setting. The default value is true, which results in behavior that matches the existing behavior of CockroachDB. When set to false, then the GRANT OPTION is not implcitly given to the owner of an object. The object owner still implicitly has all privileges on the object, just not the ability to grant them to other users. [#126959][#126959]
- Fix a bug in which the DISCARD statement was disallowed with `default_transaction_read_only = on`. [#127363][#127363]

<h3 id="v24-1-4-command-line-changes">Command-line changes</h3>

- A new `--locality-file` flag has been added to all server start commands. With this flag, locality configurations can be specified via a file, and this has the same effect as providing the file's contents directly via the `--locality` flag. [#127475][#127475]

<h3 id="v24-1-4-db-console-changes">DB Console changes</h3>

- The databases and tables pages in the DB Console will show a loading state while loading information for databases and tables including size and range counts. [#127748][#127748]
- In the DB details page, the table name will no longer appear with quotes around the schema and table name. [#127766][#127766]

<h3 id="v24-1-4-bug-fixes">Bug fixes</h3>

- A bug causing gateway nodes to crash while executing `INSERT` statements in `REGIONAL BY ROW` tables has been fixed. This bug has been present since version 23.2. [#127277][#127277]
- ALTER ROLE events in the DB Console event log now render correctly when the event does not contain any role options. [#126568][#126568]
- The sql_sequence_cached_node value of the serial_normalization setting was not correctly formatted. This could lead to errors while connecting to CockroachDB if the default value of serial_normalization was set to serial_normalization. The formatting bug was fixed, which also fixes the errors when connecting. [#127673][#127673]
- Dropping enum types values which were referenced by index expressions could fail with an error. [#127454][#127454]
- A bug has been fixed that caused a memory leak when executing SQL statements with comments, for example, `SELECT /* comment */ 1;`. Memory owned by a SQL session would continue to grow as these types of statements were executed. The memory would only be released when closing the SQL session. This bug has been present since version 23.1. [#127759][#127759]
- Addressed a bug where schema changes could hang if the lease range feed stopped getting updates. [#127487][#127487]
- Fixed small memory leaks that occur during changefeed creation. [#128018][#128018]
- Fixed a memory leak that could occur when specifying a non-existent virtual cluster name in the connection string. [#128106][#128106]
- The sql_sequence_cached_node value of the serial_normalization setting was not correctly formatted. This could lead to errors while connecting to CockroachDB if the default value of serial_normalization was set to serial_normalization. The formatting bug was fixed, which also fixes the errors when connecting. [#128324][#128324]
- Fixed a bug where CREATE INDEX IF NOT EXISTS would not correctly short-circuit if the given index already existed. [#128311][#128311]
- Fixed a bug in overly eagier syntax validation, in which the DESCENDING clause was not allowed for non-terminal columns of an inverted index. Only the last column of an inverted index should be prevented from being DESCENDING, and this is properly checked now. [#128311][#128311]
- Fixed a bug where an index could store a column in the primary index if that column had a mixed-case name. [#128311][#128311]
- Setting or dropping a default value on a computed column is now blocked -- even for null defaults. Previously, setting or dropping a default value on a computed column was a no-op. [#128466][#128466]
- Fixed a bug that could cause spurious user permission errors when multiple databases shared a common schema with a routine referencing a table. The bug has existed since UDFs were introduced in v22.2. [#126412][#126412]
- This patch fixes the bug where debug zip is giving error while fetching unstructured/malformed logs. [#128605][#128605]
- Fixed a bug where a hash sharded constraint could not be created if it referred to columns that had a backslash in the name. [#128521][#128521]
- Fix a bug in which output of `EXPLAIN (OPT, REDACT)` of various CREATE statements was not redacted. This bug has existed since `EXPLAIN (REDACT)` was introduced in v23.1 and affects the following statements: - `EXPLAIN (OPT, REDACT) CREATE TABLE` - `EXPLAIN (OPT, REDACT) CREATE VIEW` - `EXPLAIN (OPT, REDACT) CREATE FUNCTION` [#128489][#128489]

<h3 id="v24-1-4-miscellaneous">Miscellaneous</h3>

<h4 id="v24-1-4-changes-without-release-note-annotation">Changes without release note annotation</h4>

- [#128625][#128625] [eefaac961][eefaac961] release-24.1: roachtest: revert workload cpu change for all ycsb variants
- [#128348][#128348] [170656f4a][170656f4a] release-24.1: roachtest: fix ycsb regression by giving workload node more cpu
- [#128348][#128348] [d0337dc3d][d0337dc3d] release-24.1: roachtest: fix ycsb regression by giving workload node more cpu
- [#128189][#128189] [656dc596e][656dc596e] release-24.1: roachtest: add RequiresDeprecatedWorkload testSpec
- [#128189][#128189] [3b9f14556][3b9f14556] release-24.1: roachtest: add RequiresDeprecatedWorkload testSpec
- [#128185][#128185] [f04d25e57][f04d25e57] release-24.1: roachtest: use cockroach workload in kv tests
- [#127637][#127637] [633a858c9][633a858c9] release-24.1: roachprod: test selector for aws
- [#127390][#127390] [b5560ebc1][b5560ebc1] release-24.1: mixedversion: don't find all predecessors if skip version is not available

<h3 id="v24-1-4-doc-updates">Doc updates</h3>

{% comment %}Docs team: Please add these manually.{% endcomment %}

</div>

[#126412]: https://github.com/cockroachdb/cockroach/pull/126412
[#126568]: https://github.com/cockroachdb/cockroach/pull/126568
[#126959]: https://github.com/cockroachdb/cockroach/pull/126959
[#127277]: https://github.com/cockroachdb/cockroach/pull/127277
[#127363]: https://github.com/cockroachdb/cockroach/pull/127363
[#127390]: https://github.com/cockroachdb/cockroach/pull/127390
[#127454]: https://github.com/cockroachdb/cockroach/pull/127454
[#127475]: https://github.com/cockroachdb/cockroach/pull/127475
[#127487]: https://github.com/cockroachdb/cockroach/pull/127487
[#127506]: https://github.com/cockroachdb/cockroach/pull/127506
[#127637]: https://github.com/cockroachdb/cockroach/pull/127637
[#127673]: https://github.com/cockroachdb/cockroach/pull/127673
[#127748]: https://github.com/cockroachdb/cockroach/pull/127748
[#127759]: https://github.com/cockroachdb/cockroach/pull/127759
[#127766]: https://github.com/cockroachdb/cockroach/pull/127766
[#128018]: https://github.com/cockroachdb/cockroach/pull/128018
[#128106]: https://github.com/cockroachdb/cockroach/pull/128106
[#128185]: https://github.com/cockroachdb/cockroach/pull/128185
[#128189]: https://github.com/cockroachdb/cockroach/pull/128189
[#128311]: https://github.com/cockroachdb/cockroach/pull/128311
[#128324]: https://github.com/cockroachdb/cockroach/pull/128324
[#128333]: https://github.com/cockroachdb/cockroach/pull/128333
[#128348]: https://github.com/cockroachdb/cockroach/pull/128348
[#128466]: https://github.com/cockroachdb/cockroach/pull/128466
[#128489]: https://github.com/cockroachdb/cockroach/pull/128489
[#128521]: https://github.com/cockroachdb/cockroach/pull/128521
[#128605]: https://github.com/cockroachdb/cockroach/pull/128605
[#128625]: https://github.com/cockroachdb/cockroach/pull/128625
[170656f4a]: https://github.com/cockroachdb/cockroach/commit/170656f4a
[3b9f14556]: https://github.com/cockroachdb/cockroach/commit/3b9f14556
[633a858c9]: https://github.com/cockroachdb/cockroach/commit/633a858c9
[656dc596e]: https://github.com/cockroachdb/cockroach/commit/656dc596e
[b5560ebc1]: https://github.com/cockroachdb/cockroach/commit/b5560ebc1
[d0337dc3d]: https://github.com/cockroachdb/cockroach/commit/d0337dc3d
[eefaac961]: https://github.com/cockroachdb/cockroach/commit/eefaac961
[f04d25e57]: https://github.com/cockroachdb/cockroach/commit/f04d25e57
