## v24.1.3

Release Date: August 1, 2024

{% include releases/new-release-downloads-docker-image.md release=include.release %}

<h3 id="v24-1-3-sql-language-changes">SQL language changes</h3>

- EXPLAIN ANALYZE statements are now supported when executed via UI SQL shell. [#125563][#125563]
- Added the sql.auth.grant_option_inheritance.enabled cluster setting. The default value is true, which results in behavior that matches the existing behavior of CockroachDB. When set to false, then the GRANT OPTION is not inherited via role membership, which will prevent the descendant roles from being able to grant the privilege to others. The privilege itself is still inherited via role membership. [#126300][#126300]

<h3 id="v24-1-3-operational-changes">Operational changes</h3>

- Crdb_internal.cluster_execution_insights.txt and crdb_internal.cluster_txn_execution_insights.txt have been removed from the debug zip. These files contained cluster-wide insights for statements and transactions. Users can still rely on the per-node execution insights in crdb_internal.node_execution_insights.txt and crdb_internal.node_txn_execution_insights.txt. [#125807][#125807]
- Fixed a bug where collection of debug information for very long-running jobs could use excessive space in the job_info system table and/or cause some interactions with the jobs system to become slow.  Epic: none. [#126122][#126122]
- For the TELEMETRY channel, TCL `sampled_query` events will now be sampled along with DML statements according to the setting `sql.telemetry.query_sampling.max_event_frequency`. [#126729][#126729]

<h3 id="v24-1-3-bug-fixes">Bug fixes</h3>

- Fix a bug where a change to a user-defined type could cause queries against tables using that type to fail with an error message like:    "histogram.go:694: span must be fully contained in the bucket"  The change to the user-defined type could come directly from an ALTER TYPE statement, or indirectly from an ALTER DATABASE ADD REGION or DROP REGION statement (which implicitly change the crdb_internal_region type).  This bug has existed since UDTs were introduced in v20.2. [#125800][#125800]
- Fix a bug in which constant LIKE patterns containing certain sequences of backslashes did not become constrained scans. This bug has been present since v21.1.13 when support for building constrained scans from LIKE patterns containing backslashes was added. [#125539][#125539]
- Fixed the statistics estimation code in the optimizer so it does not use the empty histograms produced if histogram collection has been disabled during stats collection due to excessive memory utilization. Now the optimizer will rely on distinct counts instead of the empty histograms and should produce better plans as a result. This bug has existed since CockroachDB v22.1. [#126153][#126153]
- CREATE TABLE with index expressions could hit undefined column errors on transaction retries [#125967][#125967]
- Previously, CockroachDB would hit an internal error when evaluating INSERTs into REGIONAL BY ROW tables where the source is a VALUES clause with a single row and at least one boolean expression, and this is now fixed. The bug was introduced in 23.2.0 release. [#125505][#125505]
- Fix the bug in tsdump where the command fails when a custom SQL port is used and the `--format=raw` flag is provided [#125980][#125980]
- Fixed a bug where a user-defined function that shared a name with a builtin function would not be resolved, even if it had higher precedence from the search_path variable. [#126296][#126296]
- Background jobs no longer respect a statement timeout. [#126820][#126820]
- DROP REGION can fail if any tables under a given database have indexes on expressions. [#126599][#126599]
- Previously, CockroachDB would hit an internal error when evaluating INSERTs into REGIONAL BY ROW tables where the source is a VALUES clause with a single row and at least one boolean expression, and this is now fixed. The bug was introduced in 23.2.0 release. [#126846][#126846]
- Fixed postgres incompatibility bug when inputting public as user name for builtin functions such as has_database_privilege and has_schema_privilege.  Release justification: Bug fix. [#126851][#126851]
- Fixed bug where we restore a database with a composite type. [#126428][#126428]
- Database overview and db details pages should not crash if the range information is not available. [#127092][#127092]
- Previously, CockroachDB could incorrectly evaluate `IS NOT NULL` filter if it was applied to non-NULL tuples that had NULL elements (like `(1, NULL)` or `(NULL, NULL)`). The bug is present since 20.2 version and is now fixed. [#126938][#126938]
- The sql_sequence_cached_node value of the serial_normalization setting was not correctly formatted. This could lead to errors while connecting to CockroachDB if the default value of serial_normalization was set to serial_normalization. The formatting bug was fixed, which also fixes the errors when connecting. [#127675][#127675]

<h3 id="v24-1-3-performance-improvements">Performance improvements</h3>

- Starting a cockroach process will no longer flush buffered logs to configured logging sinks unless the process is running under systemd, where cockroach runs with the `NOTIFY_SOCKET` environment variable. [#126305][#126305]
- Schema changes that cause a data backfill, such as adding a non-nullable column or changing the primary key, now will split and scatter the temporary indexes used to perform the change. This reduces the chance of causing a write hotspot that can slow down foreground traffic. [#126684][#126684]

<h3 id="v24-1-3-miscellaneous">Miscellaneous</h3>

<h4 id="v24-1-3-changes-without-release-note-annotation">Changes without release note annotation</h4>

- [#127164][#127164] [8af30f07a][8af30f07a] release-24.1: backupccl: skip backup/assume-role on aws (Michael Butler <butler@cockroachlabs.com>)
- [#126267][#126267] [ac2969259][ac2969259] release-24.1: roachtest/test-selector: run selective tests (Bhaskarjyoti Bora <bhaskar.bora@cockroachlabs.com>)

<h3 id="v24-1-3-doc-updates">Doc updates</h3>

{% comment %}Docs team: Please add these manually.{% endcomment %}

<div class="release-note-contributors" markdown="1">

<h3 id="v24-1-3-contributors">Contributors</h3>

This release includes 122 merged PRs by 39 authors.
We would like to thank the following contributors from the CockroachDB community:

- Arjun Mahishi (first-time contributor, CockroachDB team member)
- Darryl Wong (first-time contributor, CockroachDB team member)
- David Hartunian (first-time contributor, CockroachDB team member)
- Xiaochen Cui (first-time contributor)
- lyang24

</div>

[#125505]: https://github.com/cockroachdb/cockroach/pull/125505
[#125539]: https://github.com/cockroachdb/cockroach/pull/125539
[#125563]: https://github.com/cockroachdb/cockroach/pull/125563
[#125800]: https://github.com/cockroachdb/cockroach/pull/125800
[#125807]: https://github.com/cockroachdb/cockroach/pull/125807
[#125967]: https://github.com/cockroachdb/cockroach/pull/125967
[#125980]: https://github.com/cockroachdb/cockroach/pull/125980
[#126122]: https://github.com/cockroachdb/cockroach/pull/126122
[#126153]: https://github.com/cockroachdb/cockroach/pull/126153
[#126267]: https://github.com/cockroachdb/cockroach/pull/126267
[#126296]: https://github.com/cockroachdb/cockroach/pull/126296
[#126300]: https://github.com/cockroachdb/cockroach/pull/126300
[#126305]: https://github.com/cockroachdb/cockroach/pull/126305
[#126428]: https://github.com/cockroachdb/cockroach/pull/126428
[#126599]: https://github.com/cockroachdb/cockroach/pull/126599
[#126684]: https://github.com/cockroachdb/cockroach/pull/126684
[#126729]: https://github.com/cockroachdb/cockroach/pull/126729
[#126820]: https://github.com/cockroachdb/cockroach/pull/126820
[#126846]: https://github.com/cockroachdb/cockroach/pull/126846
[#126851]: https://github.com/cockroachdb/cockroach/pull/126851
[#126938]: https://github.com/cockroachdb/cockroach/pull/126938
[#127092]: https://github.com/cockroachdb/cockroach/pull/127092
[#127164]: https://github.com/cockroachdb/cockroach/pull/127164
[#127675]: https://github.com/cockroachdb/cockroach/pull/127675
[8af30f07a]: https://github.com/cockroachdb/cockroach/commit/8af30f07a
[ac2969259]: https://github.com/cockroachdb/cockroach/commit/ac2969259
