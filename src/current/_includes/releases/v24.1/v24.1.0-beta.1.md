## v24.1.0-beta.1

Release Date: April 17, 2024

{% include releases/release-downloads-docker-image.md release=include.release %}

<h3 id="v24-1-0-beta-1-sql-language-changes">SQL language changes</h3>

- SHOW JOBS no longer shows some internal retry counter columns (`last_run`, `next_run`, `num_runs`) and now only shows the `statement`, 'trace_id` and `execution_errors` columns when inspecting a specific job ID or IDs.  Epic: none. [#121286][#121286]
- SHOW JOBS now shortens long job descriptions to 100 characters to make the table easier to read while the full description and statement can be inspected using SHOW JOB or SHOW JOBS on specific Job IDs. Epic: none. [#121286][#121286]
- Extend pg_depend to include dependencies between UDFs. [#121313][#121313]
- With sql_safe_updates set to true, SELECT FOR UPDATE and SELECT FOR SHARE statements now return an error if they do not contain either a WHERE clause or LIMIT clause.  Also, UPDATE and DELETE statements without WHERE clauses but with LIMIT clauses now bypass sql_safe_updates, which better matches MySQL behavior. [#121466][#121466]
- Added support for PL/pgSQL CALL statements. It is now possible to call a stored procedure from a PL/pgSQL routine. [#121743][#121743]
- DEFAULT expressions for input parameters of user-defined functions and stored procedures are now supported. [#121811][#121811]

<h3 id="v24-1-0-beta-1-command-line-changes">Command-line changes</h3>

- The `--enterprise-encryption` flag now accepts the special value `path=*` to apply the specified keys to all stores. [#121111][#121111]

<h3 id="v24-1-0-beta-1-db-console-changes">DB Console changes</h3>

- The "Commit Latency" chart in the changefeed dashboard now aggregates by max instead of by sum for multi-node changefeeds. This more accurately reflects the amount of time for events to be acknowledged by the downstream sink. [#120787][#120787]
- Show license expiration message in Db Console (top right corner in primary header) that indicates remaining days before license expires for clusters with enterprise or trial license. [#120830][#120830]
- The jobs table page no longer includes two columns related to a deprecated internal implementation detail (last execution time and execution count).  Epic: none. [#121286][#121286]

<h3 id="v24-1-0-beta-1-bug-fixes">Bug fixes</h3>

- Sequence options for 'NO MINVALUE' and 'NO MAXVALUE' now replicate postgreSQL.  Sequence MINVALUE and MAXVALUE automatical adjust to new types bounds mirroring behavior of postgreSQL. [#121310][#121310]
- The timeseries graphs shown on the SQL Activity statement details page in DB Console will now render properly, after fixing a bug related to setting the time range of the charts. [#121461][#121461]
- CockroachDB could previously "leak" reported memory usage (as accounted by the internal memory accounting system, the limit for which is configured via --max-sql-memory flag) on long-running sessions that issue many (hundreds of thousands or more) transactions. This, in turn, could result in "root: memory budget exceeded" errors for other queries. The bug is present in versions 23.1.17 and 23.2.3 and is now fixed. [#121873][#121873]
- CockroachDB could previously incorrectly evaluate IN expressions that had INT2 or INT4 type on the left side and values outside of the range of the left side on the right side. The bug has been present since at least 21.1 and is now fixed. [#121954][#121954]
- Index recommendations in the DB Console will now function properly for indexes on tables/columns whose names contain quotation marks and/or whitespace. For example: `CREATE INDEX ON "my table" ("my col");` [#122120][#122120]

<h3 id="v24-1-0-beta-1-miscellaneous">Miscellaneous</h3>

<h4 id="v24-1-0-beta-1-missing-category">Missing category</h4>

- Fixed a slow memory leak in deprecated pubsub changefeeds which can accumulate when restarting/cancelling many deprecated pubsub changefeeds. The bug had been there since the deprecated pubsub was introduced in 22.1 (beta). [#121867][#121867]

<h4 id="v24-1-0-beta-1-changes-without-release-note-annotation">Changes without release note annotation</h4>

- [#121356][#121356] [ff37ce413][ff37ce413] release-24.1: sql: version gate create of new job type (Steven Danna <danna@cockroachlabs.com>)

<h3 id="v24-1-0-beta-1-doc-updates">Doc updates</h3>

{% comment %}Docs team: Please add these manually.{% endcomment %}

<div class="release-note-contributors" markdown="1">

<h3 id="v24-1-0-beta-1-contributors">Contributors</h3>

This release includes 134 merged PRs by 36 authors.
We would like to thank the following contributors from the CockroachDB community:

- Andrew Delph
- Darryl Wong (first-time contributor, CockroachDB team member)
- David Hartunian (first-time contributor, CockroachDB team member)
- Rachael Harding (first-time contributor, CockroachDB team member)
- Vidit Bhat (first-time contributor, CockroachDB team member)
- lyang24

</div>

[#120787]: https://github.com/cockroachdb/cockroach/pull/120787
[#120830]: https://github.com/cockroachdb/cockroach/pull/120830
[#121111]: https://github.com/cockroachdb/cockroach/pull/121111
[#121286]: https://github.com/cockroachdb/cockroach/pull/121286
[#121310]: https://github.com/cockroachdb/cockroach/pull/121310
[#121313]: https://github.com/cockroachdb/cockroach/pull/121313
[#121356]: https://github.com/cockroachdb/cockroach/pull/121356
[#121461]: https://github.com/cockroachdb/cockroach/pull/121461
[#121466]: https://github.com/cockroachdb/cockroach/pull/121466
[#121743]: https://github.com/cockroachdb/cockroach/pull/121743
[#121811]: https://github.com/cockroachdb/cockroach/pull/121811
[#121867]: https://github.com/cockroachdb/cockroach/pull/121867
[#121873]: https://github.com/cockroachdb/cockroach/pull/121873
[#121954]: https://github.com/cockroachdb/cockroach/pull/121954
[#122120]: https://github.com/cockroachdb/cockroach/pull/122120
[ff37ce413]: https://github.com/cockroachdb/cockroach/commit/ff37ce413
