## v24.1.0-beta.3

Release Date: April 30, 2024

{% include releases/release-downloads-docker-image.md release=include.release %}

<h3 id="v24-1-0-beta-3-sql-language-changes">SQL language changes</h3>

- `object_type` can now be seen with the show grants command and relation_name column is now shown as object_name. [#122823][#122823]
- External connection granted privileges can now be seen with the SHOW GRANTS command. [#122823][#122823]
- Introduce three new cluster settings for controlling table statistics forecasting:  1. `sql.stats.forecasts.min_observations` is the minimum number of    observed statistics required to produce a forecast.  2. `sql.stats.forecasts.min_goodness_of_fit` is the minimum RÂ² (goodness    of fit) measurement required from all predictive models to use a    forecast.  3. `sql.stats.forecasts.max_decrease` is the most a prediction can    decrease, expressed as the minimum ratio of the prediction to the    lowest prior observation. [#122459][#122459]

<h3 id="v24-1-0-beta-3-command-line-changes">Command-line changes</h3>

- Added `--max-concurrency` flag to `debug recover` commands to control the maximum concurrency when fanning out RPCs to nodes in the cluster. The flag defaults to `2 x num_cpus`. [#123064][#123064]

<h3 id="v24-1-0-beta-3-bug-fixes">Bug fixes</h3>

- Add automated clean up / validation for dropped roles inside descriptors. [#122701][#122701]
- Client Certificate Auth combined with identity maps(server.identity_map.configuration) was broken in 23.1. This bug is fixed; note that the feature to work correctly, the client must specify a valid db user in connection string. [#122738][#122738]
- Fixed an issue where the row-based execution engine could drop a LIMIT clause when there was an ORDER BY clause, and the ordering was partially provided by an input operator. For example, this bug could occur with an ordering such as `ORDER BY a, b` when the scanned index was only ordered on column `a`. The impact of this bug was that more rows may have been returned than specified by the LIMIT clause. This bug is only present when not using the vectorized execution engine, i.e., when running with `SET vectorize = off;`. The bug has existed since CockroachDB version 22.1. [#122837][#122837]
- Previously, CockroachDB could run in an internal error when evaluating PLpgSQL routines with nested blocks in some cases. The bug is only present in 24.1.0-beta versions and is now fixed. [#122939][#122939]
- Fix a bug where UPDATE and UPSERT queries with a subquery were sometimes inappropriately using implicit FOR-UPDATE locking within the subquery. This bug has existing since implicit FOR-UPDATE locking was introduced in 20.1.0. [#121391][#121391]
- Dropping and adding a column with the same name no longer results in a "column already exists error". [#122631][#122631]
- Fixed a bug that could cause an internal error of the form `invalid datum type given: ..., expected ...` when a RECORD-returning UDF used as a data source was supplied a column definition list with mismatched types. This bug has existed since v23.1.0. [#122305][#122305]
- Fixed a bug that could result in an internal error when attempting to create a PL/pgSQL routine using the (currently unsupported) `%ROWTYPE` syntax for a variable declaration. [#122966][#122966]
- CockroachDB could previously run into an assertion error when evaluating PLpgSQL routines that invoke procedures while using DEFAULT arguments. The bug is present in 24.1.0-beta releases and is now fixed. [#122943][#122943]
- Privileges granted for external connections were incorrectly showing up in SHOW SYSTEM GRANTS, but were not useful since there is no associated object name. Now they do not appear there. Instead, the SHOW GRANTS ON EXTERNAL CONNECTION should be used. [#122857][#122857]
- Statistics forecasts of zero rows can cause bad plans. This commit changes forecasting to avoid predicting zero rows for most downward-trending statistics. [#122459][#122459]
- Fixed a bug introduced in v23.2 that could cause a PL/pgSQL variable assignment to not be executed if the variable was never referenced after the assignment. [#123045][#123045]

<h3 id="v24-1-0-beta-3-performance-improvements">Performance improvements</h3>

- More efficient query plans are now generated for queries with text similarity filters, e.g., `text_col % 'foobar'`. These plans are generated if the `optimizer_use_trigram_similarity_optimization` session setting is enabled. It is disabled by default. [#122838][#122838]
- The optimizer now costs distinct-on operators more accurately. It may produce more efficient query plans in some cases. [#122850][#122850]
- Speed up optimization of some statements using GROUP BY or DISTINCT or ON CONFLICT by skipping optimizer rule SplitGroupByScanIntoUnionScans when it is not needed. [#123034][#123034]

<h3 id="v24-1-0-beta-3-miscellaneous">Miscellaneous</h3>

<h4 id="v24-1-0-beta-3-changes-without-release-note-annotation">Changes without release note annotation</h4>

- [#122774][#122774] [0b204160e][0b204160e] release 24.1: Revert "backupccl: allocate work on index level" (Michael Butler <butler@cockroachlabs.com>)
- [#122774][#122774] [cfd2c9d06][cfd2c9d06] release 24.1: Revert "backupccl: allocate work on index level" (Michael Butler <butler@cockroachlabs.com>)

<h3 id="v24-1-0-beta-3-doc-updates">Doc updates</h3>

{% comment %}Docs team: Please add these manually.{% endcomment %}

<div class="release-note-contributors" markdown="1">

<h3 id="v24-1-0-beta-3-contributors">Contributors</h3>

This release includes 56 merged PRs by 25 authors.
We would like to thank the following contributors from the CockroachDB community:

- BabuSrithar (first-time contributor, CockroachDB team member)
- Bergin Dedej (first-time contributor, CockroachDB team member)
- Rachael Harding (first-time contributor, CockroachDB team member)

</div>

[#121391]: https://github.com/cockroachdb/cockroach/pull/121391
[#122305]: https://github.com/cockroachdb/cockroach/pull/122305
[#122459]: https://github.com/cockroachdb/cockroach/pull/122459
[#122631]: https://github.com/cockroachdb/cockroach/pull/122631
[#122701]: https://github.com/cockroachdb/cockroach/pull/122701
[#122738]: https://github.com/cockroachdb/cockroach/pull/122738
[#122774]: https://github.com/cockroachdb/cockroach/pull/122774
[#122823]: https://github.com/cockroachdb/cockroach/pull/122823
[#122837]: https://github.com/cockroachdb/cockroach/pull/122837
[#122838]: https://github.com/cockroachdb/cockroach/pull/122838
[#122850]: https://github.com/cockroachdb/cockroach/pull/122850
[#122857]: https://github.com/cockroachdb/cockroach/pull/122857
[#122939]: https://github.com/cockroachdb/cockroach/pull/122939
[#122943]: https://github.com/cockroachdb/cockroach/pull/122943
[#122966]: https://github.com/cockroachdb/cockroach/pull/122966
[#123034]: https://github.com/cockroachdb/cockroach/pull/123034
[#123045]: https://github.com/cockroachdb/cockroach/pull/123045
[#123064]: https://github.com/cockroachdb/cockroach/pull/123064
[0b204160e]: https://github.com/cockroachdb/cockroach/commit/0b204160e
[cfd2c9d06]: https://github.com/cockroachdb/cockroach/commit/cfd2c9d06
