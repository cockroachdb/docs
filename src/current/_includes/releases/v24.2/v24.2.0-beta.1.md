## v24.2.0-beta.1

Release Date: July 18, 2024

{% include releases/new-release-downloads-docker-image.md release=include.release %}

<h3 id="v24-2-0-beta-1-security-updates">Security updates</h3>

- Added support for a custom certificate authority (CA) to verify certificates from the JWT issuer domain, which hosts the JSON Web Key Set (JWKS) configuration that is fetched to validate JWTs. Added the new cluster setting `server.jwt_authentication.issuer_custom_ca` to set the custom root CA.
[#126062][#126062]

<h3 id="v24-2-0-beta-1-general-changes">General changes</h3>

- [Job]({% link v24.2/show-jobs.md %}) status changes now log events to the [OPS channel]({% link v24.2/logging.md %}#logging-channels), indicating the previous status and new status. [#125319][#125319]

<h3 id="v24-2-0-beta-1-{{-site.data.products.enterprise-}}-edition-changes">{{ site.data.products.enterprise }} edition changes</h3>

- A new cluster setting, `server.oidc_authentication.client.timeout`, allows administrators to configure the HTTP client timeout for external calls made during [OIDC authentication]({% link v24.2/sso-db-console.md %}). The default timeout is 30 seconds. [#125767][#125767]
- The [Kafka sink for changefeeds]({% link v24.2/changefeed-sinks.md %}) now supports authentication using AWS IAM roles, providing a more secure method for connecting to AWS Managed Streaming for Apache Kafka (MSK) clusters. [#125745][#125745]

<h3 id="v24-2-0-beta-1-sql-language-changes">SQL language changes</h3>

- Added [pgvector](https://github.com/pgvector/pgvector) encoding, decoding, and operators, without index acceleration. [#124292][#124292]
- Added support for generic query plans, which reduce the computational burden of query optimization by caching and reusing plans in later executions of the same statement. "Custom" query plans are optimized on every execution, while "generic" plans are optimized once and reused on future executions as-is. Generic query plans are beneficial in cases where query optimization contributes significant overhead to the total cost of executing a query. [#126528][#126528] [#127012][#127012]
  - When the session setting `plan_cache_mode` is set to `auto`, the system automatically determines whether to use custom or generic query plans for the execution of a prepared statement. 
  - When the session setting `plan_cache_mode` is set to `force_generic_plan`, prepared statements will reuse optimized query plans without re-optimization, as long as the plans do not become stale due to schema changes or new table statistics.
  - The setting is used during `EXECUTE` commands.
  - The `EXPLAIN ANALYZE` output will include a `plan type` field that displays: 
    - `generic, re-optimized` if the plan is optimized for the current execution.
    - `generic, reused` if the plan is reused without re-optimization.
    - `custom` for other plans.
- `SHOW GRANTS` for a role now includes privileges inherited from the `public` role, which is a [default role]({% link v24.2/security-reference/authorization.md %}#default-roles) defined on every cluster. [#127086][#127086]

<h3 id="v24-2-0-beta-1-operational-changes">Operational changes</h3>

- For the [TELEMETRY channel]({% link v24.2/logging.md %}#telemetry), TCL `sampled_query` events will now be sampled at the rate specified by the setting `sql.telemetry.query_sampling.max_event_frequency`, which is already used to limit the rate of sampling DML statements. [#126484][#126484]
- The encode-uri command now supports the --certs-dir option as an alternative to passing individual cert paths.  Epic: none. [#126793][#126793]

<h3 id="v24-2-0-beta-1-command-line-changes">Command-line changes</h3>

- The `cockroach node drain` command now has an optional --shutdown flag. When set, the node will shutdown after draining successfully completes. [#126950][#126950]

<h3 id="v24-2-0-beta-1-db-console-changes">DB Console changes</h3>

- Fix expand/collapse icon for tables with expandable rows (on Node Overview page) [#126639][#126639]

<h3 id="v24-2-0-beta-1-bug-fixes">Bug fixes</h3>

- Fast path inserts into regional by row tables with uniqueness constraints are now possible under read-commited isolation. [#126504][#126504]
- `sql.stats.discarded.current` metric was incorrect as it was missing the discarded statement count. It now accurately reports both discarded statement and transaction stats. [#126585][#126585]
- Database overview and db details pages should not crash if the range information is not available. [#126419][#126419]
- Background jobs no longer respect a statement timeout. [#126336][#126336]
- Fixed a bug when creating partial statistics using extremes (which is disabled by default) where it would occasionally fail to merge the new partial stat with existing full stats. This occurs when outer buckets were added to either statistic to account for extra distinct count. [#126830][#126830]
- Fixed a bug when creating partial statistics using extremes (which is disabled by default) where it would result in a merged statistic with inaccurate distinct counts. Also made the merged statistic computation more efficient. [#126830][#126830]
- Fixed bug where zone configs on pkeys disappeared during truncate. [#126531][#126531]

<h3 id="v24-2-0-beta-1-performance-improvements">Performance improvements</h3>

- The query optimizer now generates more efficient plans for queries with clauses like `ORDER BY col ASC NULLS LAST` and `ORDER BY col DESC NULLS FIRST` when `col` is guaranteed to not be `NULL`. [#126685][#126685]

<h3 id="v24-2-0-beta-1-miscellaneous">Miscellaneous</h3>

<h4 id="v24-2-0-beta-1-changes-without-release-note-annotation">Changes without release note annotation</h4>

- [#127166][#127166] [8848bc872][8848bc872] release-24.2: backupccl: skip backup/assume-role on aws (Michael Butler <butler@cockroachlabs.com>)
- [#126708][#126708] [5f01c40e1][5f01c40e1] build: add script to build fuzzers in oss-fuzz (Nukitt <nukit.tailor@cockroachlabs.com>)
- [#126747][#126747] [f1f61a85b][f1f61a85b] roachtest: add manual compaction operation (Bhaskarjyoti Bora <bhaskar.bora@cockroachlabs.com>)
- [#126575][#126575] [ba758c080][ba758c080] kv: add support for Lease.MinExpiration (Nathan VanBenschoten <nvanbenschoten@gmail.com>)
- [#unknown][#unknown] [7d0a01a94][7d0a01a94] Merge pull request from GHSA-xp59-5w32-m8w3 (Ricky Stewart <ricky@cockroachlabs.com>)

<h3 id="v24-2-0-beta-1-doc-updates">Doc updates</h3>

{% comment %}Docs team: Please add these manually.{% endcomment %}

<div class="release-note-contributors" markdown="1">

<h3 id="v24-2-0-beta-1-contributors">Contributors</h3>

This release includes 96 merged PRs by 49 authors.
We would like to thank the following contributors from the CockroachDB community:

- Arjun Mahishi
- Gourav Kumar (first-time contributor, CockroachDB team member)
- Rima Deodhar (first-time contributor, CockroachDB team member)
- Rohit Sanjay (first-time contributor)
- Wenyi Hu (first-time contributor, CockroachDB team member)
- cty123
- lyang24

</div>

[#103156]: https://github.com/cockroachdb/cockroach/pull/103156
[#124292]: https://github.com/cockroachdb/cockroach/pull/124292
[#125319]: https://github.com/cockroachdb/cockroach/pull/125319
[#125745]: https://github.com/cockroachdb/cockroach/pull/125745
[#125767]: https://github.com/cockroachdb/cockroach/pull/125767
[#126062]: https://github.com/cockroachdb/cockroach/pull/126062
[#126336]: https://github.com/cockroachdb/cockroach/pull/126336
[#126419]: https://github.com/cockroachdb/cockroach/pull/126419
[#126484]: https://github.com/cockroachdb/cockroach/pull/126484
[#126504]: https://github.com/cockroachdb/cockroach/pull/126504
[#126528]: https://github.com/cockroachdb/cockroach/pull/126528
[#126531]: https://github.com/cockroachdb/cockroach/pull/126531
[#126575]: https://github.com/cockroachdb/cockroach/pull/126575
[#126585]: https://github.com/cockroachdb/cockroach/pull/126585
[#126639]: https://github.com/cockroachdb/cockroach/pull/126639
[#126685]: https://github.com/cockroachdb/cockroach/pull/126685
[#126708]: https://github.com/cockroachdb/cockroach/pull/126708
[#126747]: https://github.com/cockroachdb/cockroach/pull/126747
[#126793]: https://github.com/cockroachdb/cockroach/pull/126793
[#126830]: https://github.com/cockroachdb/cockroach/pull/126830
[#126950]: https://github.com/cockroachdb/cockroach/pull/126950
[#127012]: https://github.com/cockroachdb/cockroach/pull/127012
[#127086]: https://github.com/cockroachdb/cockroach/pull/127086
[#127124]: https://github.com/cockroachdb/cockroach/pull/127124
[#127166]: https://github.com/cockroachdb/cockroach/pull/127166
[#unknown]: https://github.com/cockroachdb/cockroach/pull/unknown
[5f01c40e1]: https://github.com/cockroachdb/cockroach/commit/5f01c40e1
[7d0a01a94]: https://github.com/cockroachdb/cockroach/commit/7d0a01a94
[8848bc872]: https://github.com/cockroachdb/cockroach/commit/8848bc872
[ba758c080]: https://github.com/cockroachdb/cockroach/commit/ba758c080
[f1f61a85b]: https://github.com/cockroachdb/cockroach/commit/f1f61a85b
