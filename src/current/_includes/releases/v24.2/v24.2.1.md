## v24.2.1

Release Date: September 5, 2024

{% include releases/new-release-downloads-docker-image.md release=include.release %}
<h3 id="v24-2-1-security-updates">Security updates</h3>

- The cluster setting `server.jwt_authentication.issuers` is now changed to client facing name `server.jwt_authentication.issuers.configuration` to be reflective of the value the setting can take. This can be set to one of the following values: 1. Simple string that Go can parse as a valid issuer URL. 2. String that can be parsed as valid JSON array of issuer URLs list. 3. String that can be parsed as valid JSON and deserialized into a map of issuer URLs to corresponding JWKS URIs. In the third case we will be overriding the JWKS URI present in the issuer's well-known endpoint. Example valid values: - 'https://accounts.google.com' - ['example.com/adfs','https://accounts.google.com'] - '{    "issuer_jwks_map": {        "https://accounts.google.com": "https://www.googleapis.com/oauth2/v3/certs",        "example.com/adfs": "https://example.com/adfs/discovery/keys"     }    }' When `issuer_jwks_map` is set, we directly use the JWKS URI to get the key set. In all other cases where JWKSAutoFetchEnabled is set we obtain the JWKS URI first from issuer's well-known endpoint and then use this endpoint. [#128178][#128178]

<h3 id="v24-2-1-{{-site.data.products.enterprise-}}-edition-changes">{{ site.data.products.enterprise }} edition changes</h3>

- The kafka v2 and pubsub sinks now displays notices indicating the topics it will emit to. [#128332][#128332]
- The new Kafka v2 sink is now enabled by default. [#128700][#128700]

<h3 id="v24-2-1-operational-changes">Operational changes</h3>

- The cluster setting, storage.ingestion.value_blocks.enabled can be set to false if a pathological huge range happens to occur in a cluster, and incoming snapshots of that range are causing OOMs. [#128098][#128098]
- There are now structured logging events that report connection breakage during node shutdown. Previously, these logs existed but were unstructured. These logs appear in the OPS logging channel. There are two new events: - The node_shutdown_connection_timeout event is logged after the timeout   defined by server.shutdown.connections.timeout transpires, if there   are still open SQL connections. - The node_shutdown_transaction_timeout event is logged after the   timeout defined by server.shutdown.transactions.timeout transpires, if   there are still open transactions on those SQL connections. [#128712][#128712]

<h3 id="v24-2-1-db-console-changes">DB Console changes</h3>

- Fixing the legend on overload page for `Admission Queueing Delay p99 â€“ Background (Elastic) CPU`. [#128891][#128891]
- The user experience for metrics charges in DB Console now has hover behavior that focuses on individual lines and shows values under the mouse pointer. [#128412][#128412]

<h3 id="v24-2-1-bug-fixes">Bug fixes</h3>

- Fixed a memory leak that could occur when specifying a non-existent virtual cluster name in the connection string. [#128108][#128108]
- Fixed a bug where CREATE INDEX IF NOT EXISTS would not correctly short-circuit if the given index already existed. [#128240][#128240]
- Fixed a bug in overly eagier syntax validation, in which the DESCENDING clause was not allowed for non-terminal columns of an inverted index. Only the last column of an inverted index should be prevented from being DESCENDING, and this is properly checked now. [#128240][#128240]
- Fixed a bug where an index could store a column in the primary index if that column had a mixed-case name. [#128240][#128240]
- Setting or dropping a default value on a computed column is now blocked -- even for null defaults. Previously, setting or dropping a default value on a computed column was a no-op. [#128465][#128465]
- Fixed a bug where a hash sharded constraint could not be created if it referred to columns that had a backslash in the name. [#128522][#128522]
- Fix a bug in which output of `EXPLAIN (OPT, REDACT)` of various CREATE statements was not redacted. This bug has existed since `EXPLAIN (REDACT)` was introduced in v23.1 and affects the following statements: - `EXPLAIN (OPT, REDACT) CREATE TABLE` - `EXPLAIN (OPT, REDACT) CREATE VIEW` - `EXPLAIN (OPT, REDACT) CREATE FUNCTION` [#128490][#128490]
- Declarative and legacy schema changes were incorrectly allowed to be executed concurrently before, which could lead to failing or hung schema change jobs. [#128825][#128825]
- A bug has been fixed that caused errors like "ERROR: column 'crdb_internal_idx_expr' does not exist" when accessing a table with an expression index where the expression evaluates to an ENUM type, e.g., `CREATE INDEX ON t ((col::an_enum))`. [#129094][#129094]

<h3 id="v24-2-1-miscellaneous">Miscellaneous</h3>

<h4 id="v24-2-1-changes-without-release-note-annotation">Changes without release note annotation</h4>

- [#128837][#128837] [806d0058d][806d0058d] release-24.2: backupccl: always close SSTWriter
- [#128622][#128622] [ac8d06a16][ac8d06a16] release-24.2: roachtest: revert workload cpu change for all ycsb variants
- [#128349][#128349] [522da4735][522da4735] 
- [#128349][#128349] [4b7023084][4b7023084] 
- [#128188][#128188] [5780226f8][5780226f8] release-24.2: roachtest: add RequiresDeprecatedWorkload testSpec
- [#128188][#128188] [30ea47da6][30ea47da6] release-24.2: roachtest: add RequiresDeprecatedWorkload testSpec
- [#128202][#128202] [ed9abfd9e][ed9abfd9e] release-24.2: ldr: send frontier updates to heartbeater

<h3 id="v24-2-1-doc-updates">Doc updates</h3>

{% comment %}Docs team: Please add these manually.{% endcomment %}

</div>

[#128098]: https://github.com/cockroachdb/cockroach/pull/128098
[#128108]: https://github.com/cockroachdb/cockroach/pull/128108
[#128178]: https://github.com/cockroachdb/cockroach/pull/128178
[#128188]: https://github.com/cockroachdb/cockroach/pull/128188
[#128202]: https://github.com/cockroachdb/cockroach/pull/128202
[#128240]: https://github.com/cockroachdb/cockroach/pull/128240
[#128332]: https://github.com/cockroachdb/cockroach/pull/128332
[#128349]: https://github.com/cockroachdb/cockroach/pull/128349
[#128412]: https://github.com/cockroachdb/cockroach/pull/128412
[#128465]: https://github.com/cockroachdb/cockroach/pull/128465
[#128490]: https://github.com/cockroachdb/cockroach/pull/128490
[#128522]: https://github.com/cockroachdb/cockroach/pull/128522
[#128622]: https://github.com/cockroachdb/cockroach/pull/128622
[#128700]: https://github.com/cockroachdb/cockroach/pull/128700
[#128712]: https://github.com/cockroachdb/cockroach/pull/128712
[#128825]: https://github.com/cockroachdb/cockroach/pull/128825
[#128837]: https://github.com/cockroachdb/cockroach/pull/128837
[#128891]: https://github.com/cockroachdb/cockroach/pull/128891
[#129094]: https://github.com/cockroachdb/cockroach/pull/129094
[30ea47da6]: https://github.com/cockroachdb/cockroach/commit/30ea47da6
[4b7023084]: https://github.com/cockroachdb/cockroach/commit/4b7023084
[522da4735]: https://github.com/cockroachdb/cockroach/commit/522da4735
[5780226f8]: https://github.com/cockroachdb/cockroach/commit/5780226f8
[806d0058d]: https://github.com/cockroachdb/cockroach/commit/806d0058d
[ac8d06a16]: https://github.com/cockroachdb/cockroach/commit/ac8d06a16
[ed9abfd9e]: https://github.com/cockroachdb/cockroach/commit/ed9abfd9e
