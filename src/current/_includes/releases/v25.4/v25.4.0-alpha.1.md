## v25.4.0-alpha.1

Release Date: September 16, 2025

{% include releases/new-release-downloads-docker-image.md release=include.release %}

<h3 id="v25-4-0-alpha-1-general-changes">General changes</h3>

- Restore jobs now log errors on retry to
  the job messages table. [#149821][#149821]

<h3 id="v25-4-0-alpha-1-sql-language-changes">SQL language changes</h3>

- Implemented the `levenshtein_less_equal(string, string, int)` and `levenshtein_less_equal(string, string, int, int, int, int)` built-in functions, which calculate the Levenshtein distance between two strings. [#104649][#104649]
- The functionality provided by session variable `enforce_home_region_follower_reads_enabled` was deprecated in v24.2.4 and is now removed. (The variable itself remains for backward compatibility but has no effect.) Note that the related session variable `enforce_home_region` is **not** deprecated and still functions normally. [#148314][#148314]
- `LTREE` is now supported with ancestry operators and with the `concat` operator. Specifically, CockroachDB now allows `ltree @> ltree`, `ltree[] @> ltree`, `ltree @> ltree[]`, `ltree <@ ltree`, `ltree[] <@ ltree`, and `ltree <@ ltree[]` binary comparisons, as well as `ltree[] ?@> ltree`, `ltree[] ?<@ ltree`, and `ltree || ltree` binary operations. The `?@>` and `?<@` are new binary operators that return the first ltree (or `NULL`) that is an ancestor or descendant of the right ltree argument in the array. [#150598][#150598]
- All PostgreSQL built-in functions for `LTREE` are now supported: `subltree()`, `subpath()`, `nlevel()`, `index()`, `text2ltree()`, `ltree2text()`, and `lca()`. While the `lca()` function in PostgreSQL specifically limits up to 8 LTREE args, the CockroachDB `lca()` function accepts any variable number of ltree args. [#150647][#150647]
- Improved the optimizer to hoist projections above joins in more cases, which can lead to better query plans. This behavior can be enabled with the new session variable `optimizer_use_improved_hoist_join_project`. [#150887][#150887]
- When `sql_safe_updates` is enabled, the `ALTER TABLE ... LOCALITY` statement will be blocked when trying to convert an existing table to `REGIONAL BY ROW`, unless a region column has been added to the table. This protects against undesired behavior that caused `UPDATE` or `DELETE` statements to fail against the table while the locality change was in progress. [#151423][#151423]
- Added a new session variable, `disable_optimizer_rules`, which allows users to provide a comma-separated list of optimizer rules to disable during query optimization. This allows users to avoid rules that are known to create a suboptimal query plan for specific queries. [#151959][#151959]
- The SQL observability statements `SHOW TRANSACTIONS`, `SHOW QUERIES`, and `SHOW SESSIONS` now include an `isolation_level` column that shows the isolation level of the active transaction, or the session's default isolation level when there is no active transaction. [#152352][#152352]
- The default value of `use_soft_limit_for_distribute_scan` session variable is now `true`. This means that, by default, the soft limit (if available) will be used to determine whether a scan is "large" and, thus, should be distributed. For example, with `estimated row count: 100 - 10,000`, CockroachDB will use `100` as the estimate to compare against the value of `distribute_scan_row_count_threshold`. [#152557][#152557]

<h3 id="v25-4-0-alpha-1-operational-changes">Operational changes</h3>

- `auth.ldap.conn.latency.internal` has been added to denote the internal authentication time for ldap auth method. [#151105][#151105]
- Restricted access to internal tables in the `crdb_internal` schema. Only a predefined allowlist of internal objects is accessible when the session variable `allow_unsafe_internals` is enabled or when the caller is internal. [#151804][#151804]
- In v26.1, changefeed events will be logged to the `CHANGEFEED` logging channel instead of `TELEMETRY`. To test the impact of this change before upgrading, set the cluster setting `log.channel_compatibility_mode.enabled` to `false`. This redirects changefeed logs to the `CHANGEFEED` channel and should be tested only in non-production environments. [#151807][#151807]
- Delegate queries (such as `SHOW DATABASES`) are now excluded from unsafe SQL checks that restrict access to the `system` database and `crdb_internal` schema. This change ensures that these commands continue to function even when access to internal components is otherwise restricted. [#152084][#152084]
- the PCR reader tenant is always destroyed on cutover [#152509][#152509]

<h3 id="v25-4-0-alpha-1-bug-fixes">Bug fixes</h3>

- Fixed a bug that would allow a race condition in foreign key cascades under `READ COMMITTED` and `REPEATABLE READ` isolation levels. [#150291][#150291]
- Fix handling of empty arrays in JSONPath lax mode
  comparisons. Empty arrays now return false for comparisons in lax mode and
  null in strict mode, matching PostgreSQL behavior. [#151226][#151226]
- Added an automatic repair for dangling or invalid entries in the `system.comments` table. [#151737][#151737]
- Fixed a bug where updating column default expressions would incorrectly remove sequence ownerships for the affected column. [#151947][#151947]
- Fixed a bug where executing certain statements with `BETWEEN SYMMETRIC` expressions could panic if used with values of different types, such as `... b'bytes' BETWEEN SYMMETRIC 'a' AND 'c'`. [#151951][#151951]
- Fixed a bug where `SHOW TABLES` would show inaccurate row counts if the most recent statistics collection was partial. [#152033][#152033]
- Fixed a bug that prevented `RESTORE` from working if there were computed columns or `ON UPDATE` expressions that referenced user-defined functions (UDFs). This bug was introduced in v25.3.0. [#152193][#152193]
- Fixed a bug that allowed foreign-key violations to result from some combinations of concurrent `READ COMMITTED` and `SERIALIZABLE` transactions. If both `SERIALIZABLE` and weaker-isolation transactions will concurrently modify rows involved in foreign-key relationships, the `SERIALIZABLE` transactions must have the following session variables set in order to prevent any possible foreign-key violations: 
  - `SET enable_implicit_fk_locking_for_serializable = on;`
  - `SET enable_shared_locking_for_serializable = on;`
  - `SET enable_durable_locking_for_serializable = on;` [#152245][#152245]
- Added the `use_soft_limit_for_distribute_scan` session variable (default: `false`), which controls whether CockroachDB uses the soft row count estimate when deciding whether an execution plan should be distributed. In v25.1, the physical planning heuristics were changed such that large constrained table scans, estimated to scan at least 10,000 rows (controlled via `distribute_scan_row_count_threshold`), would force plan distribution when `distsql=auto`. However, if the scan had a "soft limit" CockroachDB would still use the full estimate (for example, `10,000` in `estimated row count: 100â€“10,000`), sometimes unnecessarily distributing queries and increasing latency. The `use_soft_limit_for_distribute_scan` session variable addresses this by allowing the planner to use the soft limit when deciding whether a scan is "large". [#152300][#152300]
- `pg_class.pg_depend` now contains entries with `deptype='i'` (internal) for identity columns that own sequences. These previously had `deptype='a'` (auto). [#152309][#152309]
- Fixed a bug that caused an error when dropping a column and a `UNIQUE WITHOUT INDEX` constraint that referenced it in the same transaction. [#152447][#152447]
- Fixed a bug where views could not reference the `crdb_region` column from their underlying tables in expressions. [#152670][#152670]

<h3 id="v25-4-0-alpha-1-performance-improvements">Performance improvements</h3>

- LTREE is now index accelerated with the
  `@>` operator. [#152353][#152353]
- `LTREE` is now index-accelerated with the `<@` operator. [#152353][#152353]
- Lookup joins can now be used on tables with virtual columns even if the type of the search argument is not identical to the column type referenced in the virtual column. [#152399][#152399]

<h3 id="v25-4-0-alpha-1-build-changes">Build changes</h3>

- Revert Go version back to 1.23.7.
  Epic: none [#152023][#152023]

<h3 id="v25-4-0-alpha-1-miscellaneous">Miscellaneous</h3>

- Tunes S3 client retry behavior to be more reliable in the
  presence of correlated errors. [#151817][#151817]
- Upgrade to Go 1.23.12 [#152207][#152207]


[#151807]: https://github.com/cockroachdb/cockroach/pull/151807
[#152193]: https://github.com/cockroachdb/cockroach/pull/152193
[#152309]: https://github.com/cockroachdb/cockroach/pull/152309
[#151959]: https://github.com/cockroachdb/cockroach/pull/151959
[#152352]: https://github.com/cockroachdb/cockroach/pull/152352
[#151105]: https://github.com/cockroachdb/cockroach/pull/151105
[#150291]: https://github.com/cockroachdb/cockroach/pull/150291
[#151947]: https://github.com/cockroachdb/cockroach/pull/151947
[#152353]: https://github.com/cockroachdb/cockroach/pull/152353
[#150647]: https://github.com/cockroachdb/cockroach/pull/150647
[#151423]: https://github.com/cockroachdb/cockroach/pull/151423
[#152509]: https://github.com/cockroachdb/cockroach/pull/152509
[#152033]: https://github.com/cockroachdb/cockroach/pull/152033
[#152447]: https://github.com/cockroachdb/cockroach/pull/152447
[#152399]: https://github.com/cockroachdb/cockroach/pull/152399
[#152670]: https://github.com/cockroachdb/cockroach/pull/152670
[#152557]: https://github.com/cockroachdb/cockroach/pull/152557
[#151804]: https://github.com/cockroachdb/cockroach/pull/151804
[#151951]: https://github.com/cockroachdb/cockroach/pull/151951
[#148314]: https://github.com/cockroachdb/cockroach/pull/148314
[#151226]: https://github.com/cockroachdb/cockroach/pull/151226
[#152207]: https://github.com/cockroachdb/cockroach/pull/152207
[#152300]: https://github.com/cockroachdb/cockroach/pull/152300
[#152023]: https://github.com/cockroachdb/cockroach/pull/152023
[#151817]: https://github.com/cockroachdb/cockroach/pull/151817
[#149821]: https://github.com/cockroachdb/cockroach/pull/149821
[#104649]: https://github.com/cockroachdb/cockroach/pull/104649
[#150887]: https://github.com/cockroachdb/cockroach/pull/150887
[#152245]: https://github.com/cockroachdb/cockroach/pull/152245
[#150598]: https://github.com/cockroachdb/cockroach/pull/150598
[#152084]: https://github.com/cockroachdb/cockroach/pull/152084
[#151737]: https://github.com/cockroachdb/cockroach/pull/151737
