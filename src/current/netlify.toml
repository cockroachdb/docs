[build]
  base = "src/current/"
  publish = "_site/"
  command = "./netlify/build.sh"
  edge_functions = "./netlify/edge-functions"
  [build.environment]
    NODE_VERSION = "18.14.0"
    RUBY_VERSION = "3.2.1"
    JEKYLL_REMOTE_INCLUDE_CACHE = "true"
    JEKYLL_REMOTE_INCLUDE_CACHE_TTL = "3600"
    # Enable retry logic for production builds
    MAX_RETRIES = "3"
    BASE_RETRY_DELAY = "30"
    # Testing: Uncomment to simulate network errors and verify retry logic works
    SIMULATE_NETWORK_ERROR = "1"
    SIMULATE_NETWORK_ERROR_ATTEMPTS = "2"
  [build.processing.html]
    pretty_urls = true

# Cache Plugin (keep caching for performance)
[[plugins]]
  package = "netlify-plugin-cache"
  [plugins.inputs]
    paths = [
      ".jekyll-cache",
      ".remote-includes-cache", 
      "node_modules/.cache",
      "_data/cached"
    ]

# Retry functionality implemented in build script for robust production builds

[[edge_functions]]
  path = "/*"
  function = "blockBytedance"