---
title: Search results
summary: Search results for CockroachDB documentation.
toc: false
contribute: false
docs_area: search
---

<style>
  /* Ask AI Button Styling (following Kapa-Algolia integration guide) */
  .ask-ai-container {
    display: flex;
    justify-content: flex-start;
    align-items: center;
    padding: 16px;
    background: linear-gradient(135deg, #f5f3ff 0%, #ffffff 100%);
    border: 1px solid #e0d6ff;
    border-radius: 8px;
    margin-bottom: 24px;
    box-shadow: 0 2px 4px rgba(105, 51, 255, 0.1);
  }
  
  .ask-ai-button {
    background: #6933FF !important;
    border: none !important;
    color: white !important;
    padding: 12px 24px !important;
    font-size: 16px !important;
    font-weight: 500 !important;
    border-radius: 6px !important;
    cursor: pointer;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  
  .ask-ai-button:hover {
    background: #5829CC !important;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(105, 51, 255, 0.3);
  }
  
  .ask-ai-button:active {
    transform: translateY(0);
  }
  
  .ask-ai-button i {
    font-size: 18px;
  }
  
  /* Smooth animation for button appearance */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .ask-ai-container {
    animation: fadeInUp 0.3s ease-out;
  }
</style>

<div id="search-refinements"></div>
<div id="search-stats"></div>
<div id="search-hits"></div>
<div id="search-pages"></div>

<!-- Algolia Search Integration -->
<script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.14.3/dist/algoliasearch-lite.umd.js" integrity="sha256-dyJcbGuYfdzNfifkHxYVd/rzeR6SLLcDFYEidcybldM=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.50.1/dist/instantsearch.production.min.js" integrity="sha256-xtz5Q60cdtw/7BDkzWiTgCXLvwLrUqlKqegFqvNHiNM=" crossorigin="anonymous"></script>
<script>
  const htmlEncode = (text) => {
    let div = document.createElement("div");
    div.appendChild(document.createTextNode(text));
    return div.innerHTML;
  };

  const queryString = (function() {
    const query_string = {};
    const query = window.location.search.substring(1);
    const vars = query.split("&");
    for (var i = 0; i < vars.length; i++) {
      const pair = vars[i].split("=");
      if (typeof query_string[pair[0]] === "undefined") {
        query_string[pair[0]] = decodeURIComponent(pair[1]);
      } else if (typeof query_string[pair[0]] === "string") {
        const arr = [query_string[pair[0]], decodeURIComponent(pair[1])];
        query_string[pair[0]] = arr;
      } else {
        query_string[pair[0]].push(decodeURIComponent(pair[1]));
      }
    }
    return htmlEncode((query_string.query || "").replace(/\+/g, " "));
  })();

  /* =========================================
     ALGOLIA SEARCH IMPLEMENTATION (ACTIVE)
     ========================================= */
  const router = instantsearch.routers.history({
    windowTitle({ category, query }) {
      const queryTitle = query ? `Results for "${query}"` : "Search";
      return queryTitle;
    },

    createURL({ qsModule, routeState, location }) {
      const urlParts = location.href.match(/^(.*?)\/search/);
      const baseUrl = `${urlParts ? urlParts[1] : ""}/`;

      const queryParameters = {};
      const { query = "", page } = qsModule.parse(location.search.slice(1));
      queryParameters.query = query;

      if (page !== 1) {
        queryParameters.page = routeState.page;
      }

      const queryString = qsModule.stringify(queryParameters, {
        addQueryPrefix: true,
        arrayFormat: "repeat"
      });

      return `${baseUrl}search${queryString}`;
    },

    parseURL({ qsModule, location }) {
      const pathnameMatches = location.pathname.match(/search\/(.*?)\/?$/);
      const { query = "", page } = qsModule.parse(location.search.slice(1));

      return {
        query,
        page
      };
    }
  });

  const stateMapping = {
    stateToRoute(uiState) {
      return {
        query: uiState["{{site.algolia.index_name}}"].query,
        page: uiState["{{site.algolia.index_name}}"].page
      };
    },

    routeToState(routeState) {
      return {
        "{{site.algolia.index_name}}": {
          query: routeState.query,
          page: routeState.page
        }
      };
    }
  };

  // ALGOLIA SEARCH CLIENT
  const searchClient = algoliasearch(
    "{{site.algolia.application_id}}",
    "{{site.algolia.search_api_key}}"
  );

  const search = instantsearch({
    indexName: "{{site.algolia.index_name}}",
    routing: {
      router,
      stateMapping
    },
    searchClient
  });

  /* =========================================
     ALGOLIA SEARCH WIDGETS
     ========================================= */
  const addToResultsIfPresent = (match) => {
    if(match && match.matchLevel && match.matchLevel !== 'none' && match.value) {
      return (match.value || '') + '<br>';
    }
    return '';
  }

  const showResult = ({content, tags, title, html}) => {
    if(content && content.value) {
      return content.value
    }
    return addToResultsIfPresent(title) + addToResultsIfPresent(tags);
  }

  // Create the render function with Ask AI button (following Kapa integration guide)
  const renderHits = (renderOptions, isFirstRender) => {
    const { hits, widgetParams } = renderOptions;
    let results = "";
    
    // Add Ask AI button following the Kapa-Algolia integration pattern
    // Only show when there's a query (matching the guide's behavior)
    if (queryString && queryString.trim()) {
      results = `
        <div class="ask-ai-container" style="margin-bottom: 20px;">
          <button 
            type="button" 
            class="ask-ai-button btn btn-primary"
            onclick="handleAskAI()"
            style="background: #6933FF; border-color: #6933FF; padding: 10px 20px; font-size: 16px; border-radius: 6px;"
          >
            <i class="fas fa-robot"></i> Ask AI about "${htmlEncode(queryString)}"
          </button>
        </div>
      `;
    }
    
    if (hits.length) {
      results += hits
        .map(
          hit =>
            `<div class="search-item">
          <div class="search-title">
            <a href="${hit.url}">${hit.title}</a>
          </div>
          <div class="search-snippet">${showResult(hit._highlightResult)}</div>
          <div class="search-link">${hit.doc_type}</div>
        </div>`
        )
        .join("");
    } else if (queryString) {
      results += "<p>No results found. Try clicking the 'Ask AI' button above for assistance.</p>";
    } else {
      results += "<p>Enter a search query to see results.</p>";
    }
    widgetParams.container.innerHTML = results;
  };
  
  // Handle Ask AI button click (following Kapa guide pattern)
  function handleAskAI() {
    if (window.Kapa && window.Kapa.open) {
      // Pass query and submit: true as per the integration guide
      window.Kapa.open({ 
        query: queryString.replace(/&amp;/g, '&').replace(/&#39;/g, "'").replace(/&quot;/g, '"'),
        submit: true  // This auto-submits the query in the widget
      });
    } else {
      console.error('Kapa widget not available');
      alert('AI Assistant is not available at the moment. Please try again later.');
    }
  }

  // Create the custom widget
  const customHits = instantsearch.connectors.connectHits(renderHits);

  search.addWidgets([
    instantsearch.widgets.refinementList({
      container: document.querySelector("#search-refinements"),
      attribute: 'version',
      operator: 'or',
      showMore: true,
      searchable: true,
      searchablePlaceholder: 'Search docs area'
    }),
    customHits({
      container: document.querySelector("#search-hits")
    }),
    instantsearch.widgets.stats({
      container: "#search-stats",
      templates: {
        text(data) {
          let count = "";
          if (data.hasManyResults) {
            count += `${data.nbHits} results`;
          } else if (data.hasOneResult) {
            count += `1 result`;
          } else {
            count += `no result`;
          }
          return `${count} found for '${queryString}'`;
        }
      }
    }),
    instantsearch.widgets.pagination({
      container: "#search-pages",
      padding: 2,
      showFirst: false,
      showLast: false,
      templates: {
        previous: '<span class="fas fa-chevron-left" />',
        next: '<span class="fas fa-chevron-right" />'
      }
    }),
    instantsearch.widgets.configure({
      hitsPerPage: 10,
      query: queryString
    })
  ]);

  // Starting the search
  search.start();
  
  // Make handleAskAI globally available
  window.handleAskAI = handleAskAI;
</script>