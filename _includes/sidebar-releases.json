{% assign today = "today" | date: "%Y-%m-%d" %}
{% assign v_prod = site.data.versions | where_exp: "v_prod", "v_prod.asst_supp_exp_date > today" | where_exp: "v_prod", "v_prod.release_date < today" | sort: "release_date" | reverse | map: "major_version" %}
{% assign v_test = site.data.versions | where_exp: "v_test", "v_test.release_date > today or v_test.release_date == 'N/A'" | sort: "release_date" | last | map: "major_version" %}
{
  "title": "CockroachDB Releases",
  "items": [
    {
<<<<<<< HEAD
      "title": "Production Releases",
      "items": [
        {
          "title": "Latest v21.2",
          "urls": [
            "/releases/v21.2.5.html"
          ]
        },
        {
          "title": "Latest v21.1",
          "urls": [
            "/releases/v21.1.15.html"
          ]
        },
        {
          "title": "Latest v20.2",
          "urls": [
            "/releases/v20.2.19.html"
          ]
        },
        {
          "title": "All Production Releases",
          "urls": [
            "/releases/index.html#production-releases",
            "/releases/v21.2.5.html",
            "/releases/v21.2.4.html",
            "/releases/v21.2.3.html",
            "/releases/v21.2.2.html",
            "/releases/v21.2.1.html",
            "/releases/v21.1.15.html",
            "/releases/v21.1.14.html",
            "/releases/v21.1.13.html",
            "/releases/v21.1.12.html",
            "/releases/v21.1.11.html",
            "/releases/v21.1.10.html",
            "/releases/v21.1.9.html",
            "/releases/v21.1.8.html",
            "/releases/v21.1.7.html",
            "/releases/v21.1.6.html",
            "/releases/v21.1.5.html",
            "/releases/v21.1.4.html",
            "/releases/v21.1.3.html",
            "/releases/v21.1.2.html",
            "/releases/v21.1.1.html",
            "/releases/v21.1.0.html",
            "/releases/v20.2.19.html"
          ]
        }
      ]
    },
    {
      "title": "Testing Releases",
=======
      "title": "All Releases",
>>>>>>> e447b2155 (Improve version handling in the docs)
      "urls": [
        "/releases/index.html"
      ]
    },
    {% for x in v_prod %}
      {% assign r_latest = site.data.releases | where_exp: "r_latest", "r_latest.major_version == x" | where: "withdrawn", "false" | sort: "release_date" | last | map: "version" %}
      {
        "title": "Latest {{ x }}",
        "urls": [
          "/releases/{{ r_latest }}.html"
        ]
      },
    {% endfor %}
    {% if v_test[0] %}
    {
      "title": "Latest Testing Release",
      "urls": [
          {% assign r = site.data.releases | where_exp: "r", "r.major_version == v_test[0]" | where: "withdrawn", "false" | where: "release_type", "Testing" | map: "version" %}
          "/releases/{{ r }}.html"
      ]
    },
    {% endif %}
    {
      "title": "Release Support Policy",
      "urls": [
        "/releases/release-support-policy.html"
      ]
    },
    {
      "title": "Known Limitations",
      "urls": [
        "/${VERSION}/known-limitations.html"
      ]
    },
    {
      "title": "Technical Advisories",
      "urls": [
        "/advisories/index.html",
        "/advisories/a30821.html",
        "/advisories/a42567.html",
        "/advisories/a43870.html",
        "/advisories/a44166.html",
        "/advisories/a44299.html",
        "/advisories/a44348.html",
        "/advisories/a48860.html",
        "/advisories/a50587.html",
        "/advisories/a54418.html",
        "/advisories/a56116.html",
        "/advisories/a58932.html",
        "/advisories/a62842.html",
        "/advisories/a63162.html",
        "/advisories/a64325.html",
        "/advisories/a68005.html",
        "/advisories/a69874.html",
        "/advisories/a71002.html",
        "/advisories/a71655.html",
        "/advisories/a71553.html",
        "/advisories/a72839.html",
        "/advisories/a73024.html",
        "/advisories/a73629.html",
        "/advisories/aCVE-2021-44228.html",
        "/advisories/a74385.html",
        "/advisories/a74736.html",
        "/advisories/a75758.html"
      ]
    }
  ]
}
