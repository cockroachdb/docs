{% assign today = "today" | date: "%Y-%m-%d" %}
{% assign v = site.data.versions | where_exp: "v", "v.asst_supp_exp_date > today" | sort: "release_date" | reverse | map: "major_version" %}
{
  "title": "CockroachDB Releases",
  "items": [
    {
      "title": "Production Releases",
      "items": [
        {% for x in v %}
          {% assign r_latest = site.data.releases | where_exp: "r_latest", "r_latest.major_version == x" | where: "withdrawn", "false" | sort: "release_date" | last | map: "version" %}
          {
            "title": "Latest {{ x }}",
            "urls": [
              "/releases/{{ r_latest }}.html"
            ]
          },
        {% endfor %}
        {
          "title": "All Production Releases",
          "urls": [
            {% for x in v %}
              {% assign r = site.data.releases | where_exp: "r_latest", "r_latest.major_version == x" | where: "withdrawn", "false" | where: "release_type", "Production" | map: "version" %}
              "/releases/{{ r }}.html",
            {% endfor %}
            "/releases/index.html#production-releases"
          ]
        }
      ]
    },
    {
      "title": "Testing Releases",
      "urls": [
        {% for x in v %}
          {% assign r = site.data.releases | where_exp: "r_latest", "r_latest.major_version == x" | where: "withdrawn", "false" | where: "release_type", "Testing" | map: "version" %}
          "/releases/{{ r }}.html",
        {% endfor %}
        "/releases/index.html#testing-releases"
      ]
    },
    {
      "title": "Release Support Policy",
      "urls": [
        "/releases/release-support-policy.html"
      ]
    },
    {
      "title": "Known Limitations",
      "urls": [
        "/${VERSION}/known-limitations.html"
      ]
    },
    {
      "title": "Technical Advisories",
      "urls": [
        "/advisories/index.html",
        "/advisories/a30821.html",
        "/advisories/a42567.html",
        "/advisories/a43870.html",
        "/advisories/a44166.html",
        "/advisories/a44299.html",
        "/advisories/a44348.html",
        "/advisories/a48860.html",
        "/advisories/a50587.html",
        "/advisories/a54418.html",
        "/advisories/a56116.html",
        "/advisories/a58932.html",
        "/advisories/a62842.html",
        "/advisories/a63162.html",
        "/advisories/a64325.html",
        "/advisories/a68005.html",
        "/advisories/a69874.html",
        "/advisories/a71002.html",
        "/advisories/a71655.html",
        "/advisories/a71553.html",
        "/advisories/a72839.html",
        "/advisories/a73024.html",
        "/advisories/a73629.html",
        "/advisories/aCVE-2021-44228.html",
        "/advisories/a74385.html"
      ]
    }
  ]
}
