<h2 id="{{ include.release | slugify }}">{{ include.release }}</h2>

Release Date: {{ include.release_date | date: "%B %-d, %Y" }}

This release includes usability enhancements, PostgreSQL compatibility improvements, and general bug fixes.

{{site.data.alerts.callout_success}}The <a href="../v2.1/export.html"><code>EXPORT CSV</code></a> feature in this release allows you to quickly get data out of CockroachDB and into a format that can be ingested by downstream systems. Unlike the existing ability to export data via a <code>SELECT</code> that outputs to a CSV file, <code>EXPORT</code> uses all nodes in the cluster to parallelize CSV creation for significantly faster processing. Note that this is a prototype feature, so we’d love for you to try it out and create issues if you’d like any enhancements or find any bugs.{{site.data.alerts.end}}

<h3 id="v2-1-0-alpha-20180507-downloads">Downloads</h3>

<div id="os-tabs" class="clearfix os-tabs_button-outline-primary">
    <a href="https://binaries.cockroachdb.com/cockroach-v2.1.0-alpha.20180507.darwin-10.9-amd64.tgz"><button id="mac" data-eventcategory="mac-binary-release-notes">Mac</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v2.1.0-alpha.20180507.linux-amd64.tgz"><button id="linux" data-eventcategory="linux-binary-release-notes">Linux</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-v2.1.0-alpha.20180507.src.tgz"><button id="source" data-eventcategory="source-release-notes">Source</button></a>
</div>

<h3 id="v2-1-0-alpha-20180507-general-changes">General Changes</h3>

- Added a `/_status/diagnostics/{node_id}` debug endpoint, which returns an [anonymized diagnostics report](../v2.1/diagnostics-reporting.html). [#24813][#24813] [#24997][#24997]{% comment %}doc{% endcomment %}
- The header of new log files generated by [`cockroach start`](../v2.1/start-a-node.html) now includes the cluster ID once it has been determined. [#24926][#24926]
- The cluster ID is now reported with tag `[config]` in the first log file, not only when log files are rotated. [#24993][#24993]
- Stopped spamming the server logs with "error closing gzip response writer" messages. [#25106][#25106]
- Enforced stricter validation of [security certificates](../v2.1/create-security-certificates.html). [#24687][#24687]

<h3 id="v2-1-0-alpha-20180507-enterprise-edition-changes">Enterprise Edition Changes</h3>

- Added alpha support for [`EXPORT CSV`](../v2.1/export.html). [#25075][#25075]

<h3 id="v2-1-0-alpha-20180507-sql-language-changes">SQL Language Changes</h3>

- `ROLE` and `STORED` are no longer reserved keywords and can again be used as unrestricted names for databases, tables and columns. [#24629][#24629] [#24554][#24554] {% comment %}doc{% endcomment %}
- The experimental SQL features `SHOW TESTING_RANGES` and `ALTER ... TESTING_RELOCATE` have been renamed `SHOW EXPERIMENTAL_RANGES` and `ALTER ... EXPERIMENTAL_RELOCATE`. [#24696][#24696] {% comment %}doc{% endcomment %}
- The `current_schema()` and `current_schemas()` built-in functions now only consider valid schemas, like PostgreSQL does. [#24718][#24718]
- Clarified the error message produced upon accessing a virtual schema with no database prefix (e.g., when `database` is not set). [#24772][#24772]
- Improved the error message returned on object creation when no current database is set or only invalid schemas are in the `search_path`. [#24770][#24770]
- Added more ways to specify an index name for statements that require one (e.g., [`DROP INDEX`](../v2.1/drop-index.html), [`ALTER INDEX ... RENAME`](../v2.1/rename-index.html), etc.), improving PostgreSQL compatibility. [#24778][#24778] {% comment %}doc{% endcomment %}
- Errors detected by `SHOW SYNTAX` are now tracked internally like other SQL errors. [#24819][#24819]
- Added support for `lpad()` and `rpad()` string functions. [#24891][#24891] {% comment %}doc{% endcomment %}
- [Computed columns](../v2.1/computed-columns.html) can now be added with [`ALTER TABLE ... ADD COLUMN`](../v2.1/add-column.html). [#24464][#24464] {% comment %}doc{% endcomment %}
- Added the `TIMETZ` column type and datum. [#24343][#24343]
- The [`EXPLAIN`](../v2.1/explain.html) output for [`UPDATE`](../v2.1/update.html) statements now also report [`CHECK`](../v2.1/check.html) expressions, for consistency with `INSERT`. [#23373][#23373] {% comment %}doc{% endcomment %}
- Reduced the amount of RAM used when a query performs further computations on the result of a mutation statement (`INSERT`/`DELETE`/`UPSERT`/`UPSERT`) combined with `RETURNING`. [#23373][#23373]
- Added the 'base64' option to the `encode()` and `decode()` built-in functions. [#25002][#25002] {% comment %}doc{% endcomment %}
- [`IMPORT`](../v2.1/import.html) now supports hex-encoded byte literals for [`BYTES`](../v2.1/bytes.html) columns. [#24859][#24859]
- Set Returning Functions (SRF) can now be accessed using `(SRF).x`, where `x` is the name of a column returned from the SRF or a `*`. For example, `SELECT (information_schema._pg_expandarray(ARRAY['c', 'b', 'a'])).x` and `SELECT (information_schema._pg_expandarray(ARRAY['c', 'b', 'a'])).*` are now both valid. Also, the naming of the resulting columns from SRFs now provide more information about the resulting tuple. [#24832][#24832] {% comment %}doc{% endcomment %}
- Removed the `METADATA`, `QUALIFY`, and `EXPRS` options for [`EXPLAIN`](../v2.1/explain.html). [#25101][#25101] {% comment %}doc{% endcomment %}
- CockroachDB now properly reports an error when a query attempts to use `ORDER BY` within a function argument list, which is an unsupported feature. [#25146][#25146]
- `AS OF SYSTEM TIME` queries now accept a negative interval to produce a relative time from the statement's `statement_timestamp()` time. [#24768][#24768]

<h3 id="v2-1-0-alpha-20180507-command-line-changes">Command-Line Changes</h3>

- The `cockroach demo` command now shows the Admin UI URL on startup. [#24738][#24738]
- [`cockroach dump`](../v2.1/sql-dump.html) now supports self and cyclic foreign key references. [#24716][#24716] {% comment %}doc{% endcomment %}

<h3 id="v2-1-0-alpha-20180507-admin-ui-changes">Admin UI Changes</h3>

- Updated the window title for each page to make browser history more useful. [#24634][#24634]
- Changed the label "bytes" to "used capacity" in the **Nodes** table. [#24843][#24843]
- The names of dropped schema objects on `DROP DATABASE ... CASCADE` are now displayed. [#24852][#24852]
- The **Cluster Overview** now adjusts to take the advantage of the size of the screen. [#24849][#24849]
- Fixed a bug where the **Node List** could get cut off. [#24849][#24849]
- Improve responsiveness of the Prometheus metrics endpoint on very overloaded nodes. [#25083][#25083]
- Time series charts now display data points at more consistent timestamps. [#24856][#24856]

<h3 id="v2-1-0-alpha-20180507-bug-fixes">Bug Fixes</h3>

- Converted a panic related to an unsupported type to an error. [#24688][#24688]
- [`ALTER INDEX ... RENAME`](../v2.1/rename-index.html) can now be used on the primary index. [#24776][#24776] {% comment %}doc{% endcomment %}
- Fixed a scenario in which a node could deadlock while starting up. [#24808][#24808]
- It is once again possible to use a simply qualified table name in qualified stars (e.g., `SELECT mydb.kv.* FROM kv`) for compatibility with CockroachDB v1.x. [#24811][#24811] {% comment %}doc{% endcomment %}
- Ranges in [partitioned tables](../v2.1/partitioning.html) now properly split to respect their configured maximum size. [#24896][#24896]
- Fixed a bug where `SELECT * FROM [DELETE FROM ... RETURNING ...] LIMIT 1` or `WITH d AS (DELETE FROM ... RETURNING ...) SELECT * FROM d LIMIT 1` would fail to properly delete some rows. The is fixed for `SELECT * FROM [INSERT ... RETURNING ...] LIMIT 1` or `WITH d AS (INSERT ... RETURNING ...) SELECT * FROM d LIMIT 1` as well. [#23373][#23373]
- Removed a limitation where `UPDATE`, `INSERT`, or `UPSERT` would fail if the number of modified rows was too large. [#23373][#23373] {% comment %}doc{% endcomment %}
- [`UPSERT`](../v2.1/upsert.html) now properly reports the count of modified rows when `RETURNING` is not specified. [#23373][#23373]
- When [adding a column](../v2.1/add-column.html), CockroachDB now verifies that the column is reference by no more than one foreign key. Existing tables with a column that is used by multiple foreign key constraints should be manually changed to have at most one foreign key per column. [#25060][#25060] {% comment %}doc{% endcomment %}
- Corrected the documentation for the `age()` [built-in function](../v2.1/functions-and-operators.html). [#25132][#25132] {% comment %}doc{% endcomment %}
- Fixed a bug cuasing `PREPARE` to hang when run in the same transaction as a `CREATE TABLE` statement. [#23816][#23816]

<h3 id="v2-1-0-alpha-20180507-performance-improvements">Performance Improvements</h3>

- Improved the performance of hash joins. [#24577][#24577]
- Aggregations are now streamed based on the ordering on the `GROUP BY` columns. [#24113][#24113]
- Some `SELECT`s with limits no longer require a second low-level scan, resulting in much faster execution. [#24790][#24790]

<h3 id="v2-1-0-alpha-20180507-build-changes">Build Changes</h3>

- Build metadata, like the commit SHA and build time, is now properly injected into the binary when using Go 1.10 and building from a symlink. [#25008][#25008]

<h3 id="v2-1-0-alpha-20180507-doc-updates">Doc Updates</h3>

- Added a [performance tuning guide](../v2.1/kubernetes-performance.html) for running CockroachDB in Kubernetes. [#2896][#2896]
- Clarified [replication zone levels](../v2.1/configure-replication-zones.html#replication-zone-levels) and added a warning about increasing the default replication factor without increasing the replication factor of system ranges. [#2901][#2901]
- Updated the [`cockroach start`](../v2.1/start-a-node.html) documentation to recommend decimal notation for flags that accept percentages. [#3056][#3056]
- Documented how to use the [`server.shutdown.drain_wait`](../v2.1/operational-faqs.html#how-do-i-prepare-for-planned-node-maintenance) cluster setting to prevent a load balancer from sending client traffic to a node about to be shut down. [#2903][#2903]
- Documented the [`intervalstyle`](../v2.1/set-vars.html) session variable. [#2904][#2904]
- Added documentation on the [`SHOW EXPERIMENTAL_RANGES`](../v2.1/show-experimental-ranges.html) statement. [#2930][#2930]
- Update the [Node Map](../v2.1/enable-node-map.html#location-coordinates-for-reference) documentation to provide location coordinates for AWS, Azure, and Google Cloud. [#2942][#2942]
- Updated the `SPLIT AT` documentation to show how to [split a table with a composite primary key](../v2.1/split-at.html#split-a-table-with-a-composite-primary-key). [#2950][#2950]
- Documented the `--temp-dir` flag for [`cockroach start`](../v2.1/start-a-node.html). [#2955][#2955]
- Expanded the [Production Checklist](../v2.1/recommended-production-settings.html) to recommend a higher replication factor when using local disks rather than a cloud providers' network-attached disks that are often replicated underneath the covers. [#3001][#3001]

<h3 id="v2-1-0-alpha-20180507-contributors">Contributors</h3>

This release includes 224 merged PRs by 37 authors. We would like to thank the following contributors from the CockroachDB community, with special thanks to first-time contributors Bob Potter, Karan Vaidya, dchenk, and phelanm.

- Bob Potter
- Brett Snyder
- Jingguo Yao
- Karan Vaidya
- Vijay Karthik
- dchenk
- phelanm

[#2896]: https://github.com/cockroachdb/docs/pull/2896
[#2901]: https://github.com/cockroachdb/docs/pull/2901
[#2903]: https://github.com/cockroachdb/docs/pull/2903
[#2904]: https://github.com/cockroachdb/docs/pull/2904
[#2930]: https://github.com/cockroachdb/docs/pull/2930
[#2942]: https://github.com/cockroachdb/docs/pull/2942
[#2950]: https://github.com/cockroachdb/docs/pull/2950
[#2955]: https://github.com/cockroachdb/docs/pull/2955
[#3001]: https://github.com/cockroachdb/docs/pull/3001
[#3056]: https://github.com/cockroachdb/docs/pull/3056
[#19693]: https://github.com/cockroachdb/cockroach/pull/19693
[#23373]: https://github.com/cockroachdb/cockroach/pull/23373
[#23816]: https://github.com/cockroachdb/cockroach/pull/23816
[#24113]: https://github.com/cockroachdb/cockroach/pull/24113
[#24343]: https://github.com/cockroachdb/cockroach/pull/24343
[#24464]: https://github.com/cockroachdb/cockroach/pull/24464
[#24554]: https://github.com/cockroachdb/cockroach/pull/24554
[#24577]: https://github.com/cockroachdb/cockroach/pull/24577
[#24629]: https://github.com/cockroachdb/cockroach/pull/24629
[#24634]: https://github.com/cockroachdb/cockroach/pull/24634
[#24687]: https://github.com/cockroachdb/cockroach/pull/24687
[#24688]: https://github.com/cockroachdb/cockroach/pull/24688
[#24696]: https://github.com/cockroachdb/cockroach/pull/24696
[#24716]: https://github.com/cockroachdb/cockroach/pull/24716
[#24718]: https://github.com/cockroachdb/cockroach/pull/24718
[#24738]: https://github.com/cockroachdb/cockroach/pull/24738
[#24768]: https://github.com/cockroachdb/cockroach/pull/24768
[#24770]: https://github.com/cockroachdb/cockroach/pull/24770
[#24772]: https://github.com/cockroachdb/cockroach/pull/24772
[#24776]: https://github.com/cockroachdb/cockroach/pull/24776
[#24778]: https://github.com/cockroachdb/cockroach/pull/24778
[#24790]: https://github.com/cockroachdb/cockroach/pull/24790
[#24799]: https://github.com/cockroachdb/cockroach/pull/24799
[#24808]: https://github.com/cockroachdb/cockroach/pull/24808
[#24811]: https://github.com/cockroachdb/cockroach/pull/24811
[#24813]: https://github.com/cockroachdb/cockroach/pull/24813
[#24819]: https://github.com/cockroachdb/cockroach/pull/24819
[#24832]: https://github.com/cockroachdb/cockroach/pull/24832
[#24843]: https://github.com/cockroachdb/cockroach/pull/24843
[#24849]: https://github.com/cockroachdb/cockroach/pull/24849
[#24852]: https://github.com/cockroachdb/cockroach/pull/24852
[#24856]: https://github.com/cockroachdb/cockroach/pull/24856
[#24859]: https://github.com/cockroachdb/cockroach/pull/24859
[#24891]: https://github.com/cockroachdb/cockroach/pull/24891
[#24896]: https://github.com/cockroachdb/cockroach/pull/24896
[#24926]: https://github.com/cockroachdb/cockroach/pull/24926
[#24993]: https://github.com/cockroachdb/cockroach/pull/24993
[#24997]: https://github.com/cockroachdb/cockroach/pull/24997
[#25002]: https://github.com/cockroachdb/cockroach/pull/25002
[#25008]: https://github.com/cockroachdb/cockroach/pull/25008
[#25057]: https://github.com/cockroachdb/cockroach/pull/25057
[#25060]: https://github.com/cockroachdb/cockroach/pull/25060
[#25075]: https://github.com/cockroachdb/cockroach/pull/25075
[#25082]: https://github.com/cockroachdb/cockroach/pull/25082
[#25083]: https://github.com/cockroachdb/cockroach/pull/25083
[#25101]: https://github.com/cockroachdb/cockroach/pull/25101
[#25106]: https://github.com/cockroachdb/cockroach/pull/25106
[#25132]: https://github.com/cockroachdb/cockroach/pull/25132
[#25146]: https://github.com/cockroachdb/cockroach/pull/25146
