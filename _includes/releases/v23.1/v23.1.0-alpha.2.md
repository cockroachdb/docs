## v23.1.0-alpha.2

Release Date: February 13, 2022

{% include releases/release-downloads-docker-image.md release=include.release %}

<h3 id="v23-1-0-alpha-2-backward-incompatible-changes">Backward-incompatible changes</h3>

- We've stopped supporting/populating the crdb_internal.gossip_network table. It was an internal table with no API guarantees (so perhaps no meriting a release note?). [#89613][#89613]
- CockroachDB now supports sharing storage ranges across multiple indexes/tables. As a result, there is no more guarantee that there is at most one SQL object (e.g. table/index/sequence/materialized view) per storage range.  Therefore, the columns `table_id`, `database_name`, `schema_name`, `table_name` and `index_name` in `crdb_internal.ranges` and `.ranges_no_leases` have become nonsensical: a range cannot be attributed to a single table/index any more.  As a result:  - The aforementioned columns in the `crdb_internal` virtual tables   have been removed. Existing code can use the SHOW RANGES   statement instead, optionally using WITH KEYS to expose   the raw start/end keys.  - `SHOW RANGES FROM DATABASE` continues to report one row per range,   but stops returning the database / schema / table / index name.  - `SHOW RANGES FROM TABLE` continues to report one row per range,   but stops returning the index name.  Suggested replacements:  - Instead of `SELECT range_id FROM crdb_internal.ranges WHERE table_name = 'x'`    Use: `SELECT range_id FROM [SHOW RANGES FROM TABLE x]`  - Instead of `SELECT range_id FROM crdb_internal.ranges WHERE table_name = $1 OR table_id = $2`   (variable / unpredictable table name or ID)    Use: `SELECT range_id FROM [SHOW RANGES FROM CURRENT_CATALOG WITH TABLES] WHERE table_name = $1 OR table_id = $2`  - Instead of `SELECT start_key FROM crdb_internal.ranges WHERE table_name = 'x'`    Use: `SELECT raw_start_key FROM [SHOW RANGES FROM TABLE x WITH KEYS]`  - Instead of `SELECT start_key FROM crdb_internal.ranges WHERE table_name = $1 OR table_id = $2`   (unpredictable / variable table name or ID)    Use: `SELECT raw_start_key FROM [SHOW RANGES FROM CURRENT_CATALOG WITH TABLES, KEYS] WHERE table_name = $1 OR table_id = $2` [#93644][#93644]
- The format of the columns `start_key` and `end_key` for `SHOW RANGES FROM DATABASE` and `SHOW RANGES FROM TABLE` have been extended to include which table/index the key belong to. This is necessary because a range can now contain data from more than one table/index. [#93644][#93644]
- The format of the columns `start_key` and `end_key` for `SHOW RANGE ... FOR ROW` has been changed to stay consistent with the output of `SHOW RANGES FROM INDEX`. [#93644][#93644]
- The output of `SHOW RANGES` does not include `range_size`, `range_size_mb`, `lease_holder` and `lease_holder_localities` any more by default. This ensures that `SHOW RANGES` remains fast in the common case. Use the (NEW) option `WITH DETAILS` to include these columns.  ----  **Other changes.** [#93644][#93644]
- See release note above. Technically this is not a backwards-incompatible change since we're only changing the default value that new clusters are initialized with -- existing clusters will remain unaffected. But it might be worth highlighting this change more prominently to our users for added scrutiny. [#93836][#93836]
- If a SQL database is created with a name that starts with `cluster:...` (e.g. `CREATE DATABASE "cluster:foo"`, clients will no longer be able to connect to it directly via a pre-existing URL connection string. The URL needs to be modified in this case. For example:  Previously: ``` postgres://servername/cluster:foo ```  Now: ``` postgres://servername/cluster:foo&options=-ccluster=system ```  (What this does: it selects the tenant named `system` and then the database named `cluster:foo` inside it. When the `-ccluster:system` option is not specified, `cluster:foo` in the database name position is interpreted as a request to connect to a tenant named `foo`, which likely does not exist.)  Connections to databases whose name does not start with `cluster:` (the most common case) are not affected by this change. [#92580][#92580]
- Changefeeds using "preview" expresssions (released in 22.2.0) and that acess the previous state of the row using old `cdc_prev()` function will no longer work and will need to be recreated with new syntax. [#94429][#94429]
- There was a bug whereby, when `server.identity_map.configuration` was used, CockroachDB did not verify the client-provided username against the target mappings. This bug was fixed; however, **this also means that the client must now provide a valid DB username.** This requirement is compatible with PostgreSQL; it was not previously required by CockroachDB but it is now.  (This note does not apply when identity maps are not in use.) [#94915][#94915]
- The type of the `replicas`, `voting_replicas`,`non_voting_replicas` and `learner_replicas` in `crdb_internal.ranges` were overriden to `INT2VECTOR` causing incompatible indexing between `.ranges` and `.ranges_no_leases`. Now the types of those columns in the two tables are all INT[]. [#96287][#96287]

<h3 id="v23-1-0-alpha-2-security-updates">Security updates</h3>

- Adds option to re-enable "old" cipher suites for use with very old clients.  Fixes: https://github.com/cockroachlabs/support/issues/1989 [#95091][#95091]
- Previously, the ENCRYPTION_PASSPHRASE option passed to RESTORE would appear as 'redacted', and now it appears as '******' which is consistent with SHOW BACKUP and BACKUP.  Epic: None [#95562][#95562]

<h3 id="v23-1-0-alpha-2-general-changes">General changes</h3>

- The GC TTL previously defaulted to 25h. This value was configurable using `ALTER RANGE DEFAULT CONFIGURE ZONE USING gc.ttlseconds = <whatever>`, but also possible to scope to specific schema objects using `ALTER {DATABASE,TABLE,INDEX} CONFIGURE ZONE USING ...`. This value determine how long overwritten values were retained. The `RANGE DEFAULT` value is now lowered to 4h but only for freshly created clusters. When existing clusters upgrade onto this release, we will respect whatever value they were using before the upgrade for all their schema objects. This will be 25h if the GC TTL was never altered, or some specific value if set explicitly. Full cluster backups taken on earlier version clusters, when restored to clusters that started off at v23.1, will use the GC TTL recorded in the backup image.  We've found the 25h value to translate to higher-than-necessary storage costs, especially for workloads where rows are deleted frequently. It can also make for costlier reads with respect to CPU since we currently have to scan over overwritten values to get to the one of interest. Finally, we've also observed cluster instability due to large unsplittable ranges that have accumulated an excessive amount of MVCC garbage. We chose a default of 25h originally to accommodate daily incremental backups with revision history. But with the introduction of scheduled backups introduced in 22.2, we no longer need a large GC TTL. Scheduled backups "chain together" and prevent garbage collection of relevant data to ensure coverage of revision history across backups, decoupling it from whatever value is used for GC TTL. So we no longer need a 25h default, hence this change.  The GC TTL determines how far back AS OF SYSTEM TIME queries can go, which now if going past `now()-4h`, will start failing informatively. To support larger windows for AS OF SYSTEM TIME queries, users are encouraged to pick a more appropriate GC TTL and set it using `ALTER ... CONFIGURE ZONE using gc.ttlseconds = <whatever>`. The earlier considerations around storage use, read costs, and stability still apply. [#93836][#93836]

<h3 id="v23-1-0-alpha-2-{{-site.data.products.enterprise-}}-edition-changes">{{ site.data.products.enterprise }} edition changes</h3>

- The changefeed.active_protected_timestamps.enabled cluster setting has been removed and is always treated as if it was true. [#89975][#89975]
- Improve changefeed expressions code to rely on optimizer to evaluate star expansion. [#93979][#93979]
- Changefeed expressions support system columns. [#93979][#93979]
- Changefeed expressions have access to cdc_prev tuple which contains the prevous state of the row. [#94429][#94429]
- CDC expressions now support non-volatile user defined functions. [#94429][#94429]
- Changefeed transformations (`CREATE CHANGEFEED ... AS SELECT ...`) no longer require `schema_change_policy=stop` option. [#94653][#94653]
- Changefeed transformations introduced in 22.2 release in preview mode are no longer experimental.  This feature can now be considered to be fully production ready. [#94806][#94806]
- CREATE EXTERNAL CONNECTION now supports URIs with the prefixes  azure gs gcpubsub http(s) webhook-https nodelocal s3 kafka  for use by changefeeds.  Release justification: Connects changefeeds to existing externalconn functionality. [#86061][#86061]
- The `CONTROLCHANGEFEED` role option will be deprecated in the future (see https://github.com/cockroachdb/cockroach/issues/94757). With this change, usages of `CONTROLCHANGEFEED` will come with a deprecation warning. Its existing behavior (see rules for creating changefeeds above) remains the same.  The `SELECT` and `CHANGEFEED` privileges will be used for changefeeds henceforth:  The `SELECT` privilege on a set of tables allows a user to run core changefeeds against them.  The `CHANGEFEED` privilege on a set of tables allows a user to run enterprise changefeeds on them, and also manage the underlying changefeed job (ie. view, pause, cancel, and resume the job). Notably, a new cluster setting `changefeed.permissions.enforce_external_connections` is added and set to `false` by default. Enabling this setting restricts users with `CHANGEFEED` on a set of tables to create enterprise changefeeds into external connections only. To use a given external connection, a user typically needs the `USAGE` privilege on it.  Note `ALTER DEFAULT PRIVILEGES` can be used with both both the `CHANGEFEED` and `SELECT` privileges to assign coarse-grained permissions (ie. assign permissions to all tables in a schema rather than manually assign them for each table). [#94796][#94796]
- Changefeeds created/altered with a metrics_label set while server.child_metrics.enabled is false will now provide the user a notice upon creation.  <what was there before: Previously, ...> <why it needed to change: This was inadequate because ...> <what you did about it: To address this, this patch ...> [#94948][#94948]
- Fix a bug in alter changefeed that would panic when altering changefeed to removing a table that has already been dropped. [#95739][#95739]
- Changefeed account for transient memory needed to perform initial scan. Reduce the default size of scan RPC replies to improve cluster stability. [#95798][#95798]
- Changefeed expressions support `changefeed_created_timestamp` function. [#95179][#95179]
- Bump up default `changefeed.memory.per_changefeed_limit` setting to 1/2GiB. This should result in changefeeds being able to produce larger files. [#96340][#96340]
- The confluent_schema_registry URI for avro changefeeds now supports client_cert and client_key params. [#96510][#96510]

<h3 id="v23-1-0-alpha-2-sql-language-changes">SQL language changes</h3>

- Added the pg_get_function_arguments builtin function. This returns the argument list (with defaults) necessary to identify the function with a given OID. [#93675][#93675]
- Add voting_replicas, non_voting_replicas columns to output of SHOW RANGE(S) statements. [#93513][#93513]
- It is now possible to create and alter not visible indexes using the alias INVISIBLE. The alias can be used anywhere NOT VISIBLE is used when creating or altering indexes. NOTE: the INVISIBLE alias is NOT supported for NOT VISIBLE columns. [#93750][#93750]
- System.table_statistics now contains a column called fullStatisticsID to store an id referencing the full table statistic the partial statistic was derived from. [#93751][#93751]
- Ordinal column references (e.g., `SELECT @1, @2 FROM t`) are now deprecated. By default, statements using this syntax will now result in an error. They can be allowed using the session setting `SET allow_ordinal_column_references=true`. Support for ordinal column references is scheduled to be removed in version 23.2. [#93754][#93754]
- The optimizer will now use table statistics that are merged combinations of the newest partial statistic and latest full statistic collection. And, if forecasting is enabled, the merged statistic will be used in the forecast. [#91933][#91933]
- Add column `indexes_usage` and index  `indexes_usage_idx` on value on table `system.statement_statistics`. [#93089][#93089]
- Add the `log_timezone` session variable, which is read only and always UTC. [#94123][#94123]
- Two new virtual tables `crdb_internal.index_spans` and `.table_spans` have been introduced, which list the logical keyspace used by each index/table.  ----  **New features.** [#93644][#93644]
- The following new statements are introduced:  - `SHOW RANGES FROM CURRENT_CATALOG` and `SHOW RANGES` without   parameter: alias for `SHOW RANGES FROM DATABASE` on the session's   current database.  - `SHOW RANGES FROM DATABASE ... WITH TABLES`   Reports at least one row per table. It's possible for the same   range ID to be repeated across multiple rows, when a range spans   multiple tables.  - `SHOW RANGES FROM DATABASE ... WITH INDEXES`   Reports at least one row per index. It's possible for the same   range ID to be repeated across multiple rows, when a range spans   multiple indexes.  - `SHOW RANGES FROM TABLE ... WITH INDEXES`   Reports at least one row per index. It's possible for the same   range ID to be repeated across multiple rows, when a range spans   multiple indexes.  - `SHOW CLUSTER RANGES [ WITH { INDEXES | TABLES } ]` Reports ranges   across the entire cluster, including ranges that don't contain table   data. The behavior of `WITH INDEXES` and `WITH TABLES` is the same   as for `SHOW RANGES FROM DATABASE`.  Additionally, the following new options have been added to the `SHOW RANGES` statement:  - `WITH KEYS`: produce the raw bytes of the start/end key boundaries. - `WITH DETAILS`: produce more details, using computations that   require extra network roundtrips. Makes the operation slower   overall. - `WITH EXPLAIN`: produce the text of the SQL query used to   run the statement. [#93644][#93644]
- Implement the `pg_timezone_names` pg_catalog table, which lists all supported timezones. [#94122][#94122]
- Improve the performance of trigram operations [#93757][#93757]
- Previously, cockroach db would crash if user creates a UDF whose function signature includes a implicit record type (essentially a table) which has a column using a user defined enum type. This root cause was that there was  a hydration deadloop when looking up descriptors during hydration. This PR adds a new flag to avoid hydration in order to avoid the deadloop, users shouldn't feel differentce on using UDFs. [#94106][#94106]
- Error messages for missing users sometimes had different forms. This is now unified as `role/user "user" does not exist`. [#94677][#94677]
- Add cluster settings to control tenant capabilities relying on KV admin functions. [#94314][#94314]
- User-defined functions with subqueries in the body of the function are now supported. [#94962][#94962]
- Previously, setting a table's locality is not allowed if the table contains any hash sharded index. This restriction is now removed. [#94436][#94436]
- Users can now add a super region when creating a database. [#93939][#93939]
- COPY now logs an error during the insert phase on the SQL_EXEC logging channel.  Informs: https://github.com/cockroachdb/cockroach/issues/90656 [#95038][#95038]
- Add a new `REDACT` flag to `EXPLAIN` which causes constants, literal values, parameter values, and any other user data to be redacted in explain output. Redacted statement diagnostics bundles can now be collected with `EXPLAIN ANALYZE (DEBUG, REDACT)`. [#94950][#94950]
- 2 new virtual tables displaying execution insights for transaction: - crdb_internal.cluster_txn_execution_insights - crdb_internal.node_txn_execution_insights [#94720][#94720]
- Some queries which previously resulted in the error "could not decorrelate subquery" now succeed. [#95234][#95234]
- If `copy_from_retries_enabled` is set, COPY is now able to retry certain safe circumstances - namely when `copy_from_atomic_enabled` is false, there is no transaction running COPY and the error returned is retriable. This prevents users who keep running into `TransactionProtoWithRefreshError` from having issues. [#95275][#95275]
- Fixes databases list api when database name has special characters. [#95209][#95209]
- The pgwire protocol implementation can now accept arguments of the JSON[] type (oid=199). Previously, it could only accept JSONB[] (oid=3804). Internally, JSON[] and JSONB[] values are still identical, so this change only affects how the values are received over the wire protocol. [#94705][#94705]
- CPU time spent during SQL execution is now visible in the output of queries run with `EXPLAIN ANALYZE`. This measure does not include CPU time spent while serving KV requests, and CPU time is not shown for queries that perform mutations or for plans that aren't vectorized. This can be useful for diagnosing performance issues and optimizing SQL queries. [#93952][#93952]
- The SHOW GRANTS ON EXTERNAL CONNECTION and SHOW SYSTEM GRANTS commands now use a column name of `privilege_type` rather than `privilege`. For external connections, the `name` column was changed to `connection_name`. This makes the commands consistent with other SHOW GRANTS commands. [#95532][#95532]
- SHOW INDEXES will now show the expression used to define an index, if one was used. [#95413][#95413]
- It's now possible to run efficient tsvector @@ tsquery searches when there is an inverted index on the tsvector column being searched. [#93769][#93769]
- Added a `cpuNanos` field to the statistics column of the `crdb_internal.statement_statistics` and `system.statement_statistics` tables that reports the amount of CPU time in nanoseconds during SQL execution for queries that track CPU time. [#95639][#95639]
- Previously, SHOW BACKUP options would get parsed as `kv_options`, which meant that a user could not pass multiple values to a show backup option, causing feature gaps in SHOW BACKUP relative to BACKUP and RESTORE. This patch rewrites the show backup option parser, closing the following feature gaps: 1. A user can now pass and check multiple KMS URIs in SHOW BACKUP 2. A user can pass locality aware incremental_locations, allowing a user to also pass the check_files parameter to a locality aware backup chain that also specifies the backup incremental location.  Note that while this patch introduces a couple new words to the CRDB SQL syntax, the same SHOW BACKUP options should remain documented, specifically: - [public option] -> value - AS_JSON -> N/A - CHECK_FILES -> N/A - INCREMENTAL_LOCATION -> string, with potentially multiple uris - DEBUG_IDS -> N/A - KMS -> string, with potentially multiple uris - PRIVILEGES -> N/A - ENCRYPTION_PASSPHRASE -> string [#95562][#95562]
- Update `cpuNanos` name to `cpuSQLNanos` on `crdb_internal.statement_statistics` and `system.statement_statistics` [#96278][#96278]
- Some queries with `EXISTS` subqueries which previously resulted in the error "could not decorrelate subquery" now succeed. [#95883][#95883]
- Users can query crdb_internal.kv_dropped_relation to see which tables, materialized views and sequences are currently already dropped but have not yet been garbage collected, along with the garbage collection TTL setting that's currently in force. This setting originates from the table's own zone configuration, or from its parent database which it inherits, or in turn from the default zone configuration. These settings are typically set using ALTER TABLE ... CONFIGURE ZONE USING gc.ttlseconds = ...; [#96217][#96217]
- Administrators may now call a new builtin function crdb_internal.upsert_dropped_relation_gc_ttl to retroactively set the garbage collection TTL on a table, materialized view or sequence which has already been dropped. Effectively, this retroactively performs ALTER TABLE ... CONFIGURE ZONE USING gc.ttlseconds = ... Note that this statement is prevented from being executed on dropped tables because they can no longer be referenced by name at that point. Usage of this builtin is typically in conjunction with the recently added crdb_internal.kv_dropped_relations virtual table. For example, garbage collection can be triggered ASAP for all dropped relations by querying:   SELECT crdb_internal.upsert_dropped_relation_gc_ttl(id, '1 second')     FROM crdb_internal.kv_dropped_relations; Doing so for all tables in a dropped database requires filtering on the parent_id column, the database name being lost at that point. [#96217][#96217]
- Allow `*` expressions in UDFs. [#95710][#95710]
- Previously, UDFs can be created with any volatility no matter if the function body statements contain any expression which would violate the target volatility. For example, an immutable function might use `random()` in it. This change added validations to guarantee that all statements in the function body should be as strict as the expected UDF volatility. [#96476][#96476]

<h3 id="v23-1-0-alpha-2-operational-changes">Operational changes</h3>

- Metrics queue.gc.info.clearrangesuccess queue.gc.info.clearrangefailed updated to include statistics about GC operations that perform ClearRange on parts of range keyspace. Previously those metrics only included requests to remove range data completely when performing a schema change. [#90830][#90830]
- The load-based splitter has been redesigned to be more consistent with CPU-based rebalancing rather than QPS-based rebalancing to improve range splits. This redesign is disabled by default currently. [#93838][#93838]
- The crdb_v2 log format will now always contain a tenant ID in the logging tags for each log entry. This is to distinguish log entries between tenants when logs for multiple tenants are being written. These tenant ID tags will always come first in the list of logging tags, with a tag key of `T`.  For example, for the system tenant (tenant ID = 1), a log entry would look like: ``` I060102 15:04:05.654321 11 util/log/format_crdb_v2_test.go:123 ⋮ [T1,noval,s‹1›]   I'm the system tenant ```  For a secondary tenant, where tenant ID = 2, a log entry would look like: ``` I060102 15:04:05.654321 11 util/log/format_crdb_v2_test.go:123 ⋮ [T2,noval,s‹1›]   I’m an app tenant ``` [#94432][#94432]
- The cluster setting storage.value_blocks.enabled, when set to true, writes the values of older versions of the same key to separate value blocks in the same sstable. For workloads that create many versions, this can improve the performance of reads by increasing locality. It can also help scan performance with single versions due to an optimization that avoids a key comparison (useful if the key are not very short). The default value of this setting is currently false. [#94634][#94634]
- The bytes read from SQL clients prior to authentication are now reported via the metric `sql.pre_serve.bytesin` (instead of `sql.bytesin` previously). [#92580][#92580]
- Crdb_v1 formatted logs will now always contain a tag containing the tenant ID that the log entry pertains to. For example, for tenant ID 2, we include the tag `T2`: ``` W000101 00:00:12.300000 456 somefile.go:136  [T2,nsql?,othertag=somevalue] 2 this is a log message ``` If decoding an older crdb_v1 log message that does not contain a tenant ID tag, then we default to the primary system tenant. [#94777][#94777]
- Transaction errors will contain more detailed information in redacted logs. [#93760][#93760]
- Added COCKROACH_RAFT_MAX_INFLIGHT_BYTES env variable which helps strictly limiting inflight traffic from a Raft leader to followers, particularly in situations when many large messages are sent and significantly exceed COCKROACH_RAFT_MAX_SIZE_PER_MSG * COCKROACH_RAFT_MAX_INFLIGHT_MSGS which is a softer limit. [#94692][#94692]
- Metrics output via `_status/vars` now contain `tenant` labels allowing the user to distinguish between metrics emitted by the system tenant vs other app tenants identified by their IDs. [#94670][#94670]
- CRDB log message in case of write stall has been adjusted slightly. [#95436][#95436]
- Histogram metrics can now optionally use the legacy HdrHistogram model by setting the environment var `COCKROACH_ENABLE_HDR_HISTOGRAMS=true` on CockroachDB nodes. **Note that this is not recommended** unless users are having difficulties with the newer Prometheus-backed histogram model. Enabling can cause performance issues with timeseries databases like Prometheus, as processing and storing the increased number of buckets is taxing on both CPU and storage. Note that the HdrHistogram model is slated for full deprecation in upcoming releases. [#96029][#96029]
- Prometheus histograms will now export more buckets across the board to improve precision & fidelity of information reported by histogram metrics, such as quantiles. This will lead to an increase in storage requirements to process these histogram metrics in downstream systems like Prometheus, but should still be a marked improvement when compared to the legacy HdrHistogram model. If users have issues with the precision of these bucket boundaries, they can set the environment variable `COCKROACH_ENABLE_HDR_HISTOGRAMS=true` to revert to using the legacy HdrHistogram model instead, although this is not recommended otherwise as the HdrHistogram strains systems like Prometheus with excessive numbers of histogram buckets. Note that HdrHistograms are slated for full deprecation in upcoming releases. [#96029][#96029]
- In the rare event of Range inconsistency, the consistency checker saves a storage checkpoint on each storage the Range belongs to. Previously, this was a full checkpoint, so its cost could quickly escalate on the nodes that went on running. This change makes the checkpoints partial, i.e. they now only contain the relevant range and its neighbours. This eliminates the time pressure on the cluster operator to remove the checkpoints.  Epic: none [#95963][#95963]

<h3 id="v23-1-0-alpha-2-command-line-changes">Command-line changes</h3>

- The TLS parameters to connect to a `cockroach demo` cluster from SQL clients has been simplified. [#94421][#94421]
- The password assigned to the `demo` user in `cockroach demo` can now be overridden by the env var `COCKROACH_DEMO_PASSWORD`. This is meant for use in automated tests, when tests cannot be configured to use TLS client cert authentication using the client certs in `$HOME/.cockroach-demo`. [#94421][#94421]
- `cockroach sql` and `cockroach demo` now support an `\info` client-side command to print the server details again. [#94421][#94421]
- `cockroach demo` is now able to preserve open web sessions across restarts of the `cockroach demo` command. The sessions are saved in the directory `~/.cockroach-demo` alongside the TLS certificates and keys. [#94455][#94455]
- The `debug merge-logs` CLI command is now equipped with a `--tenant-ids` flag, which can be used to provide the command with a list of tenant IDs to filter logs on. For example, to only include logs for secondary tenants 2 and 3:  ``` cockroach debug merge-logs ... --tenant-ids=2,3 ```  Note that when processing logs from older cluster versions, where a tenant ID tag may not be present on the log entry, the command will interpret any log without a tenant ID as belonging to the system tenant (tenant ID = 1). [#95016][#95016]
- File format used for transient loss of quorum recovery files has changed. It is not possible to use replica info files generated by earlier versions to be used with current and future versions. [#93157][#93157]
- Workloads that take a `--seed` argument used to default to `1`. Now, they use a randomly generated seed in each run. Users can still pass a custom seed with the `--seed` flag. [#95326][#95326]
- Add `cpu_time_per_second` to the `hot-ranges.sh` and `hot-ranges-tenant.sh` utility debug zip scripts. [#96213][#96213]

<h3 id="v23-1-0-alpha-2-db-console-changes">DB Console changes</h3>

- Secure clusters now show correct login information in the top right corner. Docs links correctly reference the current cluster version when necessary. [#94021][#94021]
- The databases filter dropdown in the stmts page now uses the `getDatabasesList()` API call, resulting in all cluster databases showing up. [#93657][#93657]
- Adds information about the selected plan to the Explain Plan tab under Statement Details. [#94719][#94719]
- The databases page and the databases details pages each now contain search and filter components, allowing the ability to search and filter through databases and their tables. [#92589][#92589]
- Graphs can be clicked on to toggle legend "stickiness" and make the points stop following the mouse. This makes it easier to read dense graphs with many series plotted together. [#92949][#92949]
- The statement fingerprint details page in the Console no longer infinitely loads after 5 minutes. [#92596][#92596]
- Added a time picker to the Workload Insights Overview pages in the DB Console. [#92285][#92285]
- Added all three session status options (Active, Closed, Idle) and an empty results placeholder. [#95005][#95005]
- Adds on the Index Details page a list of all statement fingerprints that used that index. [#94863][#94863]
- Clear tenant cookie on an api returning 401 error in order to allow for multitenant login again. [#95020][#95020]
- Remove `reset sql stats` and `reset index stats` from the Console when the user is a non-admin. [#95303][#95303]
- Remove `reset sql stats` from Transactions page for non-admins. [#95461][#95461]
- Added an insights type filter for the workload insights page, added a execution status filter for the active execution pages. [#94002][#94002]
- Hide apply option for index recommendation when user is not admin. [#95516][#95516]
- Database list filter now shows all databases in the cluster on CC console. [#95450][#95450]
- Hide filter for databases and database details page if both node and regions dropdowns and also hidden. [#95376][#95376]
- The introduction of the Key Visualizer makes it easy to identify historical hotspots. Three new cluster settings are introduced: keyvisualizer.enabled keyvisualizer.sample_interval keyvisualizer.max_buckets  keyvisualizer.enabled enables the key visualizer. keyvisualizer.sample_interval controls the frequency at which the key visualizer collects samples. keyvisualizer.max_buckets controls the maximum number of buckets in a sample.  passing jobs and backupccl tests  lint fixes  fix tests  test fixes  fix tests  fix tests and lints  fix tests  add key visualizer to advanced debug  tests and generated files  fix tests [#88353][#88353]
- Add CPU Time chart to Statement Details page. [#95796][#95796]
- Add CPU time as a column on Statement and Transaction tables. [#95795][#95795]
- Hide list of used fingerprint per index on Index Details page, for non-admin users. [#95997][#95997]
- Add write bytes, write keys, read bytes, read keys and cpu statistics to the `/hotranges` db-console page. These statistics are the rated average over the last 30 minutes. [#95190][#95190]
- Loading spinner on insights overview only shows when request is pending and either the data is nullish or invalid (new time range selected). [#93219][#93219]
- Previously, txn start time for txn insights was only available for txn insights with high contention as the issue. This information is now available for all txn insights: - start time - end time - time elapsed [#93219][#93219]
- Add search, filter and time picker for the list of most used statement fingerprints on the Index Details page. [#96112][#96112]
- Add CPU Time to Statement and Transaction Insights. [#96279][#96279]
- Currently, the stale node metrics displayed to a user in the Cluster Overview Nodes Table may mislead users in to thinking that they are current values when in fact they are stale. This change rectifies that and adds a stale tag to metrics displayed to the user. This allows for users to be informed about the staleness of the data displayed to them regarding dead nodes. [#95868][#95868]

<h3 id="v23-1-0-alpha-2-bug-fixes">Bug fixes</h3>

- Fixed a bug where the session_id session variable would not be properly set if used from a subquery, [#93748][#93748]
- CockroachDB could previously, in rare cases, encounter an internal error when evaluating `crdb_internal.range_stats` builtin (which powers `SHOW RANGES` command among other things). The bug was introduced in 22.2.0 and is now fixed. [#93868][#93868]
- Fixed a bug that could prevent CASE expressions that used placeholder return values from type-checking correctly. [#93855][#93855]
- Updated the volatility of the hmac, digest, and crypt builtins to be immutable. [#93628][#93628]
- Server logs are now correctly fsynced at every syncInterval [#93956][#93956]
- The `stxnamespace`, `stxkind` and `stxstattarget` columns are now defined in `pg_statistics_ext`. [#93274][#93274]
- When experimental MVCC range tombstones are enabled (they're disabled by default), a bulk ingestion (e.g. an import) could fail to take a committed-but-unresolved write intent into account during conflict checks when written above an MVCC range tombstone. It was therefore possible in very rare circumstances for the ingestion to write a value below the timestamp of the committed intent, causing the ingested value to disappear. [#93938][#93938]
- This patch fixes join queries involving tables with unique constraints using LIMIT, GROUP BY and ORDER BY clauses to ensure the optimizer considers streaming group-by with no TopK operation, when possible. This is often the most efficient query plan. [#93858][#93858]
- Secure clusters now show correct login information in the top right corner. Docs links correctly reference the current cluster version when necessary. [#94021][#94021]
- CockroachDB could previously crash in rare circumstances when evaluating lookup and index joins. The bug is present since 22.2.0 release. Temporary workaround without upgrading to the release with this fix is changing the value of undocumented cluster setting `sql.distsql.use_streamer.enabled` to `false`. [#94031][#94031]
- CREATE ROLE, DELETE ROLE, GRANT, and REVOKE statements no longer work when the transaction is in read-only mode. [#93991][#93991]
- When experimental MVCC range tombstones are enabled (they're disabled by default), a bulk ingestion (e.g. an import) could in some situations fail to properly check for conflicts with existing MVCC range tombstones. This could cause the ingestion to write below a recently written MVCC range tombstone, in turn losing the ingested data. This could only happen in rare circumstances where a bulk ingestion was applied concurrently with an import cancellation. [#94045][#94045]
- In some cases the start/end key columns of the output of `SHOW RANGES` was missing. This was corrected. [#93644][#93644]
- Previously, trigrams ignored unicode (multi-byte) characters from input strings. This is now corrected. [#93757][#93757]
- Fixed a bug that could happen when type-checking an array expression that only contains NULLs and placeholder values. The bug was only present in v22.2.1. [#94207][#94207]
- A bug was introduced in 22.1 such that tables which receive writes concurrent with portions of an ALTER TABLE ... SET LOCALITY REGIONAL BY ROW may fail with an error: `duplicate key value violates unique constraint "new_primary_key"`. This bug has been fixed. [#94151][#94151]
- Previously, CockroachDB could encounter an internal error when evaluating window functions with RANGE window frame mode with OFFSET PRECEDING or OFFSET FOLLOWING boundary when ORDER BY clause has NULLS LAST option. This will now result in a regular error since the feature is marked as unsupported. [#94342][#94342]
- Previously, CockroachDB could delay the release of the locks acquired when evaluating SELECT FOR UPDATE statements in some cases. This delay (up to 5s) could then block the future readers. The bug was introduced in 22.2.0, and the temporary workaround without upgrading to a release with this fix is to set undocumented cluster setting `sql.distsql.use_streamer.enabled` to `false`. [#94399][#94399]
- Record types can now be encoding with the binary encoding of the Postgres wire protocol. Previously, trying to use this encoding, could case a panic in the database. [#94405][#94405]
- Fixed a panic that could be caused when using a SQL cursor to access tables in the crdb_internal schema. [#94425][#94425]
- Fixed a bug in which RESTORE SYSTEM USERS would fail to restore role options. [#94134][#94134]
- Fix a crash that occurs on the gateway node when collecting a statement diagnostics bundle (e.g. `EXPLAIN ANALYZE (DEBUG)`) on a statement that fails with certain errors. This crash has existed in various forms since the introduction of statement bundles in v20.1.0. [#94440][#94440]
- This patch fixes recursive CTE expressions which cause internal errors when explicit CASTs of initial expressions to output types are missing. [#94581][#94581]
- Previously, certain GRANT or REVOKE commands on a user which does not exist would error with the correct PG code. This is now fixed. [#94677][#94677]
- The pg_proc and pg_type virtual oid indexes no longer incorrectly show cross-db objects. This is unlikely to affect real-world use cases. [#94339][#94339]
- It is now possible to run `cockroach version` and `cockroach start` (and possibly other sub-commands) when the user running the command does not have permission to access the current working directory. [#94894][#94894]
- It is now possible to use a directory whose name is `"disabled"` via `--external-io-dir`. To actually disable external I/O, use `--external-io-dir=""`. [#94985][#94985]
- This patch fixes an internal error occurring in CASE expressions when a column present in a THEN or ELSE expression is of an inequivalent type compared to that of a constant this column is compared to in an equality predicate, e.g.,   `(CASE WHEN false THEN int_col ELSE 1 END) IN (int_col) AND int_col=3/2` [#94791][#94791]
- The pronamespace column of the pg_proc table now correctly reports the crdb_internal schema for built-in functions that have the "crdb_internal" prefix. [#95029][#95029]
- In the SQL shell (`cockroach sql` / `cockroach demo`), when using `\c`/`\connect` to connect to a different server, CockroachDB would previously report an error if the new server had a different cluster ID. This has been fixed: this situation is merely a warning. [#95219][#95219]
- When using identity maps (via `server.identity_map.configuration`), authentication now correctly verifies that the client-provided username matches at least one of the mappings for the system identity. Previously, the client-provided username was incorrectly ignored and authentication could fail if the first candidate mapping did not result in a valid DB username. [#94915][#94915]
- The `prokind` column of `pg_catalog.pg_proc` is now populated properly. [#95289][#95289]
- `pg_catalog.pg_description` and `pg_catalog.obj_description()` are now able to retrieve the descriptive help for built-in functions. [#95294][#95294]
- Fixed a crash that could happen when formatting a tuple with an unknown type. [#95009][#95009]
- Fixed a bug where a DNS lookup was performed during gossip remote forwarding while holding the gossip mutex. This could cause processing stalls if the DNS server was slow to respond. [#95426][#95426]
- Fixed a bug where CLOSE ALL would not respect the "ALL" flag and would instead attempt to close a cursor with no name. [#95414][#95414]
- Since 22.2, default expressions can have a type which differs from the type of the column so long as the expression's type can be cast in an assignment context. Unfortunately, this code had a bug when adding new columns. The code in the backfill logic was not sophisticated enough to know to add the cast; when such a default expression was added to a new column it would result in a panic during the backfill. This bug has now been fixed. [#95398][#95398]
- DB Console features that check for the VIEWACTIVITYREDACTED privilege now also account for global privileges. [#95258][#95258]
- Support receiving regXXX type values in binary extended protocol [#94355][#94355]
- Operations like BACKUP can now reuse a previously created AWS KMS client if the client was created with the same parameters. This addresses the NoCredentialProviders errors on EC2 with for backups with long incremental chains. [#95026][#95026]
- EXPLAIN (DDL) COMMENT ON is now possible. [#95467][#95467]
- Fixes a bug where a database restore would not grant `CREATE` and `USAGE` on the public schema to the public role  Fixes: #95456 [#95466][#95466]
- Fixed the formatting of JSON values inside of a SQL array so they don't have improper quoting. [#94705][#94705]
- A bug has been fixed that could cause expressions with side-effects (e.g., volatile expressions or data-modifying statements like `INSERT`s) in `NOT MATERIALIZED` CTEs to be executed more than once. This bug was present since `NOT MATERIALIZED` was first supported in version 20.2.0. Our CTE docs should be updated with the following changes:   1. Under "Data-modifying statements", we should mention that they are      guaranteed to be executed exactly once, even if the      `NOT MATERIALIZED` is specified.   2. In the description of `MATERIALIZED` / `NOT MATERIALIZED`, we      should mention: `MATERIALIZED` forces the CTE to be materialized so      that it is only executed once, and `NOT MATERIALIZED` is a hint to      the optimizer to inline the CTE as long as it doesn't affect other      objects in the database, even if it is used in the query multiple      times.  [^1]: https://www.postgresql.org/docs/current/queries-with.html#QUERIES-WITH-MODIFYING [^2]: https://github.com/postgres/postgres/blob/15eb1228800a35042ef318f941173aa8b89002d1/src/backend/optimizer/plan/subselect.c#L921-L951 [#95454][#95454]
- The pg_get_indexdef was fixed so that it shows the expression used to define an expression-based index. In addition, the function was previously including columns stored by the index, which was incorrect and has now been fixed. [#95413][#95413]
- Reduce register session, deregister session, and session cancel query contention. [#95553][#95553]
- A bug has been fixed that could cause arguments of a `COALESCE` to be evaluated when previous arguments always evaluated to non-NULL values. This bug could cause query errors to originate from arguments of a `COALESCE` that should have never been evaluated. [#95599][#95599]
- This patch fixes the array_to_string built-in function so that nested arrays are traversed without printing 'ARRAY' at each nesting level. [#95802][#95802]
- Fix a bug where COPYing into a column with collated strings would result in an error similar to `internal error: unknown type collatedstring`. [#95894][#95894]
- The content of `column_default` in `information_schema.columns` no longer have type annotations. [#94153][#94153]
- A long-standing bug has been fixed that caused incorrect parsing of double-quoted identifiers separated by one or more newlines. [#96019][#96019]
- This patch fixes rare internal errors in LATERAL queries with redundant function calls. [#96048][#96048]
- This patch fixes an internal error which may occur in the SHOW RANGE FROM TABLE statement when the FOR ROW clause specifies a BYTE literal and the corresponding column data type is BIT. [#96002][#96002]
- This patch fixes internal errors which may occur on some AS OF SYSTEM TIME expressions. [#96113][#96113]
- Fix a bug where a node with a disk stall would continue to accept new connections and preserve existing connections until the disk stall abated. [#96371][#96371]
- Fixes a bug where a restore flow could hang indefinitely in the face of a context cancellation, manifesting as a stuck restore job. [#96302][#96302]
- The global NOSQLLOGIN privilege had a bug that made CockroachDB ignore it entirely, so it had no effect. This is now fixed. The bug was introduced in v22.2.0-alpha.1. The NOSQLLOGIN role option is unaffected by this bug. [#96466][#96466]
- The compatibility scalar functions in `information_schema` are now listed in the proper namespace in `pg_catalog.pg_proc`. [#96562][#96562]

<h3 id="v23-1-0-alpha-2-performance-improvements">Performance improvements</h3>

- The optimizer can now avoid planning a sort in more cases with joins that perform lookups into an index with one or more columns sorted in descending order. This can significantly decrease the number of rows that have to be scanned in order to satisfy a `LIMIT` clause. [#93673][#93673]
- Significantly reduced CPU usage of the underlying gossip network in large clusters. [#89613][#89613]
- Refactored the query logic when fetching database index recommendations for the DatabaseDetails API endpoint, greatly reducing the query time and cost, particularly for large schemas. [#93937][#93937]
- Improve performance of crdb_internal.default_privileges population. [#94247][#94247]
- Some types of user-defined functions are now inlined in query plans as relation expressions, which speeds up their evaluation. UDFs must be non-volatile and have a single statement in the function body to be inlined. [#92955][#92955]
- Improve the performance of pg_{function,table,type}_is_visible [#94339][#94339]
- Long chains of incremental backups and restore of such chains will now allocate less memory during the unmarshaling of metadata [#93997][#93997]
- The RPC compression encoding was extended with a length prefixing format, allowing more efficient decompression on receivers.  Epic: None [#93871][#93871]
- When planning lookup joins with a LIMIT clause from a REGIONAL BY ROW input table, the optimizer will now explore a locality-optimized-search plan of two lookup joins to possibly avoid high latency of reading rows in a remote region. [#93377][#93377]
- Improve the performance of SHOW FUNCTIONS [#94771][#94771]
- Several pg compatibility builtins have improved performance [#94771][#94771]
- In some cases, when planning an inverted zigzag join, the optimizer can now detect whether it is necessary to re-apply the filter after the zigzag join. If it's not necessary, the optimizer can produce a more efficient plan. [#95638][#95638]
- Fixed a bug which could lead to very slow drop when tables or views have a very large number of columns >1000. [#95850][#95850]
- In 22.2, we introduced support for `DISCARD TEMP` and made `DISCARD ALL` actually discard temp tables. This implementation ran expensive logic to discover temp schemas rather than consulting in-memory data structures. As a result, `DISCARD ALL`, which is issued regularly by connection pools, became an expensive operation when it should be cheap. This problem is now resolved. [#95876][#95876]
- In 22.2, logic was added to make `SET SESSION AUTHORIZATION DEFAULT` not a no-op. This implementation used more general code for setting the role for a session which made sure that the role exists. The check for whether a role exists is currently uncached. We don't need to check if the role we already are exists. This improves the performance of `DISCARD ALL` in addition to `SET SESSION AUTHORIZATION DEFAULT`. [#95876][#95876]
- The optimizer now plans inverted index scans for queries that filter by JSON fetch value operators (->) with integer indices, e.g, json_col->0 = '{"b": "c"}'. [#95848][#95848]
- The optimizer now plans inverted index scans for queries that filter by JSON fetch value operators (->) with integer indices alongside the "contains" or the "contained by" operators, e.g, json_col->0 @> '{"b": "c"}' or json_col->0 <@ '{"b": "c"}' [#96202][#96202]
- Adds delegated snapshots which can reduce WAN traffic for snapshot movement. If there is another replica for this range with a closer locality than the delegate, the leaseholder will attempt to have that delegate send the snapshot. This is particularly useful in the case of a decommission of a node where most snapshots are transferred to another replica in the same locality. [#83991][#83991]
- The Raft proposal pipeline has been optimized to reduce interference between Raft proposals. This improves average and tail write latency at high concurrency. [#94165][#94165]

<h3 id="v23-1-0-alpha-2-build-changes">Build changes</h3>

- The native binary for Cypress is now only downloaded and installed when UI end- to-end tests are run, instead of eagerly downloading it on all platforms at build-time. This restores the ability for non-{Windows, Darwin, Linux} platforms like FreeBSD and illumos to build CRDB without modifications, which broke in the initial 22.2 release. [#93800][#93800]
- Required NPM dependencies are now fetched from a Google Cloud Storage bucket managed by Cockroach Labs instead of from a git submodule committed in-tree. [#94152][#94152]

<h3 id="v23-1-0-alpha-2-miscellaneous">Miscellaneous</h3>

<h4 id="v23-1-0-alpha-2-missing-category">Missing category</h4>

- Fix a bug in which CREATE SCHEDULE would not properly handle a placeholder for the revision_history option. [#95675][#95675]
- Nonae [#94246][#94246]

<h4 id="v23-1-0-alpha-2-ops-changes">Ops changes</h4>

- The count of new SQL connections is now also reported on `sql.pre_serve.new_conns`. [#92580][#92580]
- The count of network bytes sent to report re-authentication errors to a SQL client is now reported via the metric `sql.pre_serve.bytesout` (instead of `sql.bytesout` previously). The count of pre-authentication errors is now reported via the metric `sql.pre_serve.conn.failures` (instead of `sql.conn.failures` previously). [#92580][#92580]

<h4 id="v23-1-0-alpha-2-changes-without-release-note-annotation">Changes without release note annotation</h4>

- [#96243][#96243] [b9a0471e4][b9a0471e4] schemachanger: Implement `ADD CONSTRAINT NOT VALID` (Xiang Gu <xiang@cockroachlabs.com>)
- [#96243][#96243] [e7d394b34][e7d394b34] schemachanger: Implement `ADD CONSTRAINT NOT VALID` (Xiang Gu <xiang@cockroachlabs.com>)
- [#96243][#96243] [99a7b47f2][99a7b47f2] schemachanger: Implement `ADD CONSTRAINT NOT VALID` (Xiang Gu <xiang@cockroachlabs.com>)
- [#96563][#96563] [bf6ce14e2][bf6ce14e2] kvcoord: Return context error when context done (Yevgeniy Miretskiy <yevgeniy@cockroachlabs.com>)
- [#96456][#96456] [26f442706][26f442706] cli: skip TestDockerCLI/test_demo_networking (Michael Butler <butler@cockroachlabs.com>)
- [#95911][#95911] [3dbb321e1][3dbb321e1] kv: perform PushTxn(PUSH_TIMESTAMP) without Raft consensus (Nathan VanBenschoten <nvanbenschoten@gmail.com>)
- [#95911][#95911] [2abca5cb4][2abca5cb4] kv: perform PushTxn(PUSH_TIMESTAMP) without Raft consensus (Nathan VanBenschoten <nvanbenschoten@gmail.com>)
- [#95911][#95911] [68fd6477f][68fd6477f] kv: perform PushTxn(PUSH_TIMESTAMP) without Raft consensus (Nathan VanBenschoten <nvanbenschoten@gmail.com>)
- [#96115][#96115] [2428a4377][2428a4377] schemachanger: Implement `DROP CONSTRAINT` in declarative schema changer (Xiang Gu <xiang@cockroachlabs.com>)
- [#96115][#96115] [ffad33a5a][ffad33a5a] schemachanger: Implement `DROP CONSTRAINT` in declarative schema changer (Xiang Gu <xiang@cockroachlabs.com>)
- [#95544][#95544] [7d1db1cd7][7d1db1cd7] Update sarama and goavro dependencies (Matt Sherman <sherman@cockroachlabs.com>)
- [#96010][#96010] [2ed44c54c][2ed44c54c] codeowners: tenant streaming team → disaster recovery (Matt Sherman <sherman@cockroachlabs.com>)
- [#96314][#96314] [f8a2c20f5][f8a2c20f5] docgen: update URL in logging doc (Ryan Kuo <8740013+taroface@users.noreply.github.com>)
- [#95556][#95556] [74dd4a175][74dd4a175] schemachanger: Implement `ALTER COLUMN ... SET NOT NULL` (Xiang Gu <xiang@cockroachlabs.com>)
- [#95556][#95556] [b9d00ddd7][b9d00ddd7] schemachanger: Implement `ALTER COLUMN ... SET NOT NULL` (Xiang Gu <xiang@cockroachlabs.com>)
- [#95556][#95556] [72ee36ab8][72ee36ab8] schemachanger: Implement `ALTER COLUMN ... SET NOT NULL` (Xiang Gu <xiang@cockroachlabs.com>)
- [#95556][#95556] [2f69d92ad][2f69d92ad] schemachanger: Implement `ALTER COLUMN ... SET NOT NULL` (Xiang Gu <xiang@cockroachlabs.com>)
- [#96030][#96030] [f7170c5db][f7170c5db] docgen: remove redundant SQL diagrams (Ryan Kuo <8740013+taroface@users.noreply.github.com>)
- [#96023][#96023] [4e6aaf381][4e6aaf381] multiregion: skip TestColdStartLatency (Michael Butler <butler@cockroachlabs.com>)
- [#95591][#95591] [bd7c9b961][bd7c9b961] docgen: update SQL diagrams for SQL docs refactor (Ryan Kuo <8740013+taroface@users.noreply.github.com>)
- [#94958][#94958] [c94d0b7fc][c94d0b7fc] add CDC to add-to-project (Matt Sherman <sherman@cockroachlabs.com>)
- [#95397][#95397] [9247472f5][9247472f5] ui: fix sql stats page data refreshing (Xin Hao Zhang <xzhang@cockroachlabs.com>)
- [#95291][#95291] [317c6e5af][317c6e5af] grunning: exclude s390x (Vivian Kong <vivkong@ca.ibm.com>)
- [#93824][#93824] [edad297aa][edad297aa] schemachanger: Implement `ADD UNIQUE WITHOUT INDEX` (Xiang Gu <xiang@cockroachlabs.com>)
- [#93824][#93824] [82d4c7cdf][82d4c7cdf] schemachanger: Implement `ADD UNIQUE WITHOUT INDEX` (Xiang Gu <xiang@cockroachlabs.com>)
- [#93824][#93824] [c7b299369][c7b299369] schemachanger: Implement `ADD UNIQUE WITHOUT INDEX` (Xiang Gu <xiang@cockroachlabs.com>)
- [#93824][#93824] [c0231f35a][c0231f35a] schemachanger: Implement `ADD UNIQUE WITHOUT INDEX` (Xiang Gu <xiang@cockroachlabs.com>)
- [#93824][#93824] [ec0a2c4c1][ec0a2c4c1] schemachanger: Implement `ADD UNIQUE WITHOUT INDEX` (Xiang Gu <xiang@cockroachlabs.com>)
- [#93068][#93068] [d05c9699d][d05c9699d]  (Xiang Gu <xiang@cockroachlabs.com>)
- [#93068][#93068] [d8d13ce98][d8d13ce98]  (Xiang Gu <xiang@cockroachlabs.com>)
- [#93068][#93068] [0e57b6aef][0e57b6aef]  (Xiang Gu <xiang@cockroachlabs.com>)
- [#93068][#93068] [e14fe033d][e14fe033d]  (Xiang Gu <xiang@cockroachlabs.com>)
- [#93068][#93068] [9a8de1ede][9a8de1ede]  (Xiang Gu <xiang@cockroachlabs.com>)
- [#93068][#93068] [9f64db7f1][9f64db7f1]  (Xiang Gu <xiang@cockroachlabs.com>)
- [#94739][#94739] [f2351f0e0][f2351f0e0] backupccl: add link to privilege docs (Aditya Maru <adityamaru@gmail.com>)
- [#94725][#94725] [019299b04][019299b04] storage: expose LazyValue for reverse scanning in pebbleMVCCScanner (Sumeer Bhola <sumeer@cockroachlabs.com>)
- [#94285][#94285] [6663caeb8][6663caeb8] Revert "sql: add replication start time to `SHOW TENANT WITH REPLICATION STATUS` (Aditya Maru <adityamaru@gmail.com>)
- [#94700][#94700] [afeaf3484][afeaf3484] kvserver: fix race in TestSchedulerBuffering (Pavel Kalinnikov <pavel@cockroachlabs.com>)
- [#94710][#94710] [25f5dd3ba][25f5dd3ba] sqlsmith: skip crdb_internal.job_payload_type in sqlsmith testing (rharding6373 <rharding6373@users.noreply.github.com>)
- [#94645][#94645] [55b032315][55b032315] roachtest/cdc: fix missing workload in cdc ledger (Jayant Shrivastava <jshrivastava03@gmail.com>)
- [#94154][#94154] [9235a8b92][9235a8b92] cloud: set orchestration version updated to 22.2.1 (Abby Hersh <abby@cockroachlabs.com>)
- [#93974][#93974] [7b92c4eb0][7b92c4eb0] roachtest: query only primary index in SHOW RANGES (Pavel Kalinnikov <pavel@cockroachlabs.com>)
- [#93901][#93901] [28288d23b][28288d23b] kvstorage: add package (Tobias Grieger <tobias@tkschmidt.me>)
- [#93190][#93190] [a94858bff][a94858bff] go.mod: import etcd/raft at the new path (Pavel Kalinnikov <pavel@cockroachlabs.com>)
- [#93891][#93891] [fc0ec5521][fc0ec5521] Update etcd/raft link in life of a query (Pavel Kalinnikov <pavel@cockroachlabs.com>)
- [#93414][#93414] [a954f43a8][a954f43a8] docs: update some paper links (Tobias Grieger <tobias@tkschmidt.me>)
- [#93414][#93414] [ce5db0c69][ce5db0c69] docs: update some paper links (Tobias Grieger <tobias@tkschmidt.me>)

<h3 id="v23-1-0-alpha-2-doc-updates">Doc updates</h3>

{% comment %}Docs team: Please add these manually.{% endcomment %}

<div class="release-note-contributors" markdown="1">

<h3 id="v23-1-0-alpha-2-contributors">Contributors</h3>

This release includes 820 merged PRs by 95 authors.
We would like to thank the following contributors from the CockroachDB community:

- Aaron Buck (first-time contributor, CockroachDB team member)
- Alex Santamaura (first-time contributor, CockroachDB team member)
- BabuSrithar (first-time contributor, CockroachDB team member)
- Catherine J (first-time contributor)
- David Hartunian (first-time contributor, CockroachDB team member)
- Faizaan Madhani
- HighPon (first-time contributor)
- Mark Sirek (first-time contributor, CockroachDB team member)
- Milad Heydari (first-time contributor, CockroachDB team member)
- Shivam Saraf (first-time contributor, CockroachDB team member)
- Vivian Kong
- ajwerner (first-time contributor)
- cockroach-teamcity (first-time contributor, CockroachDB team member)
- e-mbrown
- rharding6373
- zachlite (first-time contributor)

</div>

[#83991]: https://github.com/cockroachdb/cockroach/pull/83991
[#86061]: https://github.com/cockroachdb/cockroach/pull/86061
[#88353]: https://github.com/cockroachdb/cockroach/pull/88353
[#89613]: https://github.com/cockroachdb/cockroach/pull/89613
[#89975]: https://github.com/cockroachdb/cockroach/pull/89975
[#90830]: https://github.com/cockroachdb/cockroach/pull/90830
[#91933]: https://github.com/cockroachdb/cockroach/pull/91933
[#92285]: https://github.com/cockroachdb/cockroach/pull/92285
[#92580]: https://github.com/cockroachdb/cockroach/pull/92580
[#92589]: https://github.com/cockroachdb/cockroach/pull/92589
[#92596]: https://github.com/cockroachdb/cockroach/pull/92596
[#92949]: https://github.com/cockroachdb/cockroach/pull/92949
[#92955]: https://github.com/cockroachdb/cockroach/pull/92955
[#93068]: https://github.com/cockroachdb/cockroach/pull/93068
[#93089]: https://github.com/cockroachdb/cockroach/pull/93089
[#93157]: https://github.com/cockroachdb/cockroach/pull/93157
[#93190]: https://github.com/cockroachdb/cockroach/pull/93190
[#93219]: https://github.com/cockroachdb/cockroach/pull/93219
[#93274]: https://github.com/cockroachdb/cockroach/pull/93274
[#93377]: https://github.com/cockroachdb/cockroach/pull/93377
[#93414]: https://github.com/cockroachdb/cockroach/pull/93414
[#93513]: https://github.com/cockroachdb/cockroach/pull/93513
[#93628]: https://github.com/cockroachdb/cockroach/pull/93628
[#93644]: https://github.com/cockroachdb/cockroach/pull/93644
[#93657]: https://github.com/cockroachdb/cockroach/pull/93657
[#93673]: https://github.com/cockroachdb/cockroach/pull/93673
[#93675]: https://github.com/cockroachdb/cockroach/pull/93675
[#93748]: https://github.com/cockroachdb/cockroach/pull/93748
[#93750]: https://github.com/cockroachdb/cockroach/pull/93750
[#93751]: https://github.com/cockroachdb/cockroach/pull/93751
[#93754]: https://github.com/cockroachdb/cockroach/pull/93754
[#93757]: https://github.com/cockroachdb/cockroach/pull/93757
[#93760]: https://github.com/cockroachdb/cockroach/pull/93760
[#93769]: https://github.com/cockroachdb/cockroach/pull/93769
[#93800]: https://github.com/cockroachdb/cockroach/pull/93800
[#93824]: https://github.com/cockroachdb/cockroach/pull/93824
[#93836]: https://github.com/cockroachdb/cockroach/pull/93836
[#93838]: https://github.com/cockroachdb/cockroach/pull/93838
[#93855]: https://github.com/cockroachdb/cockroach/pull/93855
[#93858]: https://github.com/cockroachdb/cockroach/pull/93858
[#93868]: https://github.com/cockroachdb/cockroach/pull/93868
[#93871]: https://github.com/cockroachdb/cockroach/pull/93871
[#93891]: https://github.com/cockroachdb/cockroach/pull/93891
[#93901]: https://github.com/cockroachdb/cockroach/pull/93901
[#93937]: https://github.com/cockroachdb/cockroach/pull/93937
[#93938]: https://github.com/cockroachdb/cockroach/pull/93938
[#93939]: https://github.com/cockroachdb/cockroach/pull/93939
[#93952]: https://github.com/cockroachdb/cockroach/pull/93952
[#93956]: https://github.com/cockroachdb/cockroach/pull/93956
[#93974]: https://github.com/cockroachdb/cockroach/pull/93974
[#93979]: https://github.com/cockroachdb/cockroach/pull/93979
[#93991]: https://github.com/cockroachdb/cockroach/pull/93991
[#93997]: https://github.com/cockroachdb/cockroach/pull/93997
[#94002]: https://github.com/cockroachdb/cockroach/pull/94002
[#94021]: https://github.com/cockroachdb/cockroach/pull/94021
[#94031]: https://github.com/cockroachdb/cockroach/pull/94031
[#94045]: https://github.com/cockroachdb/cockroach/pull/94045
[#94106]: https://github.com/cockroachdb/cockroach/pull/94106
[#94122]: https://github.com/cockroachdb/cockroach/pull/94122
[#94123]: https://github.com/cockroachdb/cockroach/pull/94123
[#94134]: https://github.com/cockroachdb/cockroach/pull/94134
[#94151]: https://github.com/cockroachdb/cockroach/pull/94151
[#94152]: https://github.com/cockroachdb/cockroach/pull/94152
[#94153]: https://github.com/cockroachdb/cockroach/pull/94153
[#94154]: https://github.com/cockroachdb/cockroach/pull/94154
[#94165]: https://github.com/cockroachdb/cockroach/pull/94165
[#94207]: https://github.com/cockroachdb/cockroach/pull/94207
[#94246]: https://github.com/cockroachdb/cockroach/pull/94246
[#94247]: https://github.com/cockroachdb/cockroach/pull/94247
[#94285]: https://github.com/cockroachdb/cockroach/pull/94285
[#94314]: https://github.com/cockroachdb/cockroach/pull/94314
[#94339]: https://github.com/cockroachdb/cockroach/pull/94339
[#94342]: https://github.com/cockroachdb/cockroach/pull/94342
[#94355]: https://github.com/cockroachdb/cockroach/pull/94355
[#94399]: https://github.com/cockroachdb/cockroach/pull/94399
[#94405]: https://github.com/cockroachdb/cockroach/pull/94405
[#94421]: https://github.com/cockroachdb/cockroach/pull/94421
[#94425]: https://github.com/cockroachdb/cockroach/pull/94425
[#94429]: https://github.com/cockroachdb/cockroach/pull/94429
[#94432]: https://github.com/cockroachdb/cockroach/pull/94432
[#94436]: https://github.com/cockroachdb/cockroach/pull/94436
[#94440]: https://github.com/cockroachdb/cockroach/pull/94440
[#94455]: https://github.com/cockroachdb/cockroach/pull/94455
[#94581]: https://github.com/cockroachdb/cockroach/pull/94581
[#94634]: https://github.com/cockroachdb/cockroach/pull/94634
[#94645]: https://github.com/cockroachdb/cockroach/pull/94645
[#94653]: https://github.com/cockroachdb/cockroach/pull/94653
[#94670]: https://github.com/cockroachdb/cockroach/pull/94670
[#94677]: https://github.com/cockroachdb/cockroach/pull/94677
[#94692]: https://github.com/cockroachdb/cockroach/pull/94692
[#94700]: https://github.com/cockroachdb/cockroach/pull/94700
[#94705]: https://github.com/cockroachdb/cockroach/pull/94705
[#94710]: https://github.com/cockroachdb/cockroach/pull/94710
[#94719]: https://github.com/cockroachdb/cockroach/pull/94719
[#94720]: https://github.com/cockroachdb/cockroach/pull/94720
[#94725]: https://github.com/cockroachdb/cockroach/pull/94725
[#94739]: https://github.com/cockroachdb/cockroach/pull/94739
[#94771]: https://github.com/cockroachdb/cockroach/pull/94771
[#94777]: https://github.com/cockroachdb/cockroach/pull/94777
[#94791]: https://github.com/cockroachdb/cockroach/pull/94791
[#94796]: https://github.com/cockroachdb/cockroach/pull/94796
[#94806]: https://github.com/cockroachdb/cockroach/pull/94806
[#94863]: https://github.com/cockroachdb/cockroach/pull/94863
[#94894]: https://github.com/cockroachdb/cockroach/pull/94894
[#94915]: https://github.com/cockroachdb/cockroach/pull/94915
[#94948]: https://github.com/cockroachdb/cockroach/pull/94948
[#94950]: https://github.com/cockroachdb/cockroach/pull/94950
[#94958]: https://github.com/cockroachdb/cockroach/pull/94958
[#94962]: https://github.com/cockroachdb/cockroach/pull/94962
[#94985]: https://github.com/cockroachdb/cockroach/pull/94985
[#95005]: https://github.com/cockroachdb/cockroach/pull/95005
[#95009]: https://github.com/cockroachdb/cockroach/pull/95009
[#95016]: https://github.com/cockroachdb/cockroach/pull/95016
[#95020]: https://github.com/cockroachdb/cockroach/pull/95020
[#95026]: https://github.com/cockroachdb/cockroach/pull/95026
[#95029]: https://github.com/cockroachdb/cockroach/pull/95029
[#95038]: https://github.com/cockroachdb/cockroach/pull/95038
[#95091]: https://github.com/cockroachdb/cockroach/pull/95091
[#95179]: https://github.com/cockroachdb/cockroach/pull/95179
[#95190]: https://github.com/cockroachdb/cockroach/pull/95190
[#95209]: https://github.com/cockroachdb/cockroach/pull/95209
[#95219]: https://github.com/cockroachdb/cockroach/pull/95219
[#95234]: https://github.com/cockroachdb/cockroach/pull/95234
[#95258]: https://github.com/cockroachdb/cockroach/pull/95258
[#95275]: https://github.com/cockroachdb/cockroach/pull/95275
[#95289]: https://github.com/cockroachdb/cockroach/pull/95289
[#95291]: https://github.com/cockroachdb/cockroach/pull/95291
[#95294]: https://github.com/cockroachdb/cockroach/pull/95294
[#95303]: https://github.com/cockroachdb/cockroach/pull/95303
[#95326]: https://github.com/cockroachdb/cockroach/pull/95326
[#95376]: https://github.com/cockroachdb/cockroach/pull/95376
[#95397]: https://github.com/cockroachdb/cockroach/pull/95397
[#95398]: https://github.com/cockroachdb/cockroach/pull/95398
[#95413]: https://github.com/cockroachdb/cockroach/pull/95413
[#95414]: https://github.com/cockroachdb/cockroach/pull/95414
[#95426]: https://github.com/cockroachdb/cockroach/pull/95426
[#95436]: https://github.com/cockroachdb/cockroach/pull/95436
[#95450]: https://github.com/cockroachdb/cockroach/pull/95450
[#95454]: https://github.com/cockroachdb/cockroach/pull/95454
[#95461]: https://github.com/cockroachdb/cockroach/pull/95461
[#95466]: https://github.com/cockroachdb/cockroach/pull/95466
[#95467]: https://github.com/cockroachdb/cockroach/pull/95467
[#95516]: https://github.com/cockroachdb/cockroach/pull/95516
[#95532]: https://github.com/cockroachdb/cockroach/pull/95532
[#95544]: https://github.com/cockroachdb/cockroach/pull/95544
[#95553]: https://github.com/cockroachdb/cockroach/pull/95553
[#95556]: https://github.com/cockroachdb/cockroach/pull/95556
[#95562]: https://github.com/cockroachdb/cockroach/pull/95562
[#95591]: https://github.com/cockroachdb/cockroach/pull/95591
[#95599]: https://github.com/cockroachdb/cockroach/pull/95599
[#95638]: https://github.com/cockroachdb/cockroach/pull/95638
[#95639]: https://github.com/cockroachdb/cockroach/pull/95639
[#95675]: https://github.com/cockroachdb/cockroach/pull/95675
[#95710]: https://github.com/cockroachdb/cockroach/pull/95710
[#95739]: https://github.com/cockroachdb/cockroach/pull/95739
[#95795]: https://github.com/cockroachdb/cockroach/pull/95795
[#95796]: https://github.com/cockroachdb/cockroach/pull/95796
[#95798]: https://github.com/cockroachdb/cockroach/pull/95798
[#95802]: https://github.com/cockroachdb/cockroach/pull/95802
[#95848]: https://github.com/cockroachdb/cockroach/pull/95848
[#95850]: https://github.com/cockroachdb/cockroach/pull/95850
[#95868]: https://github.com/cockroachdb/cockroach/pull/95868
[#95876]: https://github.com/cockroachdb/cockroach/pull/95876
[#95883]: https://github.com/cockroachdb/cockroach/pull/95883
[#95894]: https://github.com/cockroachdb/cockroach/pull/95894
[#95911]: https://github.com/cockroachdb/cockroach/pull/95911
[#95963]: https://github.com/cockroachdb/cockroach/pull/95963
[#95997]: https://github.com/cockroachdb/cockroach/pull/95997
[#96002]: https://github.com/cockroachdb/cockroach/pull/96002
[#96010]: https://github.com/cockroachdb/cockroach/pull/96010
[#96019]: https://github.com/cockroachdb/cockroach/pull/96019
[#96023]: https://github.com/cockroachdb/cockroach/pull/96023
[#96029]: https://github.com/cockroachdb/cockroach/pull/96029
[#96030]: https://github.com/cockroachdb/cockroach/pull/96030
[#96048]: https://github.com/cockroachdb/cockroach/pull/96048
[#96112]: https://github.com/cockroachdb/cockroach/pull/96112
[#96113]: https://github.com/cockroachdb/cockroach/pull/96113
[#96115]: https://github.com/cockroachdb/cockroach/pull/96115
[#96202]: https://github.com/cockroachdb/cockroach/pull/96202
[#96213]: https://github.com/cockroachdb/cockroach/pull/96213
[#96217]: https://github.com/cockroachdb/cockroach/pull/96217
[#96243]: https://github.com/cockroachdb/cockroach/pull/96243
[#96278]: https://github.com/cockroachdb/cockroach/pull/96278
[#96279]: https://github.com/cockroachdb/cockroach/pull/96279
[#96287]: https://github.com/cockroachdb/cockroach/pull/96287
[#96302]: https://github.com/cockroachdb/cockroach/pull/96302
[#96314]: https://github.com/cockroachdb/cockroach/pull/96314
[#96340]: https://github.com/cockroachdb/cockroach/pull/96340
[#96371]: https://github.com/cockroachdb/cockroach/pull/96371
[#96456]: https://github.com/cockroachdb/cockroach/pull/96456
[#96466]: https://github.com/cockroachdb/cockroach/pull/96466
[#96476]: https://github.com/cockroachdb/cockroach/pull/96476
[#96510]: https://github.com/cockroachdb/cockroach/pull/96510
[#96562]: https://github.com/cockroachdb/cockroach/pull/96562
[#96563]: https://github.com/cockroachdb/cockroach/pull/96563
[019299b04]: https://github.com/cockroachdb/cockroach/commit/019299b04
[0e57b6aef]: https://github.com/cockroachdb/cockroach/commit/0e57b6aef
[2428a4377]: https://github.com/cockroachdb/cockroach/commit/2428a4377
[25f5dd3ba]: https://github.com/cockroachdb/cockroach/commit/25f5dd3ba
[26f442706]: https://github.com/cockroachdb/cockroach/commit/26f442706
[28288d23b]: https://github.com/cockroachdb/cockroach/commit/28288d23b
[2abca5cb4]: https://github.com/cockroachdb/cockroach/commit/2abca5cb4
[2ed44c54c]: https://github.com/cockroachdb/cockroach/commit/2ed44c54c
[2f69d92ad]: https://github.com/cockroachdb/cockroach/commit/2f69d92ad
[317c6e5af]: https://github.com/cockroachdb/cockroach/commit/317c6e5af
[3dbb321e1]: https://github.com/cockroachdb/cockroach/commit/3dbb321e1
[4e6aaf381]: https://github.com/cockroachdb/cockroach/commit/4e6aaf381
[55b032315]: https://github.com/cockroachdb/cockroach/commit/55b032315
[6663caeb8]: https://github.com/cockroachdb/cockroach/commit/6663caeb8
[68fd6477f]: https://github.com/cockroachdb/cockroach/commit/68fd6477f
[72ee36ab8]: https://github.com/cockroachdb/cockroach/commit/72ee36ab8
[74dd4a175]: https://github.com/cockroachdb/cockroach/commit/74dd4a175
[7b92c4eb0]: https://github.com/cockroachdb/cockroach/commit/7b92c4eb0
[7d1db1cd7]: https://github.com/cockroachdb/cockroach/commit/7d1db1cd7
[82d4c7cdf]: https://github.com/cockroachdb/cockroach/commit/82d4c7cdf
[9235a8b92]: https://github.com/cockroachdb/cockroach/commit/9235a8b92
[9247472f5]: https://github.com/cockroachdb/cockroach/commit/9247472f5
[99a7b47f2]: https://github.com/cockroachdb/cockroach/commit/99a7b47f2
[9a8de1ede]: https://github.com/cockroachdb/cockroach/commit/9a8de1ede
[9f64db7f1]: https://github.com/cockroachdb/cockroach/commit/9f64db7f1
[a94858bff]: https://github.com/cockroachdb/cockroach/commit/a94858bff
[a954f43a8]: https://github.com/cockroachdb/cockroach/commit/a954f43a8
[afeaf3484]: https://github.com/cockroachdb/cockroach/commit/afeaf3484
[b9a0471e4]: https://github.com/cockroachdb/cockroach/commit/b9a0471e4
[b9d00ddd7]: https://github.com/cockroachdb/cockroach/commit/b9d00ddd7
[bd7c9b961]: https://github.com/cockroachdb/cockroach/commit/bd7c9b961
[bf6ce14e2]: https://github.com/cockroachdb/cockroach/commit/bf6ce14e2
[c0231f35a]: https://github.com/cockroachdb/cockroach/commit/c0231f35a
[c7b299369]: https://github.com/cockroachdb/cockroach/commit/c7b299369
[c94d0b7fc]: https://github.com/cockroachdb/cockroach/commit/c94d0b7fc
[ce5db0c69]: https://github.com/cockroachdb/cockroach/commit/ce5db0c69
[d05c9699d]: https://github.com/cockroachdb/cockroach/commit/d05c9699d
[d8d13ce98]: https://github.com/cockroachdb/cockroach/commit/d8d13ce98
[e14fe033d]: https://github.com/cockroachdb/cockroach/commit/e14fe033d
[e7d394b34]: https://github.com/cockroachdb/cockroach/commit/e7d394b34
[ec0a2c4c1]: https://github.com/cockroachdb/cockroach/commit/ec0a2c4c1
[edad297aa]: https://github.com/cockroachdb/cockroach/commit/edad297aa
[f2351f0e0]: https://github.com/cockroachdb/cockroach/commit/f2351f0e0
[f7170c5db]: https://github.com/cockroachdb/cockroach/commit/f7170c5db
[f8a2c20f5]: https://github.com/cockroachdb/cockroach/commit/f8a2c20f5
[fc0ec5521]: https://github.com/cockroachdb/cockroach/commit/fc0ec5521
[ffad33a5a]: https://github.com/cockroachdb/cockroach/commit/ffad33a5a
