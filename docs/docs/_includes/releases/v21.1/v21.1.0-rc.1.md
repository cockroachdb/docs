## v21.1.0-rc.1

Release Date: May 5, 2021

{% include releases/release-downloads-docker-image.md release=include.release %}

<h3 id="v21-1-0-rc-1-sql-language-changes">SQL language changes</h3>

- CockroachDB no longer allows [`ADD REGION`](../v21.1/add-region.html) or `DROP REGION` statements if a [`REGIONAL BY ROW`](../v21.1/multiregion-overview.html) table has index changes underway, or if a table is transitioning to or from `REGIONAL BY ROW`. [#64255][#64255] {% comment %}doc{% endcomment %}
- CockroachDB now prevents index modification on `REGIONAL BY ROW` tables and locality to or from `REGIONAL BY ROW` changes while an `ADD REGION` or `DROP REGION` statement is being executed. [#64255][#64255] {% comment %}doc{% endcomment %}

<h3 id="v21-1-0-rc-1-bug-fixes">Bug fixes</h3>

- Fixed a scenario in which a rapid sequence of [range splits](../v21.1/architecture/distribution-layer.html#range-splits) could trigger a storm of [Raft snapshots](../v21.1/architecture/replication-layer.html#snapshots). This would be accompanied by log messages of the form "would have dropped incoming MsgApp, but allowing due to ..." and tended to occur as part of [`RESTORE`](../v21.1/restore.html)/[`IMPORT`](../v21.1/import.html) operations. [#64202][#64202]
- Read-write contention on [`GLOBAL` tables](../v21.1/multiregion-overview.html) no longer has a potential to thrash without making progress. [#64215][#64215]
- Previously, if a [`DROP INDEX`](../v21.1/drop-index.html) failed during a `REGIONAL BY ROW` transition, the index could have been re-inserted back into the `REGIONAL BY ROW` table but would be invalid if it was [hash-sharded](../v21.1/hash-sharded-indexes.html) or [partitioned](../v21.1/multiregion-overview.html). This bug is now fixed. [#64255][#64255]
- Fixed a rare bug present in [v21.1 beta versions](index.html#testing-releases) that could cause rapid range splits and merges on a `GLOBAL` table to lead to a stuck leaseholder replica. The situation is no longer possible. [#64304][#64304]
- Fixed a bug in previous v21.1 beta versions that allowed the store rebalancer to spuriously down-replicate a range during normal operation. [#64303][#64303]
- CockroachDB now prevents some out-of-memory conditions caused by [schema change](../v21.1/online-schema-changes.html) validations concurrent with other high-memory-use queries. [#64307][#64307]
- Fixed a bug present since [v21.1.0-alpha.1](#v21-1-0-alpha-1) that could cause cascading [`DELETE`](../v21.1/delete.html)s with [subqueries](../v21.1/subqueries.html) to error. [#64278][#64278]
- Fixed a bug that caused store information to be incorrectly redacted from the [CockroachDB logs](../v21.1/logging-overview.html), when logging was configured with redaction. [#64338][#64338]
- Previously, the remote flows of execution in the [vectorized engine](../v21.1/vectorized-execution.html) could take a long time to shut down if a node participating in the plan died. This bug is now fixed. [#64219][#64219]

<h3 id="v21-1-0-rc-1-contributors">Contributors</h3>

This release includes 14 merged PRs by 14 authors.

[#64202]: https://github.com/cockroachdb/cockroach/pull/64202
[#64215]: https://github.com/cockroachdb/cockroach/pull/64215
[#64219]: https://github.com/cockroachdb/cockroach/pull/64219
[#64255]: https://github.com/cockroachdb/cockroach/pull/64255
[#64278]: https://github.com/cockroachdb/cockroach/pull/64278
[#64303]: https://github.com/cockroachdb/cockroach/pull/64303
[#64304]: https://github.com/cockroachdb/cockroach/pull/64304
[#64307]: https://github.com/cockroachdb/cockroach/pull/64307
[#64338]: https://github.com/cockroachdb/cockroach/pull/64338
