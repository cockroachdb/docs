## v21.1.0-beta.1

Release Date: March 22, 2021

{% include releases/release-downloads-docker-image.md release=include.release %}

<h3 id="v21-1-0-beta-1-backward-incompatible-changes">Backward-incompatible changes</h3>

- The [`cockroach debug ballast`](../v21.1/cockroach-debug-ballast.html) command now refuses to overwrite the target ballast file if it already exists. This change is intended to prevent mistaken uses of the `ballast` command by operators. Scripts that integrate `cockroach debug ballast` can consider adding a `rm` command. [#59995][#59995] {% comment %}doc{% endcomment %}
- Removed the `kv.atomic_replication_changes.enabled` [cluster setting](../v21.1/cluster-settings.html). All replication changes on a range now use joint-consensus. [#61170][#61170] {% comment %}doc{% endcomment %}

<h3 id="v21-1-0-beta-1-security-updates">Security updates</h3>

- It is now possible to log SQL statements executed by admin users. This logging is enabled via the `sql.log.admin_audit.enabled` [cluster setting](../v21.1/cluster-settings.html). When set, events of type `admin_query` are logged to the `SENSITIVE_ACCESS` channel. [#60708][#60708] {% comment %}doc{% endcomment %}

<h3 id="v21-1-0-beta-1-general-changes">General changes</h3>

- Updated the AWS SDK used to interface with AWS services such as S3 (for backup, restore, and import) and KMS (for backup/restore). [#59709][#59709] {% comment %}doc{% endcomment %}
- [`SHOW TRACE FOR SESSION`](../v21.1/show-trace.html) previously included CockroachDB internal traces for async threads kicked off as part of user operations. This trace data is no longer captured. [#59815][#59815] {% comment %}doc{% endcomment %}
- Crash reports that are sent to Cockroach Labs no longer redact the names of built-in virtual tables from the `crdb_internal`, `information_schema`, and `pg_catalog` schemas. [#60799][#60799]
- Raised the default limit on the maximum number of spans that can be protected by the `protectedts` subsystem. This limit can be configured using the `kv.protectedts.max_spans` [cluster setting](../v21.1/cluster-settings.html). [#61018][#61018] {% comment %}doc{% endcomment %}

<h3 id="v21-1-0-beta-1-enterprise-edition-changes">Enterprise edition changes</h3>

- Added the `bulkio.stream_ingestion.minimum_flush_interval` [cluster setting](../v21.1/cluster-settings.html), which allows the user to control how often the stream ingestion job will flush. Note that the job may still flush more often if the in-memory buffers are filled. [#60160][#60160] {% comment %}doc{% endcomment %}
- CockroachDB now supports [primary key](../v21.1/primary-key.html) changes in [`CREATE CHANGEFEED`](../v21.1/create-changefeed.html). [#58422][#58422] {% comment %}doc{% endcomment %}
- [Multi-region database](../v21.1/movr-flask-database.html) creations are now permitted as long as the cluster has a CockroachDB subscription. [#61041][#61041] {% comment %}doc{% endcomment %}
- `ALTER DATABASE ... ADD REGION` now requires an enterprise license.[#61169][#61169] {% comment %}doc{% endcomment %}

<h3 id="v21-1-0-beta-1-sql-language-changes">SQL language changes</h3>

- Added a virtual table, `crdb_internal.node_inflight_trace_spans`, which exposes span ID, parent span ID, trace ID, start time, duration, and operation of node-local inflight spans. [#59492][#59492] {% comment %}doc{% endcomment %}
- Added `WITH avro_schema_prefix` option to Avro [changefeeds](../v21.1/create-changefeed.html) to prevent collisions in a shared schema registry [#59710][#59710] {% comment %}doc{% endcomment %}
- CockroachDB now allows implicitly partitioned indexes to be referenced by foreign keys using the non-implicit columns. [#59692][#59692] {% comment %}doc{% endcomment %}
- The [`SHOW ZONE CONFIGURATION`](../v21.1/show-zone-configurations.html) statement has been changed to use `FROM` instead of `FOR`. [#59410][#59410] {% comment %}doc{% endcomment %}
- It is now possible to use the `NOT VISIBLE` qualifier for new column definitions in [`CREATE TABLE`](../v21.1/create-table.html). This causes the column to become "hidden". Hidden columns are not considered when using `*` in `SELECT` clauses. Note that CockroachDB already supported hidden columns (e.g., `rowid`, which is added automatically when a table definition has no `PRIMARY KEY` constraint). This change adds the opportunity for end-users to define their own hidden columns. It is intended for use in combination with other features related to geo-partitioning introduced in v21.1, which offer more control about how geo-partitioning keys get exposed to client ORMs and other automated tools that inspect the SQL schema. [#58923][#58923] {% comment %}doc{% endcomment %}
- Added the `goroutine_id` column to the `crdb_internal.node_inflight_trace_spans` virtual table that represents the goroutine ID associated with a particular span. [#59717][#59717] {% comment %}doc{% endcomment %}
- Updated [`SHOW BACKUP ... WITH PRIVILEGES`](../v21.1/show-backup.html) to display ownership information of objects in the backup. [#59732][#59732] {% comment %}doc{% endcomment %}
- The [`ALTER TYPE ... DROP VALUE ...`](../v21.1/alter-type.html) statement has been added to drop values from an [`ENUM`](../v21.1/enum.html) type. The statement drops the provided value if it isn't used as a value in any table's row. The use of this syntax is gated behind the `sql_safe_updates` [session variable](../v21.1/set-vars.html), as it is susceptible to the value being used in a table expression (such as a computed column). [#58688][#58688] {% comment %}doc{% endcomment %}
- Added support for `COPY CSV`. [#59790][#59790] {% comment %}doc{% endcomment %}
- CockroachDB now supports specifying `NULL` and `DELIMITER` in `COPY`. [#59790][#59790] {% comment %}doc{% endcomment %}
- [`ALTER TABLE ... SET LOCALITY`](../v21.1/alter-table.html) adds the ability to change the locality of a `GLOBAL` or `REGIONAL BY TABLE` table to `REGIONAL BY ROW`, provided an existing column of the appropriate type already exists. [#59624][#59624] {% comment %}doc{% endcomment %}
- Overload sequence operators now accept a regclass. [#59396][#59396]
- `crdb_internal.invalid_objects` now includes invalid type descriptors. [#59978][#59978] {% comment %}doc{% endcomment %}
- Added the `finished` column to the virtual table `crdb_internal.node_inflight_trace_spans`, which represents whether each span has finished or not. [#59856][#59856] {% comment %}doc{% endcomment %}
- Partitioned [GIN indexes](../v21.1/inverted-indexes.html) are now supported. [#59858][#59858] {% comment %}doc{% endcomment %}
- Hidden columns (created by using `NOT VISIBLE` or implicitly created via hash sharded indexes, a lack of a primary key definition, or by using `REGIONAL BY ROW`) will now display with `NOT VISIBLE` annotations on [`SHOW CREATE TABLE`](../v21.1/show-create.html). [#59828][#59828] {% comment %}doc{% endcomment %}
- `REGIONAL BY ROW` tables that have an implicitly created `crdb_region` table will now mark the given column as hidden so it does not display in `SELECT *` statements. [#59831][#59831] {% comment %}doc{% endcomment %}
- CockroachDB now recognizes the `options` URL parameter. The `options` parameter specifies session variables to set at connection start. This is treated the same as defined in the [PostgreSQL docs](https://www.postgresql.org/docs/13/libpq-connect.html#LIBPQ-PARAMKEYWORDS). [#59621][#59621] {% comment %}doc{% endcomment %}
- Implemented the ability to `ALTER TABLE SET LOCALITY` to `REGIONAL BY ROW` without specifying `AS` for `GLOBAL` and `REGIONAL BY TABLE` tables. [#59824][#59824] {% comment %}doc{% endcomment %}
- Added the `sql.show_tables.estimated_row_count.enabled` [cluster setting](../v21.1/cluster-settings.html), which defaults to `true`. If `false`, `estimated_row_count` will not display on `SHOW TABLES` which improves performance. [#60282][#60282] {% comment %}doc{% endcomment %}
- [`ALTER DATABASE ... DROP REGION`](../v21.1/alter-database.html) is now implemented. [#59989][#59989] {% comment %}doc{% endcomment %}
- When a connection is established, CockroachDB will now return a placeholder `BackendKeyData` message in the response. This is for compatibility with some tools, but using `BackendKeyData` to cancel a query will still have no effect (which is the same as before). [#60281][#60281] {% comment %}doc{% endcomment %}
- To match the behavior of `PRIMARY KEY` creations setting, all relevant fields to `NOT NULL`, all `PARTITION BY` / R`EGIONAL BY ROW` columns will now have their fields set to `NOT NULL` at [`CREATE TABLE`](../v21.1/create-table.html) time. [#60379][#60379] {% comment %}doc{% endcomment %}
- [`ALTER DATABASE ... DROP REGION`](../v21.1/alter-database.html) now allows for dropping the primary region. [#60437][#60437] {% comment %}doc{% endcomment %}
- Added support for [restore](../v21.1/restore.html) of multi-region databases. [#60257][#60257] {% comment %}doc{% endcomment %}
- Implemented functionality to [`ALTER TABLE SET LOCALITY`](../v21.1/alter-table.html) from `REGIONAL BY ROW` to `REGIONAL BY TABLE` or `GLOBAL`. [#60311][#60311] {% comment %}doc{% endcomment %}
- Materialized views now require ownership or admin privilege to refresh. [#60448][#60448] {% comment %}doc{% endcomment %}
- `CONNECT` can be granted to / revoked from users at the database level (e.g., `GRANT CONNECT ON DATABASE db TO user;`). `CONNECT` allows users to view all objects in a database in `information_schema` and `pg_catalog`. Previously, only users could only see an object in `information_schema` / `pg_catalog` if they had any privilege (e.g., `SELECT`) on the object.  Added a warning when using `USE DATABASE` that notifies the user that they do not have `CONNECT` privilege on the database and will need `CONNECT` privilege to use databases in a future release. [#59676][#59676] {% comment %}doc{% endcomment %}
- Add the built-in `crdb_internal.show_create_all_tables`, which takes in a database name (`STRING`) and returns a flat log of all the [`CREATE TABLE`](../v21.1/create-table.html) statements in the database followed by `ALTER` statements to add constraints. The output can be used to recreate a database. This built-in was added to replace old dump logic. [#60154][#60154] {% comment %}doc{% endcomment %}
- Implemented `default_to_database_primary_region`, which will return the region passed in if the region is defined on the database, falling back to the primary key if not. [#59836][#59836] {% comment %}doc{% endcomment %}
- The default expression for `REGIONAL BY ROW` tables is now `default_to_database_primary_region(gateway_region())`, allowing users to add to `REGIONAL BY ROW` tables from any region. This would previously error if the gateway's region was not defined on the database. [#59836][#59836] {% comment %}doc{% endcomment %}
- [`EXPLAIN`](../v21.1/explain.html) now shows the estimated percentage of the table that is scanned. [#60467][#60467] {% comment %}doc{% endcomment %}
- Multi-region tables will have their zone configs regenerated during database [restore](../v21.1/restore.html). [#60519][#60519] {% comment %}doc{% endcomment %}
- CockroachDB now supports the `DETACHED` option when running [`IMPORT`](../v21.1/import.html). The detached import will return `jobID` and the user can later use [`SHOW JOB`](../v21.1/show-jobs.html) to check the result of the detached import. This allows users to run `IMPORT` under explicit transactions with `DETACHED` option specified. [#60442][#60442] {% comment %}doc{% endcomment %}
- Casting JSON numeric scalars to numeric types now works as expected. [#41367][#41367] {% comment %}doc{% endcomment %}
- Most batches of data flowing through the vectorized execution engine will now be limited in size by `sql.distsql.temp_storage.workmem` (64MiB by default), which should improve the stability of CockroachDB clusters. [#59851][#59851] {% comment %}doc{% endcomment %}
- Implemented the ability to [`ALTER TABLE LOCALITY REGIONAL BY ROW`](../v21.1/alter-table.html) from other `REGIONAL BY ROW` variants. [#60497][#60497] {% comment %}doc{% endcomment %}
- Setting of [zone configs](../v21.1/configure-replication-zones.html) for non-physical tables is now forbidden. [#60592][#60592] {% comment %}doc{% endcomment %}
- Added telemetry to track usage of `pg_catalog` and `information_schema` tables [#60511][#60511]
- [`SHOW JOBS`](../v21.1/show-jobs.html) now displays a meaningful value in the `running_status` column for GC jobs which are actually performing garbage collection, as opposed to waiting on a timer. [#59220][#59220] {% comment %}doc{% endcomment %}
- Added the [`SHOW CREATE ALL TABLES`](../v21.1/show-create.html) statement, which allows the user to get the statements (`CREATE`/`ALTER`) to recreate a the current database. The command returns a flat log of the create statements followed by the alter statements for adding the constraints. The commands are ordered topologically such that dependencies appear before it's references. `ALTER` statements follow create statements to guarantee that the objects are all added before adding constraints. This command is added to replace old dump logic. [#60539][#60539] {% comment %}doc{% endcomment %}
- Added the `schema_name` and `table_i`d columns to the `crdb_internal.ranges` and `crdb_internal.ranges_no_leases` virtual tables. [#59865][#59865] {% comment %}doc{% endcomment %}
- Using the `CACHE` sequence option no longer results in an "unimplemented" error. The `CACHE` option is now fully implemented and will allow nodes to cache sequence numbers. A cache size of 1 means that there is no cache, and cache sizes of less than 1 are not valid. [#56954][#56954] {% comment %}doc{% endcomment %}
- The `serial_normalization` [session variable](../v21.1/set-vars.html) can now be set to the value `sql_sequence_cached`. If this value is set, the `sql.defaults.serial_sequences_cache_size` [cluster setting](../v21.1/cluster-settings.html) can be used to control the number of values to cache in a user's session with a default of 256. When the cache is empty, the underlying sequence will only be incremented once to populate it. Using `sql_sequence_cached` will result in better performance than `sql_sequence` because the former will perform fewer distributed calls to increment sequences. However, cached sequences may result in large gaps between serial sequence numbers if a session terminates before using all the values in its cache. [#56954][#56954] {% comment %}doc{% endcomment %}
- CockroachDB can now encode and decode [sequence](../v21.1/create-sequence.html) regclasses. [#59864][#59864]
- CockroachDB now allows renaming of [sequences](../v21.1/create-sequence.html) referenced by ID and conversion of sequences referenced by name to ID. [#59864][#59864] {% comment %}doc{% endcomment %}
- [`EXPLAIN ANALYZE`](../v21.1/explain-analyze.html) now shows more top-level query statistics. [#60641][#60641] {% comment %}doc{% endcomment %}
- Added `payloads_for_span` built-in that takes in a span ID and returns its payloads in `JSONB` format. If the span is not found, or if the span does not have any payloads, the built-in returns an empty JSON object. [#60616][#60616] {% comment %}doc{% endcomment %}
- Added a new [`IMPORT PGDUMP`](../v21.1/import.html) option, `ignore_unsupported`, to skip over all the unsupported `PGDUMP` statements. The collection of these statements will be appropriately documented. [#57827][#57827] {% comment %}doc{% endcomment %}
- Users will now need to specify `ignore_unsupported` to ignore all unsupported import statements during an [`IMPORT PGDUMP`](../v21.1/import.html). [#57827][#57827] {% comment %}doc{% endcomment %}
- Added a new [`IMPORT PGDUMP`](../v21.1/import.html) option, `ignored_stmt_log`, which allows users to specify where they would like to log statements that have been skipped during an import, by virtue of being unsupported. [#57827][#57827] {% comment %}doc{% endcomment %}
- CockroachDB now supports `VIRTUAL` [computed columns](../v21.1/computed-columns.html) (as opposed to `STORED`). These are computed columns that are not stored in the primary index and are recomputed as necessary. [#60748][#60748] {% comment %}doc{% endcomment %}
- [`EXPLAIN ANALYZE`](../v21.1/explain-analyze.html) now includes the nodes which were involved in the execution of each operator in the tree. [#60550][#60550] {% comment %}doc{% endcomment %}
- Added missing tables and columns at `pg_catalog`. [#60758][#60758] {% comment %}doc{% endcomment %}
- Added a new [session setting](../v21.1/set-vars.html) `locality_optimized_partitioned_index_scan` and corresponding [cluster default setting](../v21.1/cluster-settings.html) `sql.defaults.locality_optimized_partitioned_index_scan.enabled`. Both are currently disabled by default, and are currently unused. In the future, these settings will be used to enable or disable locality optimized search. If enabled, the optimizer will try to search locally for rows in `REGIONAL BY ROW` tables before searching remote nodes. [#60771][#60771] {% comment %}doc{% endcomment %}
- Added the new `parse_timestamp` function, which can be used to parse absolute timestamp strings in computed column expressions or partial index predicates. [#60772][#60772] {% comment %}doc{% endcomment %}
- CockroachDB now supports storing spatial type objects with `Z` and `M` dimensions (e.g., `POINTZ`, `LINESTRINGM`). [#60832][#60832] {% comment %}doc{% endcomment %}
- [`ALTER DATABASE ... ADD REGION`](../v21.1/alter-database.html) now re-partitions `REGIONAL BY ROW` tables and updates the [zone configs](../v21.1/configure-replication-zones.html) on the newly created partitions as well. [#60596][#60596] {% comment %}doc{% endcomment %}
- Updated the `crdb_internal.payloads_for_span` built-in to return a table instead of a `JSONB` array. Each row of the table represents one payload for the given span. It has columns for `payload_type` and `payload_jsonb`. [#60784][#60784] {% comment %}doc{% endcomment %}
- [`ALTER DATABASE ... DROP REGION ...`](../v21.1/alter-database.html) now re-partitions `REGIONAL BY ROW` tables to remove the partition for the removed region and removes the [zone configuration](../v21.1/configure-replication-zones.html) for the partition as well. [#60938][#60938] {% comment %}doc{% endcomment %}
- Added the experimental `experimental_enable_stream_replication` [session setting](../v21.1/set-vars.html) and `sql.defaults.experimental_stream_replication.enabled` [cluster setting](../v21.1/cluster-settings.html) to enable cluster streaming. [#60826][#60826] {% comment %}doc{% endcomment %}
- Introduced a new `is_multi_region` column to c`rdb_internal.create_statements`, which informs whether the database of the object is a multi-region database. [#60761][#60761] {% comment %}doc{% endcomment %}
- Introduced the new `crdb_internal.filter_multiregion_fields_from_zone_config_sql` built-in, which removes multi-region fields from a [`CONFIGURE ZONE`](../v21.1/configure-zone.html) statement. [#60761][#60761] {% comment %}doc{% endcomment %}
- Added new virtual tables `crdb_internal.cluster_contention_events` and `crdb_internal.node_contention_events`, which expose cluster-wide and gateway-only, respectively, contention information. In order to access them, the user needs to be either an admin or have `VIEWACTIVITY` grant. [#60713][#60713] {% comment %}doc{% endcomment %}
- The structured payloads used for SQL audit and execution logs now include a transaction counter since the beginning of the session. Statements issued inside the same SQL [transaction](../v21.1/transactions.html) will thus be logged with the same counter value, thus enabling per-transactions grouping during log analysis. Separate sessions use independent counters. [#41929][#41929] {% comment %}doc{% endcomment %}
- The geometry built-ins `ST_MakePoint` and `ST_MakePointM` have been implemented and provide a mechanism for easily creating new points. [#61105][#61105] {% comment %}doc{% endcomment %}
- Added the `payloads_for_trace()` built-in so that all payloads attached to all spans for a given trace ID will be displayed, utilizing the `crdb_internal.payloads_for_span()` built-in under the hood. All payloads for long-running spans are also added to debug.zip in the `crdb_internal.node_inflight_trace_spans` table dump. [#60922][#60922] {% comment %}doc{% endcomment %}
- [`IMPORT PGDUMP`](../v21.1/import.html) can now import dump files with non-public schemas. [#57183][#57183] {% comment %}doc{% endcomment %}
- Added the `sql.optimizer.uniqueness_checks_for_gen_random_uuid.enabled` [cluster setting](../v21.1/cluster-settings.html), which controls creation of uniqueness checks for [`UUID`](../v21.1/uuid.html) columns set to `gen_random_uuid()`. When enabled, uniqueness checks will be added for the `UUID` column if it has a unique constraint that cannot be enforced by an index. When disabled, no uniqueness checks are planned for these columns, and uniqueness is assumed due to the near-zero collision probability of `gen_random_uuid()`. [#61132][#61132] {% comment %}doc{% endcomment %}
- The `pg_catalog.pg_class` table now has a `relpartbound` column. This is only for compatibility, and the column value is always `NULL`. [#61162][#61162] {% comment %}doc{% endcomment %}
- Cluster [backup](../v21.1/backup.html) now [restores](../v21.1/restore.html) the zone configurations first. This means that there should be less range-relocation during and after cluster restores. [#60461][#60461] {% comment %}doc{% endcomment %}
- Fixed `information_schema.columns.udt_schema` for `ENUM` or user-defined types. [#61139][#61139] {% comment %}doc{% endcomment %}
- The geography built-in `ST_Affine` now supports 3D transformations. [#61286][#61286] {% comment %}doc{% endcomment %}
- The `ST_Z`, `ST_M`, and `ST_Zmflag` built-ins are now available for use. [#61032][#61032] {% comment %}doc{% endcomment %}
- Geometry built-ins for forcing geometries into non-2D layouts are now available. [#61297][#61297] {% comment %}doc{% endcomment %}
- `ST_Buffer` now requires at least 1 quadrant segment. [#61315][#61315] {% comment %}doc{% endcomment %}
- `ST_RotateX` function is now available. [#61326][#61326] {% comment %}doc{% endcomment %}
- [`EXPLAIN`](../v21.1/explain.html) now shows estimated row counts for all operators even without `VERBOSE` (except when we do not have statistics for the tables). [#61344][#61344] {% comment %}doc{% endcomment %}
- Updated the error message returned in case of a [unique constraint](../v21.1/unique.html) violation to hide the names and values for implicit partitioning columns and hash sharded index columns. [#61362][#61362]
- Fixed `information_schema.columns.is_identity` to display the correct value. [#61348][#61348]
- `ST_RotateY` and `ST_RotateZ` are now available. [#61387][#61387] {% comment %}doc{% endcomment %}
- CockroachDB now prevents `densifyFracs < 1e-6` for `ST_FrechetDistance` and `ST_HausdorffDistance` to protect panics and out-of-memory errors. [#61427][#61427]
- CockroachDB now disallows `GRANT/REVOKE` operations on system tables. [#61410][#61410] {% comment %}doc{% endcomment %}
- `ST_Snap` is now available. [#61523][#61523] {% comment %}doc{% endcomment %}
- Updates to certain fields in the zone configurations are blocked for multi-region enabled databases. This block can be overridden through the use of the `FORCE` keyword on the blocked statement. [#61499][#61499] {% comment %}doc{% endcomment %}
- The `ST_AddMeasure` function is now available for use. [#61514][#61514] {% comment %}doc{% endcomment %}
- Added a new built-in that sets the verbosity of all spans in a given trace. Syntax: `crdb_internal.set_trace_verbose($traceID,$verbosityAsBool)`. [#61353][#61353] {% comment %}doc{% endcomment %}
- `Pg_index.indkey` now includes attributes. [#61494][#61494] {% comment %}doc{% endcomment %}
- [`SHOW CREATE ALL TABLES`](../v21.1/show-create.html) is updated to be more memory efficient, however this should still not be run on a database with an excessive number of tables. Users should not run this on a database with more than 10000 tables (arbitrary but tested number). [#61127][#61127] {% comment %}doc{% endcomment %}
- Set the default [cluster setting](../v21.1/cluster-settings.html) for `sql.defaults.locality_optimized_partitioned_index_scan.enabled` to `true`, which is the default for the [session setting](../v21.1/set-vars.html) `locality_optimized_partitioned_index_scan`. When this session setting is enabled, the optimizer will plan queries to use "locality optimized search" when possible, which instructs the execution engine to search for keys in local nodes before searching remote nodes. If a key is found in a local node, the execution engine may be able to avoid visiting the remote nodes altogether. [#61601][#61601] {% comment %}doc{% endcomment %}
- [`ALTER TYPE ... DROP VALUE`](../v21.1/alter-type.html) is gated behind a feature flag. The [session setting](../v21.1/set-vars.html) is called `enable_drop_enum_value` and the corresponding [cluster setting](../v21.1/cluster-settings.html) is called `sql.defaults.drop_enum_value.enabled`. [#61723][#61723] {% comment %}doc{% endcomment %}
- `TYPE SCHEMA CHANGE` jobs which include a `DROP VALUE` in them are now cancellable. All other jobs remain non-cancellable. [#61733][#61733] {% comment %}doc{% endcomment %}
- A statement contention timeseries is now displayed in the SQL metrics overview dashboard. [#61844][#61844] {% comment %}doc{% endcomment %}
- The `ST_SnapToGrid` function can now be used to snap `Z` and `M` dimensions. [#61826][#61826] {% comment %}doc{% endcomment %}
- Added `json_extract_path_text` and `jsonb_extract_path_text` built-ins. [#61813][#61813] {% comment %}doc{% endcomment %}
- Removed `pg_catalog` tables that were mistakenly added, notably all tables that end in `_index` that are not `pg_catalog.pg_classes` and all statistics collector tables that are not `pg_stat_activity`. [#61876][#61876]
- The `replicas` column of `crdb_internal.ranges{_no_leases}` now includes both voting and non-voting replicas and `crdb_internal.ranges{_no_leases}` include two new columns: `voting_replicas` and `non_voting_replicas`, which work as labeled. [#61962][#61962] {% comment %}doc{% endcomment %}

<h3 id="v21-1-0-beta-1-operational-changes">Operational changes</h3>

- Added the `storage.transaction.separated_intents.enabled` [cluster setting](../v21.1/cluster-settings.html), which enables separated intents by default. [#59829][#59829] {% comment %}doc{% endcomment %}

<h3 id="v21-1-0-beta-1-command-line-changes">Command-line changes</h3>

- It is now possible to redirect logging to [Fluentd](https://www.fluentd.org)-compatible network collectors. See the reference sink documentation for details.This is an alpha-quality feature. Note that Fluent-enabled configuration only provide minimal event buffering, and log entries are dropped if the logging server becomes unavailable or network errors are encountered. This is a known limitation and will be likely improved in a later version. [#57170][#57170] {% comment %}doc{% endcomment %}
- The SQL shell ([`cockroach sql`](../v21.1/cockroach-sql.html) / [`cockroach demo`](../v21.1/cockroach-demo.html)) now supports a flag `--embedded`, for use with playground-style web applications. [#59750][#59750] {% comment %}doc{% endcomment %}
- [`cockroach userfile get`](../v21.1/cockroach-userfile-get.html) can now be used to fetch files from a cluster. [#60490][#60490] {% comment %}doc{% endcomment %}
- Added the `ignore-unsupported-statements`, `log-ignored-statements` and `row-limit` flags to the [`cockroach import`](../v21.1/cockroach-import.html) command. [#60923][#60923] {% comment %}doc{% endcomment %}
- The doctor tool can now report multiple descriptor validation failures per descriptor. [#60775][#60775]
- The new `cockroach connect` command now recognizes `--single-node` to prepare a TLS configuration suitable for a subsequent `start-single-node` command. Additionally, the command checks that either `--single-node` is specified, or both `--init-token` and `--num-expected-peers`. [#60854][#60854] {% comment %}doc{% endcomment %}
- Optimized handling of multi-line SQL strings to avoid unwanted extra server roundtrips. [#61207][#61207]
- Added back support for [`cockroach dump --dump-mode=schema`](../v21.1/cockroach-dump.html). This command calls [`SHOW CREATE ALL TABLES`](../v21.1/show-create.html) and returns the output. This gives users a migration path to use in v21.1 while switching over to `SHOW CREATE ALL TABLES` for v21.2. When executing this, the user is warned that the command is being removed in v21.2 and they should use `SHOW CREATE ALL TABLES` instead. [#61871][#61871] {% comment %}doc{% endcomment %}

<h3 id="v21-1-0-beta-1-api-endpoint-changes">API endpoint changes</h3>

- Added the following new HTTP API endpoints:

    - `/api/v2/nodes/`: Lists all nodes in the cluster
    - `/api/v2/nodes/<node_id>/ranges`: Lists all ranges on the specified node
    - `/api/v2/ranges/hot/`: Lists hot ranges in the cluster
    - `/api/v2/ranges/<range_id>/`: Describes range in more detail
    - `/api/v2/health/`: Returns an HTTP 200 response if node is healthy. [#60952][#60952]

<h3 id="v21-1-0-beta-1-db-console-changes">DB Console changes</h3>

- Manually enqueue range in a replica GC queue now properly respects the `SkipShouldQueue` option. This can be useful to force a GC of a specific Range. [#60619][#60619] {% comment %}doc{% endcomment %}
- Added a filter for full scans to the [**Statements** page](../v21.1/ui-statements-page.html). [#60670][#60670] {% comment %}doc{% endcomment %}
- The **Range Report** page on the DB Console will now also show each of the replica's types. [#61113][#61113] {% comment %}doc{% endcomment %}
- The **Transaction Type** column was removed from [**Statements** page](../v21.1/ui-statements-page.html). The sort order in **Statement** / **Transaction Table** views is now by execution count. The sort order in **Transaction Details** view is by latency. Column titles in statements and transactions tables now say "{Statement,Transaction} Time" instead of "Latency". The **Contention** column added to the **Statements** / **Transactions** pages. **Max Scratch Disk Usage** added to **Statements** and **Transaction Details** pages. [#61177][#61177] {% comment %}doc{% endcomment %}
- Added a full-table scan checkbox. [#61676][#61676] {% comment %}doc{% endcomment %}

<h3 id="v21-1-0-beta-1-bug-fixes">Bug fixes</h3>

- Fixed a bug in the DB Console affecting status badges in Nodes list on **Cluster Overview** page. [#59636][#59636]
- Fixes a bug where backups would fail with an error when trying to read a backup that was written. [#59730][#59730]
- Fixes a bug where some import failures would cause tables to stay `OFFLINE`, when they should have been brought back to `PUBLIC`. [#59723][#59723]
- Fixed a bug that caused errors when joining two tables when one of the tables had a computed column. This bug was present since version v21.1.0-alpha.2 and not present in any production releases. [#59741][#59741]
- Statistics are now correctly generated for columns in multi-column GIN indexes and columns referenced in partial GIN index predicates. [#59687][#59687]
- Fixed a timestamp overflow bug that would overflow timestamps after the year 2038 by updating the Avro SDK used by changefeeds. [#59745][#59745]
- Fixed a very rare chance of inconsistent follower reads. [#59502][#59502]
- Previously if `RELEASE SAVEPOINT cockroach_restart` was followed by `ROLLBACK`, the `sql.txn.rollback.count` metric would be incremented. This was incorrect, since the transaction had already committed. Now that metric is not incremented in this case. [#59781][#59781]
- CockroachDB now explicitly verify descriptors are sequences. [#60159][#60159]
- The result of the `cockroach debug doctor` invocation during `cockroach debug zip` is now properly included inside the generated zip file. [#60529][#60529]
- Fixed a bug in the optimizer statistics code that could cause an unconstrained partial index scan to be preferred over a constrained scan of the same index. [#60516][#60516]
- Fixed a deficiency in the replication layer that could result in ranges becoming unavailable for prolonged periods of time (hours) when a write burst occurred under system overload. While unavailable, the range status page for the affected range would show a last index much larger than the committed index and no movement in these indexes on a quorum of the replicas. Note that this should be distinguished from the case in which enough replicas are offline to constitute a loss of quorum, where the replication layer can not make progress due to the loss of quorum itself. [#60581][#60581]
- Previously, retryable errors in the cleanup phase of the type schema changer wouldn't be retried automatically in the background. This is now fixed. [#60495][#60495]
- v20.2 introduced an ability to rebalance replicas between multiple stores on the same node. This change fixed a problem with that feature, where occasionally an intra-node rebalance would fail and a range would get stuck permanently under replicated. [#60546][#60546]
- Fixed a bug that would cause the value of the optional `into_db` parameter to `RESTORE` to be included in anonymized crash reports. [#60624][#60624]
- Fixed a bug that caused errors for some queries on tables with `GEOMETRY` or `GEOGRAPHY` GIN indexes with filters containing shapes with zero area. [#60598][#60598]
- CockroachDB previously didn't account for some RAM used when disk-spilling operations (like sorts and hash joins) were using the temporary storage in the vectorized execution engine. This could result in OOM crashes, especially when the rows are large in size. This has been fixed. [#60593][#60593]
- Fixed a bug where `ST_Node` would panic if passed in `MULTILINESTRING EMPTY`. [#60691][#60691]
- Fixed a bug that could result in crashes during tracing when using the `trace.debug.enable` cluster setting. [#60725][#60725]
- Fixed execution errors for some queries that use set operations (`UNION` / `EXCEPT` / `INTERSECT`) where a column has types of different widths on the two sides (e.g., `INT4` vs. `INT8`). [#60560][#60560]
- CockroachDB now avoids creating batches that exceed the raft command limit (64MB) when reverting ranges that contain very large keys. [#59716][#59716]
- Fixed a bug whereby high-latency global clusters could sometimes fall behind checkpointing resolved timestamps. [#60807][#60807]
- Added check privileges before changing table/database owner. [#60800][#60800]
- Fixed an internal error caused in some cases involving JSON objects and arrays in a `VALUES` clause. [#60767][#60767]
- Previously `DROP TYPE IF EXISTS` with one existent, and another non-existent type would cause an unhandled error. This is now fixed. [#60822][#60822]
- Fixed bug that could report that a protected timestamp limit was exceeded when the limit was disabled, if an error were to occur while protecting a record. [#60913][#60913]
- CockroachDB previously could encounter an internal error when performing `UNION` operation when the first input resulted only in NULL values and consequent inputs produce tuples, and this is now fixed. Only v21.1 alpha versions are affected. [#60827][#60827]
- Fixed a bug in `crdb_internal.unsafe_upsert_namespace_entry` related to tables and types in user-defined schemas. [#60510][#60510]
- Integers inside of tuples were not being encoded properly when using the binary format for retrieving data. This is now fixed, and the proper integer width is reported. [#61013][#61013]
- Blank-padded chars (e.g., `CHAR(3)`) were not being encoded correctly when returning results to the client. Now they correctly include blank-padding when appropriate. [#61013][#61013]
- Collated strings were not encoded with the proper type OID when sending results to the client if the OID was for the `char` type. This is now fixed. [#61013][#61013]
- Fixed a very rare, possible impossible in practice, bug where a range merge that applied through a Raft snapshot on the left-hand side range's leaseholder could allow that leaseholder to serve writes that invalidated reads from before the merge on the right-hand side.  Release justification: bug fix [#60521][#60521]
- The `SHOW CREATE` output of a partitioned partial index now lists the `PARTITION BY` and `WHERE` clauses in the order accepted by the parser. [#60590][#60590]
- The `SHOW CREATE` output of a partial interleaved index now lists the `INTERLEAVED` and `WHERE` clauses in the order accepted by the parser. [#60590][#60590]
- Fix a bug where cluster restore would sometimes (very rarely) fail after retrying. [#60458][#60458]
- Previously, comparing a negative integer to an OID would fail to compare correctly because the integer was not converted to an unsigned representation first. this is now fixed for both comparisons and casts.[#61148][#61148]
- Previously, CockroachDB could not decode arrays of user-defined types when sent to the server in the binary format. Now it can. [#61165][#61165]
- `crdb_internal.jobs` virtual table is now populated in a paginated fashion, thus, alleviating memory related concerns when previously we could encounter OOM crash. [#60693][#60693]
- The `SHOW TABLES FROM database` command would always show a NULL `estimated_row_count` if inspecting a database that was not the current database. This is now fixed. [#61191][#61191]
- Fixed a bug where schema changes on databases and schemas could return a `relation [<id>] does not exist` if they failed or were canceled and entered the reverting state. These jobs are not actually possible to revert. With this change, the correct error causing the job to fail will be returned, and the job will enter the failed state with an error indicating that the job could not be reverted. [#61159][#61159]
- CockroachDB now drops the default value when its dependent sequence is dropped. [#60744][#60744]
- Dropping and recreating a view/table/sequence in a transaction will now correctly error out if a conflicting object exists or if the drop is incomplete. [#61135][#61135]
- The non-server `cockroach` commands now recognize the new `--log` flag properly. This had been broken in one of the earlier v21.1 alpha releases. [#61232][#61232]
- Prepared statements would sometimes get the wrong type OID for placeholder arguments used in function parameters. This is now fixed. [#60949][#60949]
- Fixed a case where empty zone configurations get created for certain indexes during `ALTER PRIMARY KEY`. [#61235][#61235]
- Schema change jobs associated with databases and schemas can no longer be canceled. Such jobs cannot actually be reverted successfully, so cancelation had no benefit and could have caused namespace corruption. [#61210][#61210]
- Fixed `cockroach demo` commands nodeName error argument index handling. [#61246][#61246]
- CockroachDB no longer displays incorrect node statuses on **Metrics** page, when page just loaded. [#61000][#61000]
- Fixed an NPE observed with a SpanFromContext call in the stack trace. [#61124][#61124]
- Limit scans are no longer counted as full scans. [#61178][#61178]
- Selecting from `crdb_internal.create_statements` will now correctly populate the `database_name` when the virtual index is not used. [#61201][#61201]
- Fixed an internal error when `EXPLAIN`ing an `INSERT` with an input that was determined by the optimizer to produce no rows. [#61278][#61278]
- Fixed a rare deadlock where a series of lease transfers concurrent with a Range merge could block each other from ever completing. [#60905][#60905]
- `ALTER TYPE ... ADD VALUE` changes are picked up by the array type alias correctly. [#61288][#61288]
- Previously, the traces of cascades and checks could be incomplete. This is now fixed. [#61321][#61321]
- Creating interleaved partitioned indexes is now disallowed. Previously, the database would crash when trying to create one. [#61106][#61106]
- Dropping and re-creating a database in a transaction will now correctly error out if an object in a dropped state is detected. [#61361][#61361] [#61358][#61358]
- CockroachDB now uses the correct `FuncExpr` when encoding sequences. [#61428][#61428]
- Alter primary key was not idempotent, so logical equivalent changes to primary keys would unnecessarily create new indexes. This is now fixed. [#61345][#61345]
- Fixed a bug where `GRANT/REVOKE` on the `system.lease` table would result in a deadlock. [#61410][#61410]
- Fixed operation hangs when a node loses access to cluster RPC (e.g., after it has been decommissioned), and immediately return an error instead. [#61356][#61356]
- Fixed a bug from v21.1-alpha where a node decommissioning process could sometimes hang or fail when the decommission request was submitted via the node being decommissioned. [#61356][#61356]
- Fixed bug where zone configurations on indexes were not copied before the backfill of an `ALTER PRIMARY KEY`. They used to be copied afterwards instead. [#61300][#61300]
- Fixed a bug where random numbers generated as default expressions during `IMPORT` would collide a few hundred rows apart from each-other. [#61214][#61214]
- Fixed a bug that caused `UPSERT` and `INSERT..ON CONFLICT..DO UPDATE `statements to fail on tables with both partial indexes and foreign key references. This bug has been present since v20.2.0. [#61416][#61416]
- An `UPDATE..FROM` statement where the `FROM` clause contained column names that match table column names erred if the table had a partial index predicate referencing those columns. This bug, present since partial indexes were released in v20.2.0, has been fixed. [#61522][#61522]
- The names of custom types are no longer sent to Cockroach Labs in telemetry and crash reports. [#60806][#60806]
- Fixed a case where an invalid tuple comparison using ANY was causing an internal error; we now return "unsupported comparison operator". [#61647][#61647]
- Added better privilege checks when creating a changefeed. [#61709][#61709]
- Fixed privileges for system.`protected_ts_meta`. [#61842][#61842]
- The `indexdef` column in the `pg_indexes` table would always report that the index belonged to the public schema. Now it correctly reports user-defined schemas if necessary. [#61754][#61754]
- Fixed "command is too large" errors in some cases when using `EXPLAIN ANALYZE (DEBUG)` or statement diagnostics on complex queries. [#61909][#61909]
- Using `EXPLAIN (OPT, ENV)` on a query that references a table in a user-defined schema would fail previously. This is now fixed. [#61888][#61888]
- Fixed a bug that caused "column does not exist errors" in specific cases of `UPDATE..FROM` statements. The error only occurred when updating a `DECIMAL` column to a column in the `FROM` clause, and the column had a `CHECK` constraint or was referenced by a partial index predicate. [#61949][#61949]
- Previously the `idle_in_session_timeout` and `idle_in_transaction_session_timeout` settings would show the wrong value when using `SHOW`. They would instead show the value of the `statement_timeout` setting. This is now fixed. The functionality was already working correctly; this just fixes a display bug. [#61959][#61959]

<h3 id="v21-1-0-beta-1-performance-improvements">Performance improvements</h3>

- Improved the performance of the `pg_table_is_visible` built-in function. [#59880][#59880]
- Added support for left and anti lookup joins in cases where the equi-join condition is not on the first column in the index, but the first column(s) are constrained to a small number of constant values using a CHECK constraint or an ENUM type. Planning a lookup join for these cases can significantly improve performance if the left input to the join is much smaller than the right-hand side. [#60302][#60302]
- The optimizer now knows that the unique columns in an implicitly partitioned unique index form a key. This can be used to enable certain optimizations and may result in better plans. [#60591][#60591]
- Improved the optimizer's ability to identify constant columns in scans. This can enable different types of optimizations and result in improved plans. [#60927][#60927]
- Follower reads no longer wait before redirecting to the leaseholder if they could not be served by a local follower due to an insufficient closed timestamp. [#60839][#60839]
- Updated the query used to build the virtual table `crdb_internal.table_row_statistics` so that it is always run at `AS OF SYSTEM TIME '-10s'`. This should reduce contention on the table and improve performance for transactions that rely on `crdb_internal.table_row_statistics`, such as `SHOW TABLES`. [#60953][#60953]
- Improved the optimizer's cost estimation of index scans that must visit multiple partitions. When an index has multiple partitions, the optimizer is now more likely to choose a constrained scan rather than a full index scan. This can lead to better plans and improved performance. It also improves the ability of the database to serve queries if one of the partitions is unavailable. [#61063][#61063]
- Optimized external sort to merge partition data faster in colexec. [#61056][#61056]
- If the session setting `locality_optimized_partitioned_index_scan` is enabled, the optimizer will try to plan scans known to produce at most one row using "locality optimized search". This optimization applies for `REGIONAL BY ROW` tables, and if enabled, it means that the execution engine will first search locally for the row before searching remote nodes. If the row is found in a local node, remote nodes will not be searched. [#60831][#60831]
- The optimizer now infers additional functional dependencies based on computed columns in tables. This may enable additional optimizations and lead to better query plans. [#61097][#61097]
- Removed uniqueness checks on the primary key for `REGIONAL BY ROW` tables with a computed region column that is a function of the primary key columns. Uniqueness checks are not necessary in this case since uniqueness can be suitably guaranteed by the primary index. Removing these checks improves performance of `INSERT`, `UPDATE`, and `UPSERT` statements. [#61097][#61097]
- The optimizer no longer plans uniqueness checks for columns in implicitly partitioned unique indexes when those columns are used as the arbiters to detect conflicts in `INSERT ... ON CONFLICT` statements. Unique checks are not needed in this case to enforce uniqueness. Removing these checks results in improved performance for `INSERT ... ON CONFLICT` statements. [#61184][#61184]
- The columns fetched for uniqueness checks of implicitly partitioned unique indexes are now pruned to only include columns necessary for determining uniqueness. [#61376][#61376]
- Introspection queries that use casts into the `REGPROC` pseudo-type are made much more efficient: they're now implemented as a constant-time lookup instead of an internal query. [#61211][#61211]
- Fixed cases where the optimizer was doing unnecessary full table scans when the table was very small (according to the last collected statistics). [#61805][#61805]
- The optimizer now estimates the cost of evaluating query filters more accurately for queries with a `LIMIT`. Previously, it was assumed that the filter would be evaluated on each input row. Now, the optimizer assumes that the filter will only be evaluated on the number of rows required to produce the LIMIT's number of rows after filtering. This may lead to more efficient query plans in some cases. [#61947][#61947]

<div class="release-note-contributors" markdown="1">

<h3 id="v21-1-0-beta-1-contributors">Contributors</h3>

This release includes 667 merged PRs by 70 authors.
We would like to thank the following contributors from the CockroachDB community:

- Abdullah Islam (first-time contributor)
- Alan Acosta (first-time contributor)
- Kumar Akshay
- Max Neverov
- Miguel Novelo (first-time contributor)
- Ratnesh Mishra (first-time contributor)
- Tharun (first-time contributor)
- Ulf Adams (first-time contributor)
- alex-berger@gmx.ch (first-time contributor)
- leoric (first-time contributor)
- shikamaru (first-time contributor)

</div>

[#41367]: https://github.com/cockroachdb/cockroach/pull/41367
[#41929]: https://github.com/cockroachdb/cockroach/pull/41929
[#56954]: https://github.com/cockroachdb/cockroach/pull/56954
[#57077]: https://github.com/cockroachdb/cockroach/pull/57077
[#57170]: https://github.com/cockroachdb/cockroach/pull/57170
[#57183]: https://github.com/cockroachdb/cockroach/pull/57183
[#57827]: https://github.com/cockroachdb/cockroach/pull/57827
[#58422]: https://github.com/cockroachdb/cockroach/pull/58422
[#58688]: https://github.com/cockroachdb/cockroach/pull/58688
[#58923]: https://github.com/cockroachdb/cockroach/pull/58923
[#59086]: https://github.com/cockroachdb/cockroach/pull/59086
[#59220]: https://github.com/cockroachdb/cockroach/pull/59220
[#59396]: https://github.com/cockroachdb/cockroach/pull/59396
[#59410]: https://github.com/cockroachdb/cockroach/pull/59410
[#59490]: https://github.com/cockroachdb/cockroach/pull/59490
[#59492]: https://github.com/cockroachdb/cockroach/pull/59492
[#59502]: https://github.com/cockroachdb/cockroach/pull/59502
[#59539]: https://github.com/cockroachdb/cockroach/pull/59539
[#59571]: https://github.com/cockroachdb/cockroach/pull/59571
[#59621]: https://github.com/cockroachdb/cockroach/pull/59621
[#59624]: https://github.com/cockroachdb/cockroach/pull/59624
[#59636]: https://github.com/cockroachdb/cockroach/pull/59636
[#59676]: https://github.com/cockroachdb/cockroach/pull/59676
[#59687]: https://github.com/cockroachdb/cockroach/pull/59687
[#59692]: https://github.com/cockroachdb/cockroach/pull/59692
[#59693]: https://github.com/cockroachdb/cockroach/pull/59693
[#59709]: https://github.com/cockroachdb/cockroach/pull/59709
[#59710]: https://github.com/cockroachdb/cockroach/pull/59710
[#59716]: https://github.com/cockroachdb/cockroach/pull/59716
[#59717]: https://github.com/cockroachdb/cockroach/pull/59717
[#59723]: https://github.com/cockroachdb/cockroach/pull/59723
[#59730]: https://github.com/cockroachdb/cockroach/pull/59730
[#59732]: https://github.com/cockroachdb/cockroach/pull/59732
[#59735]: https://github.com/cockroachdb/cockroach/pull/59735
[#59741]: https://github.com/cockroachdb/cockroach/pull/59741
[#59745]: https://github.com/cockroachdb/cockroach/pull/59745
[#59750]: https://github.com/cockroachdb/cockroach/pull/59750
[#59781]: https://github.com/cockroachdb/cockroach/pull/59781
[#59790]: https://github.com/cockroachdb/cockroach/pull/59790
[#59810]: https://github.com/cockroachdb/cockroach/pull/59810
[#59815]: https://github.com/cockroachdb/cockroach/pull/59815
[#59824]: https://github.com/cockroachdb/cockroach/pull/59824
[#59828]: https://github.com/cockroachdb/cockroach/pull/59828
[#59829]: https://github.com/cockroachdb/cockroach/pull/59829
[#59831]: https://github.com/cockroachdb/cockroach/pull/59831
[#59836]: https://github.com/cockroachdb/cockroach/pull/59836
[#59851]: https://github.com/cockroachdb/cockroach/pull/59851
[#59856]: https://github.com/cockroachdb/cockroach/pull/59856
[#59858]: https://github.com/cockroachdb/cockroach/pull/59858
[#59864]: https://github.com/cockroachdb/cockroach/pull/59864
[#59865]: https://github.com/cockroachdb/cockroach/pull/59865
[#59877]: https://github.com/cockroachdb/cockroach/pull/59877
[#59880]: https://github.com/cockroachdb/cockroach/pull/59880
[#59978]: https://github.com/cockroachdb/cockroach/pull/59978
[#59989]: https://github.com/cockroachdb/cockroach/pull/59989
[#59995]: https://github.com/cockroachdb/cockroach/pull/59995
[#60154]: https://github.com/cockroachdb/cockroach/pull/60154
[#60159]: https://github.com/cockroachdb/cockroach/pull/60159
[#60160]: https://github.com/cockroachdb/cockroach/pull/60160
[#60257]: https://github.com/cockroachdb/cockroach/pull/60257
[#60281]: https://github.com/cockroachdb/cockroach/pull/60281
[#60282]: https://github.com/cockroachdb/cockroach/pull/60282
[#60302]: https://github.com/cockroachdb/cockroach/pull/60302
[#60311]: https://github.com/cockroachdb/cockroach/pull/60311
[#60379]: https://github.com/cockroachdb/cockroach/pull/60379
[#60437]: https://github.com/cockroachdb/cockroach/pull/60437
[#60442]: https://github.com/cockroachdb/cockroach/pull/60442
[#60448]: https://github.com/cockroachdb/cockroach/pull/60448
[#60458]: https://github.com/cockroachdb/cockroach/pull/60458
[#60461]: https://github.com/cockroachdb/cockroach/pull/60461
[#60467]: https://github.com/cockroachdb/cockroach/pull/60467
[#60469]: https://github.com/cockroachdb/cockroach/pull/60469
[#60490]: https://github.com/cockroachdb/cockroach/pull/60490
[#60495]: https://github.com/cockroachdb/cockroach/pull/60495
[#60497]: https://github.com/cockroachdb/cockroach/pull/60497
[#60510]: https://github.com/cockroachdb/cockroach/pull/60510
[#60511]: https://github.com/cockroachdb/cockroach/pull/60511
[#60516]: https://github.com/cockroachdb/cockroach/pull/60516
[#60519]: https://github.com/cockroachdb/cockroach/pull/60519
[#60521]: https://github.com/cockroachdb/cockroach/pull/60521
[#60529]: https://github.com/cockroachdb/cockroach/pull/60529
[#60539]: https://github.com/cockroachdb/cockroach/pull/60539
[#60546]: https://github.com/cockroachdb/cockroach/pull/60546
[#60550]: https://github.com/cockroachdb/cockroach/pull/60550
[#60560]: https://github.com/cockroachdb/cockroach/pull/60560
[#60581]: https://github.com/cockroachdb/cockroach/pull/60581
[#60590]: https://github.com/cockroachdb/cockroach/pull/60590
[#60591]: https://github.com/cockroachdb/cockroach/pull/60591
[#60592]: https://github.com/cockroachdb/cockroach/pull/60592
[#60593]: https://github.com/cockroachdb/cockroach/pull/60593
[#60594]: https://github.com/cockroachdb/cockroach/pull/60594
[#60596]: https://github.com/cockroachdb/cockroach/pull/60596
[#60598]: https://github.com/cockroachdb/cockroach/pull/60598
[#60616]: https://github.com/cockroachdb/cockroach/pull/60616
[#60619]: https://github.com/cockroachdb/cockroach/pull/60619
[#60624]: https://github.com/cockroachdb/cockroach/pull/60624
[#60641]: https://github.com/cockroachdb/cockroach/pull/60641
[#60670]: https://github.com/cockroachdb/cockroach/pull/60670
[#60691]: https://github.com/cockroachdb/cockroach/pull/60691
[#60693]: https://github.com/cockroachdb/cockroach/pull/60693
[#60708]: https://github.com/cockroachdb/cockroach/pull/60708
[#60713]: https://github.com/cockroachdb/cockroach/pull/60713
[#60725]: https://github.com/cockroachdb/cockroach/pull/60725
[#60744]: https://github.com/cockroachdb/cockroach/pull/60744
[#60748]: https://github.com/cockroachdb/cockroach/pull/60748
[#60753]: https://github.com/cockroachdb/cockroach/pull/60753
[#60758]: https://github.com/cockroachdb/cockroach/pull/60758
[#60761]: https://github.com/cockroachdb/cockroach/pull/60761
[#60767]: https://github.com/cockroachdb/cockroach/pull/60767
[#60771]: https://github.com/cockroachdb/cockroach/pull/60771
[#60772]: https://github.com/cockroachdb/cockroach/pull/60772
[#60775]: https://github.com/cockroachdb/cockroach/pull/60775
[#60784]: https://github.com/cockroachdb/cockroach/pull/60784
[#60799]: https://github.com/cockroachdb/cockroach/pull/60799
[#60800]: https://github.com/cockroachdb/cockroach/pull/60800
[#60806]: https://github.com/cockroachdb/cockroach/pull/60806
[#60807]: https://github.com/cockroachdb/cockroach/pull/60807
[#60822]: https://github.com/cockroachdb/cockroach/pull/60822
[#60825]: https://github.com/cockroachdb/cockroach/pull/60825
[#60826]: https://github.com/cockroachdb/cockroach/pull/60826
[#60827]: https://github.com/cockroachdb/cockroach/pull/60827
[#60831]: https://github.com/cockroachdb/cockroach/pull/60831
[#60832]: https://github.com/cockroachdb/cockroach/pull/60832
[#60839]: https://github.com/cockroachdb/cockroach/pull/60839
[#60847]: https://github.com/cockroachdb/cockroach/pull/60847
[#60854]: https://github.com/cockroachdb/cockroach/pull/60854
[#60901]: https://github.com/cockroachdb/cockroach/pull/60901
[#60903]: https://github.com/cockroachdb/cockroach/pull/60903
[#60905]: https://github.com/cockroachdb/cockroach/pull/60905
[#60908]: https://github.com/cockroachdb/cockroach/pull/60908
[#60913]: https://github.com/cockroachdb/cockroach/pull/60913
[#60922]: https://github.com/cockroachdb/cockroach/pull/60922
[#60923]: https://github.com/cockroachdb/cockroach/pull/60923
[#60927]: https://github.com/cockroachdb/cockroach/pull/60927
[#60938]: https://github.com/cockroachdb/cockroach/pull/60938
[#60941]: https://github.com/cockroachdb/cockroach/pull/60941
[#60949]: https://github.com/cockroachdb/cockroach/pull/60949
[#60952]: https://github.com/cockroachdb/cockroach/pull/60952
[#60953]: https://github.com/cockroachdb/cockroach/pull/60953
[#60992]: https://github.com/cockroachdb/cockroach/pull/60992
[#61000]: https://github.com/cockroachdb/cockroach/pull/61000
[#61013]: https://github.com/cockroachdb/cockroach/pull/61013
[#61018]: https://github.com/cockroachdb/cockroach/pull/61018
[#61032]: https://github.com/cockroachdb/cockroach/pull/61032
[#61041]: https://github.com/cockroachdb/cockroach/pull/61041
[#61043]: https://github.com/cockroachdb/cockroach/pull/61043
[#61047]: https://github.com/cockroachdb/cockroach/pull/61047
[#61056]: https://github.com/cockroachdb/cockroach/pull/61056
[#61063]: https://github.com/cockroachdb/cockroach/pull/61063
[#61097]: https://github.com/cockroachdb/cockroach/pull/61097
[#61105]: https://github.com/cockroachdb/cockroach/pull/61105
[#61106]: https://github.com/cockroachdb/cockroach/pull/61106
[#61113]: https://github.com/cockroachdb/cockroach/pull/61113
[#61124]: https://github.com/cockroachdb/cockroach/pull/61124
[#61127]: https://github.com/cockroachdb/cockroach/pull/61127
[#61130]: https://github.com/cockroachdb/cockroach/pull/61130
[#61132]: https://github.com/cockroachdb/cockroach/pull/61132
[#61135]: https://github.com/cockroachdb/cockroach/pull/61135
[#61139]: https://github.com/cockroachdb/cockroach/pull/61139
[#61148]: https://github.com/cockroachdb/cockroach/pull/61148
[#61159]: https://github.com/cockroachdb/cockroach/pull/61159
[#61162]: https://github.com/cockroachdb/cockroach/pull/61162
[#61165]: https://github.com/cockroachdb/cockroach/pull/61165
[#61169]: https://github.com/cockroachdb/cockroach/pull/61169
[#61170]: https://github.com/cockroachdb/cockroach/pull/61170
[#61177]: https://github.com/cockroachdb/cockroach/pull/61177
[#61178]: https://github.com/cockroachdb/cockroach/pull/61178
[#61184]: https://github.com/cockroachdb/cockroach/pull/61184
[#61191]: https://github.com/cockroachdb/cockroach/pull/61191
[#61201]: https://github.com/cockroachdb/cockroach/pull/61201
[#61207]: https://github.com/cockroachdb/cockroach/pull/61207
[#61210]: https://github.com/cockroachdb/cockroach/pull/61210
[#61211]: https://github.com/cockroachdb/cockroach/pull/61211
[#61214]: https://github.com/cockroachdb/cockroach/pull/61214
[#61221]: https://github.com/cockroachdb/cockroach/pull/61221
[#61232]: https://github.com/cockroachdb/cockroach/pull/61232
[#61235]: https://github.com/cockroachdb/cockroach/pull/61235
[#61244]: https://github.com/cockroachdb/cockroach/pull/61244
[#61246]: https://github.com/cockroachdb/cockroach/pull/61246
[#61251]: https://github.com/cockroachdb/cockroach/pull/61251
[#61278]: https://github.com/cockroachdb/cockroach/pull/61278
[#61286]: https://github.com/cockroachdb/cockroach/pull/61286
[#61288]: https://github.com/cockroachdb/cockroach/pull/61288
[#61297]: https://github.com/cockroachdb/cockroach/pull/61297
[#61300]: https://github.com/cockroachdb/cockroach/pull/61300
[#61315]: https://github.com/cockroachdb/cockroach/pull/61315
[#61321]: https://github.com/cockroachdb/cockroach/pull/61321
[#61324]: https://github.com/cockroachdb/cockroach/pull/61324
[#61326]: https://github.com/cockroachdb/cockroach/pull/61326
[#61344]: https://github.com/cockroachdb/cockroach/pull/61344
[#61345]: https://github.com/cockroachdb/cockroach/pull/61345
[#61348]: https://github.com/cockroachdb/cockroach/pull/61348
[#61353]: https://github.com/cockroachdb/cockroach/pull/61353
[#61356]: https://github.com/cockroachdb/cockroach/pull/61356
[#61358]: https://github.com/cockroachdb/cockroach/pull/61358
[#61361]: https://github.com/cockroachdb/cockroach/pull/61361
[#61362]: https://github.com/cockroachdb/cockroach/pull/61362
[#61376]: https://github.com/cockroachdb/cockroach/pull/61376
[#61386]: https://github.com/cockroachdb/cockroach/pull/61386
[#61387]: https://github.com/cockroachdb/cockroach/pull/61387
[#61410]: https://github.com/cockroachdb/cockroach/pull/61410
[#61416]: https://github.com/cockroachdb/cockroach/pull/61416
[#61427]: https://github.com/cockroachdb/cockroach/pull/61427
[#61428]: https://github.com/cockroachdb/cockroach/pull/61428
[#61494]: https://github.com/cockroachdb/cockroach/pull/61494
[#61499]: https://github.com/cockroachdb/cockroach/pull/61499
[#61514]: https://github.com/cockroachdb/cockroach/pull/61514
[#61522]: https://github.com/cockroachdb/cockroach/pull/61522
[#61523]: https://github.com/cockroachdb/cockroach/pull/61523
[#61601]: https://github.com/cockroachdb/cockroach/pull/61601
[#61647]: https://github.com/cockroachdb/cockroach/pull/61647
[#61676]: https://github.com/cockroachdb/cockroach/pull/61676
[#61709]: https://github.com/cockroachdb/cockroach/pull/61709
[#61723]: https://github.com/cockroachdb/cockroach/pull/61723
[#61733]: https://github.com/cockroachdb/cockroach/pull/61733
[#61754]: https://github.com/cockroachdb/cockroach/pull/61754
[#61805]: https://github.com/cockroachdb/cockroach/pull/61805
[#61813]: https://github.com/cockroachdb/cockroach/pull/61813
[#61826]: https://github.com/cockroachdb/cockroach/pull/61826
[#61842]: https://github.com/cockroachdb/cockroach/pull/61842
[#61844]: https://github.com/cockroachdb/cockroach/pull/61844
[#61871]: https://github.com/cockroachdb/cockroach/pull/61871
[#61876]: https://github.com/cockroachdb/cockroach/pull/61876
[#61888]: https://github.com/cockroachdb/cockroach/pull/61888
[#61909]: https://github.com/cockroachdb/cockroach/pull/61909
[#61947]: https://github.com/cockroachdb/cockroach/pull/61947
[#61949]: https://github.com/cockroachdb/cockroach/pull/61949
[#61959]: https://github.com/cockroachdb/cockroach/pull/61959
[#61962]: https://github.com/cockroachdb/cockroach/pull/61962
